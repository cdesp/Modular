INCLUDE MYOS_2_0000_HARD.SYM

ORG $C000

	DEVSND EQU $38
	DEVSNDDT EQU $30

		;LD B,6
		;CALL DELAYME
		;JP 4
	DELC EQU 15

		CALL TESTSND
		;CALL TST1
		JP 4
	
	
REVA:	  ld b,8
	  ld l,a
REVLOOP:
	  rl l
	  rra
	  djnz REVLOOP
	  RET	


TST1:		LD A,5
		CALL OUTTOSND
		RET

DELAYME:	LD C,B
DMAGN:		CALL DELAYSECME
		DEC C
		JR NZ,DMAGN
		RET


DELAYSECME:	LD B,255
		CALL DELAYMILI
		RET

;WE SHOULD WAIT 32 CLOCK CYCLES ON THE CLOCK OF THE 76489 NOW IS 2.5MHZ
;WE ARE RUNNING ON 10MHZ SO 4*32=128 CL CYCLES BUT 64 SUFFICE APPARENTLY
DELAYABIT:	NEG			;8 CLOCK CYCLES
		NEG
		NEG
		NEG
		NEG
		NEG
		NEG
		NEG
		RET

OUTTOSND:	;OUT (DEVSNDDT),A	;PUT DATA TO FLIP FLOP		
		OUT (DEVSND),A		;SEND TO SOUND
		CALL DELAYABIT
		RET

SND_INIT:	LD A,$9F		;MUTE CHANNEL 0
		CALL OUTTOSND
		LD A,$BF		;MUTE CHANNEL 1
		CALL OUTTOSND
		LD A,$DF		;MUTE CHANNEL 2
		CALL OUTTOSND
		LD A,$FF		;MUTE CHANNEL NOISE
		CALL OUTTOSND
		RET



PLAYTONE1:	LD A,$84		;
		CALL OUTTOSND
		LD A,$38		;440HZ AT 2.5MHZ
		CALL OUTTOSND		
		RET

PLAYTONE2:	LD A,$82		;
		CALL OUTTOSND
		LD A,$1C		;1000HZ AT 2.5MHZ
		CALL OUTTOSND
		RET


PLAYTONE3:	LD A,$81		;
		CALL OUTTOSND
		LD A,$28		;2500HZ AT 2.5MHZ
		CALL OUTTOSND
		RET

PLAYTONE4:	LD A,$81		;
		CALL OUTTOSND
		LD A,$0E		;2500HZ AT 2.5MHZ
		CALL OUTTOSND
		RET


VOLDN:		LD A,$91
NXT1:		CALL OUTTOSND
		LD B,3 
		CALL DELAYME
		INC A
		CP $9F
		JR C,NXT1	
		CALL OUTTOSND
		RET

VOLUP:		LD A,$9F
NXT2:		CALL OUTTOSND
		LD B,3 
		CALL DELAYME
		DEC A
		CP $90
		JR C,NXT2	
		RET		


TESTSND:	CALL SND_INIT
		;CALL RS_RX
TSAGN:		

		CALL RS_RX
		PUSH AF
		LD A,$91		;FULL =$91 , $92, $94, $98 , $9F MUTE FOR CH 0
		CALL OUTTOSND
		POP AF
		CP '1'
		CALL Z,PLAYTONE1
		CP '2'
		CALL Z,PLAYTONE2
		CP '3'
		CALL Z,PLAYTONE3
		CP '4'
		CALL Z,PLAYTONE4
		CP '0'
		CALL Z,SND_INIT
		CP 'M'
		JR NZ,TSAGN
		
		
		CALL VOLDN
		CALL SND_INIT	
		
		RET