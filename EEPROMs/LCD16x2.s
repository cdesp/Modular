	NAME LCDINIT

	;DEVSEL A5, A6 ,A7


	
	GLOBAL LCDINI	
	GLOBAL LCDTXT
	GLOBAL LCDCX
	GLOBAL LCDCY
	GLOBAL LCDCLS	;CLEAR SCREEN
	GLOBAL LCDHOM
	GLOBAL LCDCMD	;DO LCD COMMAND ON REG A
	GLOBAL LCDCHR
	GLOBAL LCDLIN	;SET LCD AT CX,CY
	GLOBAL LCDLN1	;SET LCD AT LINE 1
	GLOBAL LCDLN2	;SET LCD AT LINE 2
	GLOBAL LCDCON	;SET LCD CURSOR ON
	GLOBAL LCDCOF	;SET LCD CURSOR OFF
	GLOBAL LCDDON	;SET LCD DISPLAY ON
	GLOBAL LCDDOF	;SET LCD DISPLAY OFF
	GLOBAL LCDBON	;SET LCD BLINK CURSOR ON
	GLOBAL LCDBOF	;SET LCD BLINK CURSOR OFF
	GLOBAL LCDCRL ;SET CURSOR LEFT
	GLOBAL LCDCRR ;SET CURSOR RIGHT
	GLOBAL LCDSSL ;SHIFT DISPLAY LEFT
	GLOBAL LCDSSr ;SHIFT DISPLAY RIGHT

	
	

	;DEVLCD EQU $40 ; SET ON MAIN

	PDAT EQU DEVLCD 	;LCD DATA PORT SEND DATA TO LCD
	PINS EQU DEVLCD+01	;LCD RS SET PORT BIT 1 

	
	;RAMAD EQU $F000
	
	
	;DISPCT EQU RAMAD+5
				;DB 8+4		;DISPLAY CONTROL
				;BIT 0= BLINK CURSOR POS CHAR
				;BIT 1= CURSOR ON OFF
				;BIT 2=	DISPLAY ON OFF
				;BIT 3= 1
	;LCDCX EQU RAMAD+6		;DB 0		;DISPLAY X POS (0..F  FOR 1..16)
	;LCDCY EQU RAMAD+7 	;DB 0		;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)

LCDINI:	LD HL,DISPCT
	LD A,8+4
	LD (HL),A
	XOR A
	OUT (PINS),A		;SET RS 0  CMD 	
	LD A,16+32	;INITIALIZATION BYTE
	OUT (PDAT),A		;SEND COMMAND
	CALL DEL2
	CALL DEL2
	CALL DEL2
	CALL DEL2	
	LD B,2            ;WRITE FUNCTION 3X		
INIT1:	LD A,16+32	;INITIALIZATION BYTE
	OUT (PDAT),A		;SEND COMMAND
	CALL DEL2
	DJNZ INIT1        ;DELAY LOOP


	LD A,32+16+8+0	  ;SET 8BIT AND LINES AND FONT	(16 + 8 + 0)
	CALL LCDCMD
	;LD A,16+8	  ;SET SHIFT DISPLAY + NO SHIFT RIGHT
	;CALL LCDCMD
	LD A,8+4+2+1	  ;DISPLAY ON CURSOR ON BLINK ON
	CALL LCDCMD
	LD A,1		  ;CLS DISPLAY (1)
	CALL LCDCMD

	RET


LCDBUS:	; ON ENTRY A HAS THE REAL RS EITHER 0 =CMD OR 1=DATA
	PUSH AF	
	XOR A
	OUT (PINS),A			;SET RS 0  CMD FOR READING	
BUS1:	IN A,(PDAT)  	;E=1 R/W=1 RS=0 INSTRUCT
	RLA	  	;d3 IS 1? FOR 4 BIT d7 FOR 8BIT
	JR C,BUS1
	POP AF
	OUT (PINS),A	;SET RS EITHER 0 OR 3 (BIT 1)
	RET


			;FOR FULL 8 BIT DATA INTERFACE
LCDCMD: PUSH AF	
				XOR A	 				;RS=0
				CALL LCDBUS
				POP AF
			 ;LCD DEVICE SELECT
LCDCM1:	OUT (PDAT),A   	;E=1 R/W=0 RS=1 INSTRUCT
	RET



LCDCHR:	PUSH AF
				LD A,3				;RS=1 DATA 
				CALL LCDBUS
				POP AF
		 	;LCD DEVICE SELECT
	      OUT (PDAT),A   	;E=1 R/W=0 RS=1 DATA
	RET


LCDTXT: PUSH HL
				CALL LCDTX1
				POP HL				
				RET
LCDTX1:	LD A,(HL)
				INC HL
				CP 0
				RET Z
				CALL LCDCHR
				JR LCDTXT


LCDCLS:	PUSH HL
	PUSH AF
	LD A,1
	CALL LCDCMD
	XOR A
	LD HL,LCDCX
	LD (HL),A
	INC HL 		;LCDCY
	LD (HL),A
	POP AF
	POP HL
	RET

LCDHOM: PUSH HL
	PUSH AF
	LD A,2
	CALL LCDCMD
	XOR A
	LD HL,LCDCX
	LD (HL),A
	INC HL 		;LCDCY
	LD (HL),A
	POP AF
	POP HL
	RET

LCDLIN: PUSH HL
	PUSH AF
	PUSH DE
	LD HL,LCDCX	;LCDCX
	LD A,(HL)
	LD D,A
	INC HL 		;LCDCY
	LD A,(HL) 
	LD E,A
	LD A,128	;SET DDRAM ADDR
	ADD D		
	SLA E	;$40 IF E IS 1 (LINE 2)
	SLA E
	SLA E
	SLA E
	SLA E
	ADD E
	CALL LCDCMD
	POP DE
	POP AF
	POP HL
	RET	
LCDLN1: PUSH AF
	LD A,128	;SET LINE 1 DRAM ADDR 0
	CALL LCDCMD
	POP AF
	RET
LCDLN2: PUSH AF
	LD A,128+64	;SET LINE 2 DRAM ADDR $40
	CALL LCDCMD
	POP AF
	RET

SETDIS:	PUSH AF
	LD A,(HL)
	SET 3,A
	AND 15		;ONLY LOWER 4 BITS
	CALL LCDCMD
	POP AF
	RET

LCDCON:	PUSH HL
	LD HL,DISPCT
	SET 1,(HL)
	CALL SETDIS
	POP HL
	RET

LCDCOF:	PUSH HL
	LD HL,DISPCT
	RES 1,(HL)
	CALL SETDIS
	POP HL
	RET

LCDDON:	PUSH HL
	LD HL,DISPCT
	SET 2,(HL)
	CALL SETDIS
	POP HL
	RET

LCDDOF: PUSH HL
	LD HL,DISPCT
	RES 2,(HL)
	CALL SETDIS
	POP HL
	RET

LCDBON:	PUSH HL
	LD HL,DISPCT
	SET 0,(HL)
	CALL SETDIS
	POP HL
	RET

LCDBOF: PUSH HL
	LD HL,DISPCT
	RES 0,(HL)
	CALL SETDIS
	POP HL
	RET
	
LCDCRL: PUSH AF
	LD A,$10	;
	CALL LCDCMD
	POP AF
	RET

LCDCRR: PUSH AF
	LD A,$14 	;
	CALL LCDCMD
	POP AF
	RET
	
LCDSSL: PUSH AF
	LD A,$18	;
	CALL LCDCMD
	POP AF
	RET

LCDSSR: PUSH AF
	LD A,$1C 	;
	CALL LCDCMD
	POP AF
	RET

	
	END