ORG $4000

JP STARTPRG

INCLUDE MYOS_2_0000_HARD.SYM
;GTKEY EQU $422D
;KBDISABLE EQU $4244
;KBENABLE EQU $4249
;NGETKEY EQU $424D
;PS2LOK	EQU $4326


INCLUDE ATL_UTILS.Z80 
INCLUDE ATL_PS2KEYBNEW.Z80

STARTPRG:	CALL RS_RX
		CP '1'
		CALL Z,KBOFF
		CP '2'
		CALL Z,KBON
		CP 'M'
		JP Z,4
		CP '4'
		CALL Z,READCH
		CP '3'
		CALL Z,DO3
		CP '5'
		CALL Z,DO5
		CP '0'
		CALL Z,DOGETKEY
		JR STARTPRG

READCH:		CALL READCHAR
		LD A,(LASTKEY)
		CALL B2D8
		LD HL,B2DEND-4
		CALL RS_TXT
		LD A,10
		CALL RS_TX
		LD A,13
		CALL RS_TX

		RET

DO5:		EI
		RET

DO3:		XOR A
		OUT (DEVKBI), A	
		RET

KBON:		IN A, (DEVKBI) 		;CLEAR THE INTERRUPT 
		XOR A
		OUT (DEVKBI), A		;ENABLE KEYBOARD
		OUT (DEVKBI), A		;ENABLE KEYBOARD
		OUT (DEVKBI), A		;ENABLE KEYBOARD		
		RET

KBOFF:		LD A,2
		OUT (DEVKBI), A		;DISABLE KEYBOARD
		RET
		
	
DOGETKEY:
AGN:		EI
		CALL PS2ISK2
		JR Z, AGN
		CALL READCH
		XOR A
		LD (INT2TE),A
		JR AGN

PS2ISK2:	LD A,(INT2TE)
		OR A
		RET NZ
                CALL PS2SETKEYAV
		RET


KBDFLAG DB 0
LASTKEY DB 0

