  5)   0000 00          		 NOP	;
  6)   0001 C3 00 02    		 JP START	;
  7)   0004 C3 A2 02    		 JP MENU	;
  8)   0007 02          		 VERSION DEFB 2 ; AT ADDR=7	; AT ADDR=7
  9)   0008 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   000C 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0010 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0014 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0018 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   001C 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0020 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0024 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0028 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   002C 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0030 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
  9)   0034 00 00 00 00 		 DEFS $30 ;SKIP $30 BYTES	;SKIP $30 BYTES
 12)   0038 C3 7A 05    		 JP INTSER	;
 15)   003B 00 00 00 00 		 ALIGN 256	;
 15)   003F 00 00 00 00 		 ALIGN 256	;
 15)   0043 00 00 00 00 		 ALIGN 256	;
 15)   0047 00 00 00 00 		 ALIGN 256	;
 15)   004B 00 00 00 00 		 ALIGN 256	;
 15)   004F 00 00 00 00 		 ALIGN 256	;
 15)   0053 00 00 00 00 		 ALIGN 256	;
 15)   0057 00 00 00 00 		 ALIGN 256	;
 15)   005B 00 00 00 00 		 ALIGN 256	;
 15)   005F 00 00 00 00 		 ALIGN 256	;
 15)   0063 00 00 00 00 		 ALIGN 256	;
 15)   0067 00 00 00 00 		 ALIGN 256	;
 15)   006B 00 00 00 00 		 ALIGN 256	;
 15)   006F 00 00 00 00 		 ALIGN 256	;
 15)   0073 00 00 00 00 		 ALIGN 256	;
 15)   0077 00 00 00 00 		 ALIGN 256	;
 15)   007B 00 00 00 00 		 ALIGN 256	;
 15)   007F 00 00 00 00 		 ALIGN 256	;
 15)   0083 00 00 00 00 		 ALIGN 256	;
 15)   0087 00 00 00 00 		 ALIGN 256	;
 15)   008B 00 00 00 00 		 ALIGN 256	;
 15)   008F 00 00 00 00 		 ALIGN 256	;
 15)   0093 00 00 00 00 		 ALIGN 256	;
 15)   0097 00 00 00 00 		 ALIGN 256	;
 15)   009B 00 00 00 00 		 ALIGN 256	;
 15)   009F 00 00 00 00 		 ALIGN 256	;
 15)   00A3 00 00 00 00 		 ALIGN 256	;
 15)   00A7 00 00 00 00 		 ALIGN 256	;
 15)   00AB 00 00 00 00 		 ALIGN 256	;
 15)   00AF 00 00 00 00 		 ALIGN 256	;
 15)   00B3 00 00 00 00 		 ALIGN 256	;
 15)   00B7 00 00 00 00 		 ALIGN 256	;
 15)   00BB 00 00 00 00 		 ALIGN 256	;
 15)   00BF 00 00 00 00 		 ALIGN 256	;
 15)   00C3 00 00 00 00 		 ALIGN 256	;
 15)   00C7 00 00 00 00 		 ALIGN 256	;
 15)   00CB 00 00 00 00 		 ALIGN 256	;
 15)   00CF 00 00 00 00 		 ALIGN 256	;
 15)   00D3 00 00 00 00 		 ALIGN 256	;
 15)   00D7 00 00 00 00 		 ALIGN 256	;
 15)   00DB 00 00 00 00 		 ALIGN 256	;
 15)   00DF 00 00 00 00 		 ALIGN 256	;
 15)   00E3 00 00 00 00 		 ALIGN 256	;
 15)   00E7 00 00 00 00 		 ALIGN 256	;
 15)   00EB 00 00 00 00 		 ALIGN 256	;
 15)   00EF 00 00 00 00 		 ALIGN 256	;
 15)   00F3 00 00 00 00 		 ALIGN 256	;
 15)   00F7 00 00 00 00 		 ALIGN 256	;
 15)   00FB 00 00 00 00 		 ALIGN 256	;
 15)   00FF 00          		 ALIGN 256	;
 18)   0100 C3 40 18    		     JP MYOS_CLRSCN	;
 19)   0103 C3 43 18    		     JP MYOS_PUTIME	;
 20)   0106 C3 54 18    		     JP MYOS_GETIME	;
 21)   0109 C3 65 18    		     JP MYOS_PUTCSR	;
 22)   010C C3 77 18    		     JP MYOS_GETCSR	;
 23)   010F C3 86 18    		     JP MYOS_OSRDCH	;
 24)   0112 C3 43 1A    		     JP MYOS_PROMPT	;
 25)   0115 C3 91 18    		     JP MYOS_OSWRCH	;
 26)   0118 C3 71 1A    		     JP MYOS_OSKEY	;
 27)   011B C3 AD 1A    		     JP MYOS_OSINIT	;
 28)   011E C3 A3 1C    		     JP MYOS_OSLINE	;
 29)   0121 C3 78 1B    		     JP MYOS_OSCLI	;
 30)   0124 C3 05 1C    		     JP MYOS_OSBPUT 	;
 31)   0127 C3 05 1C    		     JP MYOS_OSBGET 	;
 32)   012A C3 05 1C    		     JP MYOS_OSSTAT 	;
 33)   012D C3 05 1C    		     JP MYOS_OSSHUT 	;
 34)   0130 C3 05 1C    		     JP MYOS_OSOPEN 	;
 35)   0133 C3 05 1C    		     JP MYOS_OSCALL 	;
 36)   0136 C3 CA 1D    		     JP MYOS_OSSAVE 	;
 37)   0139 C3 F3 1D    		     JP MYOS_OSLOAD 	;
 38)   013C C3 05 1C    		     JP MYOS_GETPTR 	;
 39)   013F C3 05 1C    		     JP MYOS_PUTPTR 	;
 40)   0142 C3 05 1C    		     JP MYOS_GETEXT 	;
 41)   0145 C3 08 1C    		     JP MYOS_RESET 	;
 42)   0148 C3 9D 1A    		     JP MYOS_TRAP	;
 43)   014B C3 A0 1A    		     JP MYOS_LTRAP  	;
 44)   014E C3 10 1C    		     JP MYOS_CLG	;
 45)   0151 C3 28 1C    		     JP MYOS_COLOUR	;
 46)   0154 C3 33 1C    		     JP MYOS_DRAW	;
 47)   0157 C3 59 1C    		     JP MYOS_ENVEL	;
 48)   015A C3 1C 1C    		     JP MYOS_GCOL	;
 49)   015D C3 09 1C    		     JP MYOS_MODE	;
 50)   0160 C3 3D 1C    		     JP MYOS_MOVE	;
 51)   0163 C3 47 1C    		     JP MYOS_PLOT	;
 52)   0166 C3 59 1C    		     JP MYOS_SOUND	;
 53)   0169 C3 59 1C    		     JP MYOS_ADVAL	;
 54)   016C C3 51 1C    		     JP MYOS_POINT	;
 55)   016F C3 59 1C    		     JP MYOS_GETIMS	;
 56)   0172 C3 59 1C    		     JP MYOS_PUTIMS    	;
 58)   0175 00 00 00 00 		 ALIGN 256     	;
 58)   0179 00 00 00 00 		 ALIGN 256     	;
 58)   017D 00 00 00 00 		 ALIGN 256     	;
 58)   0181 00 00 00 00 		 ALIGN 256     	;
 58)   0185 00 00 00 00 		 ALIGN 256     	;
 58)   0189 00 00 00 00 		 ALIGN 256     	;
 58)   018D 00 00 00 00 		 ALIGN 256     	;
 58)   0191 00 00 00 00 		 ALIGN 256     	;
 58)   0195 00 00 00 00 		 ALIGN 256     	;
 58)   0199 00 00 00 00 		 ALIGN 256     	;
 58)   019D 00 00 00 00 		 ALIGN 256     	;
 58)   01A1 00 00 00 00 		 ALIGN 256     	;
 58)   01A5 00 00 00 00 		 ALIGN 256     	;
 58)   01A9 00 00 00 00 		 ALIGN 256     	;
 58)   01AD 00 00 00 00 		 ALIGN 256     	;
 58)   01B1 00 00 00 00 		 ALIGN 256     	;
 58)   01B5 00 00 00 00 		 ALIGN 256     	;
 58)   01B9 00 00 00 00 		 ALIGN 256     	;
 58)   01BD 00 00 00 00 		 ALIGN 256     	;
 58)   01C1 00 00 00 00 		 ALIGN 256     	;
 58)   01C5 00 00 00 00 		 ALIGN 256     	;
 58)   01C9 00 00 00 00 		 ALIGN 256     	;
 58)   01CD 00 00 00 00 		 ALIGN 256     	;
 58)   01D1 00 00 00 00 		 ALIGN 256     	;
 58)   01D5 00 00 00 00 		 ALIGN 256     	;
 58)   01D9 00 00 00 00 		 ALIGN 256     	;
 58)   01DD 00 00 00 00 		 ALIGN 256     	;
 58)   01E1 00 00 00 00 		 ALIGN 256     	;
 58)   01E5 00 00 00 00 		 ALIGN 256     	;
 58)   01E9 00 00 00 00 		 ALIGN 256     	;
 58)   01ED 00 00 00 00 		 ALIGN 256     	;
 58)   01F1 00 00 00 00 		 ALIGN 256     	;
 58)   01F5 00 00 00 00 		 ALIGN 256     	;
 58)   01F9 00 00 00 00 		 ALIGN 256     	;
 58)   01FD 00 00 00    		 ALIGN 256     	;
 34)   0200 F3          		@START: DI	;
 44)   0201 C3 45 02    		 JP BOOT ;SKIP TESTING	;SKIP TESTING
 49)   0204 06 05       		CN1: LD B,5	;
 50)   0206 0E 00       		AGN1: LD C,0	;
 51)   0208 3E 00       		 LD A,0	;
 52)   020A ED 79       		 OUT (C),A	;
 53)   020C 0E 00       		 LD C,0	;
 54)   020E 3E FF       		 LD A,255	;
 55)   0210 ED 79       		 OUT (C),A	;
 56)   0212 10 F2       		 DJNZ AGN1	;
 61)   0214 11 01 00    		 LD DE,1	;
 62)   0217 3E 00       		 LD A,0 ;WRITE 0	;WRITE 0
 63)   0219 4F          		 LD C,A	;
 64)   021A 21 00 80    		 LD HL,RAMAD 	;
 65)   021D 06 08       		 LD B,8	;
 66)   021F 77          		AGN2: LD (HL),A	;
 67)   0220 4E          		 LD C,(HL)	;
 68)   0221 B9          		 CP C	;
 69)   0222 C2 3C 02    		 JP NZ, ERR	;
 70)   0225 19          		 ADD HL,DE	;
 71)   0226 C6 20       		 ADD A,32 ;WRITE +32	;WRITE +32
 72)   0228 4F          		 LD C,A	;
 73)   0229 10 F4       		 DJNZ AGN2	;
 75)   022B 06 05       		 LD B,5	;
 76)   022D 0E 08       		AGN3: LD C,00001000B ;LLH ON 138 Y1 OUT	;LLH ON 138 Y1 OUT
 77)   022F 3E 40       		 LD A,64	;
 78)   0231 ED 79       		 OUT (C),A	;
 79)   0233 C6 80       		 ADD A,128	;
 80)   0235 ED 79       		 OUT (C),A 	;
 81)   0237 10 F4       		 DJNZ AGN3  ; SIGNAL ALL OK CONTINUOUS 10 TIMES ON PORT 8	; SIGNAL ALL OK CONTINUOUS 10 TIMES ON PORT 8
 82)   0239 C3 45 02    		 JP BOOT	;
 85)   023C 0E 38       		ERR: LD C,00111000B ;HHH ON 138 Y7 OUT	;HHH ON 138 Y7 OUT
 86)   023E 3E 40       		 LD A,64	;
 87)   0240 ED 79       		 OUT (C),A	;
 89)   0242 C3 3C 02    		 JP ERR ;DO AGAIN PORT 1	;DO AGAIN PORT 1
 96)   0245 F3          		@BOOT: DI	;
 97)   0246 ED 56       		  IM 1 	;
 98)   0248 31 F0 FF    		 LD SP,STACKP 	;
 99)   024B CD 17 04    		 CALL EPROMOFF	;
100)   024E CD 83 06    		 CALL KEYBDATON 	;
103)   0251 3E 0C       		  LD A,12    ;12=9600 BPS, 1=115200BPS	;12=9600 BPS, 1=115200BPS
104)   0253 CD E5 05    		 CALL RS_INI  ;RS232 INITIALIZE	;RS232 INITIALIZE
105)   0256 21 43 05    		 LD HL,STR00	;
106)   0259 CD 0D 06    		 CALL RS_TXT	;
109)   025C CD 76 1E    		  CALL I2C_INIT     ;INITIALIZE I2C	;INITIALIZE I2C
110)   025F CD 02 20    		  CALL DS1307_ADJUST_TEST   ;SET A DEFAULT DATETIME ON DS1307	;SET A DEFAULT DATETIME ON DS1307
111)   0262 CD D7 20    		  CALL LCD16_INIT   ;INITIALIZE 16X2 LCD	;INITIALIZE 16X2 LCD
112)   0265 21 47 04    		  LD HL,SVER	;
113)   0268 CD 58 21    		  CALL LCD16_PRINT  ;PRINT VERSION ON 1,1	;PRINT VERSION ON 1,1
122)   026B CD C4 09    		  CALL LCD_INIT	;
123)   026E 21 00 00    		  LD HL,COL_BLACK	;
124)   0271 22 03 83    		  LD (BCOLOR),HL	;
125)   0274 21 C0 FF    		  LD HL,COL_YELLOW	;
126)   0277 22 01 83    		  LD (FCOLOR),HL	;
127)   027A 21 30 05    		  LD HL,STRSCR 	;
128)   027D CD 0D 06    		  CALL RS_TXT	;
129)   0280 CD D2 11    		  CALL LCD_CLRSCR  	;
130)   0283 AF          		 XOR A	;
131)   0284 32 0F 83    		  LD (SCRLN),A   	;
132)   0287 3E 00       		  LD A,0	;
133)   0289 32 0D 83    		  LD (CURSORX),A	;
134)   028C 3E 00       		  LD A,0	;
135)   028E 32 0E 83    		  LD (CURSORY),A  	;
136)   0291 21 8C 04    		 LD HL,STR0    ;LCD INIT MSG ON 0,0	;LCD INIT MSG ON 0,0
137)   0294 CD 12 12    		 CALL LCD_MSG	;
138)   0297 3E 1E       		  LD A,30	;
139)   0299 32 0D 83    		  LD (CURSORX),A 	;
140)   029C 21 47 04    		  LD HL,SVER	;
141)   029F CD 12 12    		  CALL LCD_MSG  ;PRINT VERSION ON 30,0	;PRINT VERSION ON 30,0
149)   02A2 AF          		@MENU: XOR A	;
150)   02A3 32 0F 83    		  LD (SCRLN),A	;
151)   02A6 21 01 05    		 LD HL,STRMN	;
152)   02A9 CD 0D 06    		 CALL RS_TXT ;OUTPUT MENU COMMANDS AT RS232 	;OUTPUT MENU COMMANDS AT RS232
153)   02AC 21 59 05    		 LD HL,STR01	;
154)   02AF CD 0D 06    		 CALL RS_TXT ;OUTPUT WAITING AT RS232	;OUTPUT WAITING AT RS232
161)   02B2 21 57 04    		 LD HL,SMENU	;
162)   02B5 3E 05       		  LD A,5	;
163)   02B7 32 0D 83    		  LD (CURSORX),A	;
164)   02BA 3E 02       		  LD A,2	;
165)   02BC 32 0E 83    		  LD (CURSORY),A  	;
166)   02BF CD 12 12    		 CALL LCD_MSG	;
168)   02C2 CD 1D 03    		 CALL GET_CHAR ;TAKE A CHAR FROM RS232 OR PS2 KEYB	;TAKE A CHAR FROM RS232 OR PS2 KEYB
171)   02C5 FE 55       		 CP 'U' ;UPLOAD PROGRAM	;UPLOAD PROGRAM
172)   02C7 CC 4C 03    		 CALL Z, UPLOD	;
173)   02CA FE 58       		 CP 'X'	;
174)   02CC CA 3E 03    		 JP Z,EXEC	;
175)   02CF FE 54       		 CP 'T'	;
176)   02D1 CC C3 03    		 CALL Z,RSTST	;
177)   02D4 FE 53       		 CP 'S'	;
178)   02D6 CC F5 03    		 CALL Z,TXTSCR	;
179)   02D9 FE 49       		 CP 'I'	;
180)   02DB CC 83 03    		 CALL Z,UPLOD2	;
181)   02DE FE 59       		 CP 'Y'	;
182)   02E0 CC D9 03    		 CALL Z,RSTST2	;
183)   02E3 FE 48       		 CP 'H'	;
184)   02E5 CC E8 03    		 CALL Z,XMTST	;
185)   02E8 FE 4A       		 CP 'J'	;
186)   02EA CC A8 03    		 CALL Z,DNLOD	;
189)   02ED FE 43       		 CP 'C'	;
190)   02EF CC D2 11    		 CALL Z,LCD_CLRSCR	;
191)   02F2 FE 42       		 CP 'B'	;
192)   02F4 CA 00 40    		 JP Z,BBCBASIC	;
194)   02F7 C3 A2 02    		 JP MENU	;
201)   02FA CD 79 1C    		@GET_CHARNW: CALL CHKCURS	;
202)   02FD AF          		 XOR A 	;
204)   02FE CD 40 06    		 CALL RS_KEYRD ;CHAR IN RS232?	;CHAR IN RS232?
205)   0301 28 04       		 JR Z,CNW_TST2 	;
206)   0303 CD 17 06    		 CALL RS_RX ; GET THAT CHAR	; GET THAT CHAR
207)   0306 C9          		 RET	;
210)   0307 CD 75 07    		 CALL READCHAR ;GET THE KEY FROM USB KEYBOARD (HAS A TIMEOUT)	;GET THE KEY FROM USB KEYBOARD (HAS A TIMEOUT)
211)   030A FE 00       		 CP 0         ;IF KEY=0 THEN IT IS INVALID	;IF KEY=0 THEN IT IS INVALID
212)   030C C8          		 RET Z        ;EXIT IF Z TODO LOOP THIS FOR 10MS THEN EXIT	;EXIT IF Z TODO LOOP THIS FOR 10MS THEN EXIT
215)   030D F5          		 PUSH AF	;
216)   030E CD FE 05    		 CALL RS_TX	;
217)   0311 3E 0A       		 LD A,10	;
218)   0313 CD FE 05    		 CALL RS_TX	;
219)   0316 3E 0D       		 LD A,13	;
220)   0318 CD FE 05    		 CALL RS_TX	;
221)   031B F1          		 POP AF	;
222)   031C C9          		 RET	;
227)   031D AF          		@GET_CHAR: XOR A	;
230)   031E CD 40 06    		 CALL RS_KEYRD ;CHAR IN RS232?	;CHAR IN RS232?
231)   0321 28 04       		 JR Z,CW_TST2	;
232)   0323 CD 17 06    		 CALL RS_RX ; GET THAT CHAR	; GET THAT CHAR
233)   0326 C9          		 RET	;
240)   0327 CD 75 07    		 CALL READCHAR ;GET THE KEY FROM USB KEYBOARD (HAS A TIMEOUT)	;GET THE KEY FROM USB KEYBOARD (HAS A TIMEOUT)
241)   032A FE 00       		 CP 0         ;IF KEY=0 THEN IT IS INVALID	;IF KEY=0 THEN IT IS INVALID
242)   032C 28 EF       		 JR Z,GET_CHAR	;
245)   032E F5          		 PUSH AF	;
246)   032F CD FE 05    		 CALL RS_TX	;
247)   0332 3E 0A       		 LD A,10	;
248)   0334 CD FE 05    		 CALL RS_TX	;
249)   0337 3E 0D       		 LD A,13	;
250)   0339 CD FE 05    		 CALL RS_TX	;
251)   033C F1          		 POP AF	;
252)   033D C9          		 RET	;
263)   033E 3E 05       		 LD A,5	;
264)   0340 CD D2 21    		 CALL SCPRN  	;
266)   0343 11 A4 83    		 LD DE,PRGEX	;
267)   0346 1A          		 LD A,(DE)	;
268)   0347 6F          		 LD L,A	;
269)   0348 13          		 INC DE	;
270)   0349 1A          		 LD A,(DE)	;
271)   034A 67          		 LD H,A	;
272)   034B E9          		 JP (HL)	;
279)   034C F3          		UPLOD: DI 	;
284)   034D CD 17 06    		 CALL RS_RX ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
285)   0350 6F          		 LD L,A	;
286)   0351 CD 17 06    		 CALL RS_RX	;
287)   0354 67          		 LD H,A	;
288)   0355 CD 17 06    		 CALL RS_RX ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
289)   0358 4F          		 LD C,A	;
290)   0359 CD 17 06    		 CALL RS_RX	;
291)   035C 47          		 LD B,A	;
293)   035D 11 A4 83    		 LD DE,PRGEX ;SAVE TO PRGEX THE PROG EXEC ADDR=HL	;SAVE TO PRGEX THE PROG EXEC ADDR=HL
294)   0360 7D          		 LD A,L	;
295)   0361 12          		 LD (DE),A	;
296)   0362 13          		 INC DE	;
297)   0363 7C          		 LD A,H	;
298)   0364 12          		 LD (DE),A	;
300)   0365 FE 80       		 CP $80	;
301)   0367 DC 21 04    		 CALL C,EPROMON ;C ROM IN 0-8000 NC ROM IN 8000-FFFF ;SET ROM WRITABLE = '0'	;C ROM IN 0-8000 NC ROM IN 8000-FFFF ;SET ROM WRITABLE = '0'
303)   036A E5          		NORWR: PUSH HL	;
304)   036B CD 17 06    		NXB: CALL RS_RX	;
305)   036E 77          		 LD (HL),A	;
306)   036F 23          		 INC HL	;
307)   0370 0B          		 DEC BC	;
308)   0371 78          		 LD A,B	;
309)   0372 B1          		 OR C	;
310)   0373 20 F6       		 JR NZ,NXB ;LOOP ALL BYTES 	;LOOP ALL BYTES
311)   0375 CD 17 04    		 CALL EPROMOFF	;
316)   0378 3E 05       		 LD A,5 	;
317)   037A CD D2 21    		 CALL SCPRN  	;
318)   037D CD DF 21    		 CALL DELAY	;
320)   0380 E1          		 POP HL	;
323)   0381 FB          		 EI	;
324)   0382 C9          		 RET	;
328)   0383 F3          		UPLOD2: DI	;
333)   0384 CD 17 06    		 CALL RS_RX ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
334)   0387 6F          		 LD L,A	;
335)   0388 CD 17 06    		 CALL RS_RX	;
336)   038B 67          		 LD H,A	;
337)   038C CD 17 06    		 CALL RS_RX ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
338)   038F 4F          		 LD C,A	;
339)   0390 CD 17 06    		 CALL RS_RX	;
340)   0393 47          		 LD B,A	;
342)   0394 11 A4 83    		 LD DE,PRGEX ;SAVE TO PRGEX THE PROG EXEC ADDR=HL	;SAVE TO PRGEX THE PROG EXEC ADDR=HL
343)   0397 7D          		 LD A,L	;
344)   0398 12          		 LD (DE),A	;
345)   0399 13          		 INC DE	;
346)   039A 7C          		 LD A,H	;
347)   039B 12          		 LD (DE),A	;
349)   039C CD 17 06    		NXB2: CALL RS_RX	;
350)   039F 77          		 LD (HL),A	;
351)   03A0 23          		 INC HL	;
352)   03A1 0B          		 DEC BC	;
353)   03A2 78          		 LD A,B	;
354)   03A3 B1          		 OR C	;
355)   03A4 20 F6       		 JR NZ,NXB2 ;LOOP ALL BYTES   	;LOOP ALL BYTES
357)   03A6 FB          		 EI	;
359)   03A7 C9          		 RET	;
370)   03A8 CD 17 06    		 CALL RS_RX ;HL HAS RAM ADDRESS	;HL HAS RAM ADDRESS
371)   03AB 6F          		 LD L,A	;
372)   03AC CD 17 06    		 CALL RS_RX	;
373)   03AF 67          		 LD H,A	;
374)   03B0 CD 17 06    		 CALL RS_RX ;BC HAS TOTAL DATA TO BE SEND	;BC HAS TOTAL DATA TO BE SEND
375)   03B3 4F          		 LD C,A	;
376)   03B4 CD 17 06    		 CALL RS_RX	;
377)   03B7 47          		 LD B,A	;
379)   03B8 7E          		NXB3: LD A,(HL)	;
380)   03B9 CD FE 05    		 CALL RS_TX ;SEND BYTE	;SEND BYTE
381)   03BC 23          		 INC HL	;
382)   03BD 0B          		 DEC BC	;
383)   03BE 78          		 LD A,B	;
384)   03BF B1          		 OR C	;
385)   03C0 20 F6       		 JR NZ,NXB3 ;LOOP ALL BYTES    	;LOOP ALL BYTES
386)   03C2 C9          		 RET	;
388)   03C3 00          		RSTST: NOP ;GET A KEY FROM RS232	;GET A KEY FROM RS232
389)   03C4 06 0A       		 LD B,10	;
390)   03C6 C5          		TEN: PUSH BC	;
391)   03C7 CD 17 06    		 CALL RS_RX	;
393)   03CA CD FE 05    		 CALL RS_TX ;SEND BACK THE CHAR	;SEND BACK THE CHAR
395)   03CD 3E 20       		 LD A,' '	;
397)   03CF 3E 52       		 LD A,'R'	;
400)   03D1 CD EC 21    		 CALL DEL2	;
402)   03D4 C1          		 POP BC	;
403)   03D5 10 EF       		 DJNZ TEN	;
405)   03D7 AF          		 XOR A	;
406)   03D8 C9          		 RET	;
408)   03D9 00          		RSTST2: NOP ;TEST RECEIVING AND SENDING 255 BYTES	;TEST RECEIVING AND SENDING 255 BYTES
409)   03DA 06 FF       		 LD B,255	;
410)   03DC C5          		TEN2: PUSH BC	;
411)   03DD CD 17 06    		 CALL RS_RX	;
413)   03E0 CD FE 05    		 CALL RS_TX ;SEND BACK THE CHAR 	;SEND BACK THE CHAR
415)   03E3 C1          		 POP BC	;
416)   03E4 10 F6       		 DJNZ TEN2	;
417)   03E6 AF          		 XOR A	;
418)   03E7 C9          		 RET	;
421)   03E8 00          		XMTST: NOP ;TEST XMIT ALL 8 BITS	;TEST XMIT ALL 8 BITS
422)   03E9 06 FF       		 LD B,255	;
423)   03EB C5          		TEN3: PUSH BC	;
424)   03EC 78          		 LD A,B	;
425)   03ED CD FE 05    		 CALL RS_TX ;SEND THE BYTE	;SEND THE BYTE
426)   03F0 C1          		 POP BC	;
427)   03F1 10 F8       		 DJNZ TEN3	;
428)   03F3 AF          		 XOR A	;
429)   03F4 C9          		 RET	;
431)   03F5 C9          		TXTSCR: RET	;
438)   03F6 04          		@FF_OFF: INC B  ; DO 0-7 TO 1-8	; DO 0-7 TO 1-8
439)   03F7 AF          		      XOR A	;
440)   03F8 37          		      SCF	;
441)   03F9 17          		SBAGN: RLA        ; MOVE IT TO THE RIGHT PLACE	; MOVE IT TO THE RIGHT PLACE
442)   03FA 10 FD       		      DJNZ SBAGN	;
443)   03FC 2F          		      CPL     ;INVERSE BITS ON A	;INVERSE BITS ON A
444)   03FD 47          		      LD B,A	;
445)   03FE 21 9D 83    		      LD HL,FFSTAT	;
446)   0401 7E          		      LD A,(HL)	;
447)   0402 A0          		      AND B        ;ZERO THE BIT	;ZERO THE BIT
448)   0403 77          		      LD (HL),A	;
449)   0404 D3 08       		      OUT (DEVFFS),A	;
450)   0406 C9          		      RET	;
453)   0407 04          		@FF_ON: INC B  ; DO 0-7 TO 1-8	; DO 0-7 TO 1-8
454)   0408 AF          		      XOR A	;
455)   0409 37          		      SCF	;
456)   040A 17          		SBAGN: RLA        ; MOVE IT TO THE RIGHT PLACE	; MOVE IT TO THE RIGHT PLACE
457)   040B 10 FD       		      DJNZ SBAGN	;
458)   040D 47          		      LD B,A	;
459)   040E 21 9D 83    		      LD HL,FFSTAT	;
460)   0411 7E          		      LD A,(HL)	;
461)   0412 B0          		      OR B        ;SET THE BIT	;SET THE BIT
462)   0413 77          		      LD (HL),A	;
463)   0414 D3 08       		      OUT (DEVFFS),A	;
464)   0416 C9          		      RET	;
466)   0417 E5          		@EPROMOFF: PUSH HL	;
467)   0418 C5          		      PUSH BC	;
468)   0419 06 00       		      LD B,0	;
469)   041B CD F6 03    		      CALL FF_OFF	;
470)   041E C1          		      POP BC	;
471)   041F E1          		      POP HL	;
472)   0420 C9          		      RET	;
474)   0421 E5          		@EPROMON: PUSH HL	;
475)   0422 C5          		         PUSH BC	;
476)   0423 06 00       		     LD B,0	;
477)   0425 CD 07 04    		     CALL FF_ON	;
478)   0428 C1          		     POP BC	;
479)   0429 E1          		     POP HL	;
480)   042A C9          		     RET	;
486)   042B F5          		SOUTAS: PUSH AF  ;SERIAL PRINT ASCII IN DECIMAL	;SERIAL PRINT ASCII IN DECIMAL
487)   042C 26 00       		 LD H,0	;
488)   042E 6F          		 LD L,A	;
489)   042F 11 AC 83    		 LD DE,MYNUM	;
490)   0432 CD 06 22    		 CALL OUTASC	;
492)   0435 3E 0A       		 LD A,10	;
493)   0437 12          		 LD (DE),A	;
494)   0438 13          		 INC DE	;
495)   0439 3E 0D       		 LD A,13	;
496)   043B 12          		 LD (DE),A	;
497)   043C 13          		 INC DE	;
498)   043D AF          		 XOR A	;
499)   043E 12          		 LD (DE),A	;
501)   043F 21 AC 83    		 LD HL,MYNUM	;
502)   0442 CD 0D 06    		 CALL RS_TXT	;
503)   0445 F1          		 POP AF	;
504)   0446 C9          		 RET	;
509)   0447 41 54 4C 41 		SVER DEFM 'ATLAS OS V 2.04'	;
509)   044B 53 20 4F 53 		SVER DEFM 'ATLAS OS V 2.04'	;
509)   044F 20 56 20 32 		SVER DEFM 'ATLAS OS V 2.04'	;
509)   0453 2E 30 34    		SVER DEFM 'ATLAS OS V 2.04'	;
510)   0456 00          		 DB 0	;
512)   0457 55 49 3A 55 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   045B 50 20 4A 3A 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   045F 44 4E 20 58 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   0463 3A 52 55 4E 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   0467 20 54 59 48 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   046B 3A 52 53 20 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   046F 53 3A 44 49 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   0473 53 50 20 43 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   0477 3A 43 4C 53 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   047B 20 4C 3A 4C 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   047F 43 44 53 54 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   0483 20 42 3A 42 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
512)   0487 41 53 49 43 		SMENU DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS L:LCDST B:BASIC"	;
513)   048B 00          		 DB 0	;
515)   048C 4C 43 44 20 		STR0 DEFM "LCD INITIALIZED"	;
515)   0490 49 4E 49 54 		STR0 DEFM "LCD INITIALIZED"	;
515)   0494 49 41 4C 49 		STR0 DEFM "LCD INITIALIZED"	;
515)   0498 5A 45 44    		STR0 DEFM "LCD INITIALIZED"	;
516)   049B 00          		 DB 0	;
518)   049C 52 53 32 33 		STR1 DEFM "RS232 INIT"	;
518)   04A0 32 20 49 4E 		STR1 DEFM "RS232 INIT"	;
518)   04A4 49 54       		STR1 DEFM "RS232 INIT"	;
519)   04A6 00          		 DB 0	;
521)   04A7 50 52 4F 47 		STR2 DEFM "PROGRAM HALTED"	;
521)   04AB 52 41 4D 20 		STR2 DEFM "PROGRAM HALTED"	;
521)   04AF 48 41 4C 54 		STR2 DEFM "PROGRAM HALTED"	;
521)   04B3 45 44       		STR2 DEFM "PROGRAM HALTED"	;
522)   04B5 00          		 DB 0	;
524)   04B6 57 41 49 54 		STR02 DEFM "WAITING..."	;
524)   04BA 49 4E 47 2E 		STR02 DEFM "WAITING..."	;
524)   04BE 2E 2E       		STR02 DEFM "WAITING..."	;
525)   04C0 00          		 DB 0	;
527)   04C1 50 52 47 20 		DATTR DEFM "PRG TRANSFERED"	;
527)   04C5 54 52 41 4E 		DATTR DEFM "PRG TRANSFERED"	;
527)   04C9 53 46 45 52 		DATTR DEFM "PRG TRANSFERED"	;
527)   04CD 45 44       		DATTR DEFM "PRG TRANSFERED"	;
528)   04CF 00          		 DB 0	;
530)   04D0 52 45 43 45 		DATST DEFM "RECEIVING..."	;
530)   04D4 49 56 49 4E 		DATST DEFM "RECEIVING..."	;
530)   04D8 47 2E 2E 2E 		DATST DEFM "RECEIVING..."	;
531)   04DC 00          		 DB 0 	;
533)   04DD 50 52 47 20 		SPRGX DEFM "PRG EXECUTE"	;
533)   04E1 45 58 45 43 		SPRGX DEFM "PRG EXECUTE"	;
533)   04E5 55 54 45    		SPRGX DEFM "PRG EXECUTE"	;
534)   04E8 00          		 DB 0	;
536)   04E9 49 4D 41 47 		STIMG DEFM "IMAGE COPY"	;
536)   04ED 45 20 43 4F 		STIMG DEFM "IMAGE COPY"	;
536)   04F1 50 59       		STIMG DEFM "IMAGE COPY"	;
537)   04F3 00          		 DB 0	;
539)   04F4 53 43 52 45 		TXTMES DEFM "SCREEN READY"	;
539)   04F8 45 4E 20 52 		TXTMES DEFM "SCREEN READY"	;
539)   04FC 45 41 44 59 		TXTMES DEFM "SCREEN READY"	;
540)   0500 00          		 DB 0	;
542)   0501 55 49 3A 55 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0505 50 20 4A 3A 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0509 44 4E 20 58 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   050D 3A 52 55 4E 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0511 20 54 59 48 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0515 3A 52 53 20 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0519 53 3A 44 49 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   051D 53 50 20 43 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0521 3A 43 4C 53 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0525 20 42 3A 42 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
542)   0529 41 53 49 43 		STRMN DEFM "UI:UP J:DN X:RUN TYH:RS S:DISP C:CLS B:BASIC"	;
543)   052D 0A 0D 00    		 DB 10,13,0	;
545)   0530 43 4C 45 41 		STRSCR DEFM "CLEARING SCREEN."	;
545)   0534 52 49 4E 47 		STRSCR DEFM "CLEARING SCREEN."	;
545)   0538 20 53 43 52 		STRSCR DEFM "CLEARING SCREEN."	;
545)   053C 45 45 4E 2E 		STRSCR DEFM "CLEARING SCREEN."	;
546)   0540 0A 0D 00    		 DB 10,13,0	;
548)   0543 0A 0D       		STR00 DB 10,13	;
549)   0545 52 53 32 33 		 DEFM "RS232 INITIALIZED"	;
549)   0549 32 20 49 4E 		 DEFM "RS232 INITIALIZED"	;
549)   054D 49 54 49 41 		 DEFM "RS232 INITIALIZED"	;
549)   0551 4C 49 5A 45 		 DEFM "RS232 INITIALIZED"	;
549)   0555 44          		 DEFM "RS232 INITIALIZED"	;
550)   0556 0A 0D 00    		 DB 10,13,0	;
552)   0559 0A 0D       		STR01 DB 10,13	;
553)   055B 57 41 49 54 		 DEFM "WAITING..."	;
553)   055F 49 4E 47 2E 		 DEFM "WAITING..."	;
553)   0563 2E 2E       		 DEFM "WAITING..."	;
554)   0565 0A 0D 00    		 DB 10,13,0	;
555)   0568 00          		 DB 0	;
557)   0569 0A 0D       		STR06 DB 10,13	;
558)   056B 4B 45 59 20 		 DEFM "KEY PRESSED"	;
558)   056F 50 52 45 53 		 DEFM "KEY PRESSED"	;
558)   0573 53 45 44    		 DEFM "KEY PRESSED"	;
559)   0576 0A 0D 00    		 DB 10,13,0	;
560)   0579 00          		 DB 0	;
  3)   057A F3          		@INTSER:  DI	;
  4)   057B E5          		          PUSH HL	;
  5)   057C F5          		          PUSH AF	;
  6)   057D C5          		          PUSH BC	;
  7)   057E DD E5       		          PUSH IX	;
 11)   0580 DB 18       		          IN A,(DEVINP)	;
 12)   0582 2F          		          CPL	;
 13)   0583 E6 07       		          AND 0X07 ;BITS 0-2  	;BITS 0-2
 14)   0585 3D          		          DEC A  ;CONVERT 1-8 TO 0-7 NOT NEEDED ON NEW BOARD ONLY ON MY PROTOTYPE	;CONVERT 1-8 TO 0-7 NOT NEEDED ON NEW BOARD ONLY ON MY PROTOTYPE
 15)   0586 DD 21 A3 05 		          LD IX,MYINTADDR                    	;
 16)   058A 06 00       		          LD B,0	;
 17)   058C 4F          		          LD C,A	;
 18)   058D CB 21       		          SLA C ;DOUBLE THIS CAUSE 2 BYTES PER ADDR	;DOUBLE THIS CAUSE 2 BYTES PER ADDR
 19)   058F DD 09       		          ADD IX,BC	;
 20)   0591 DD 6E 00    		          LD L,(IX)	;
 21)   0594 DD 66 01    		          LD H,(IX+1)	;
 22)   0597 01 9C 05    		          LD BC,IS_EX	;
 23)   059A C5          		          PUSH BC ;RETURN ADDRESS	;RETURN ADDRESS
 24)   059B E9          		          JP (HL) ;JP TO HL	;JP TO HL
 26)   059C DD E1       		IS_EX:    POP IX	;
 27)   059E C1          		   POP BC	;
 28)   059F F1          		   POP AF	;
 29)   05A0 E1          		          POP HL	;
 30)   05A1 FB          		          EI	;
 31)   05A2 C9          		          RET 	;
 33)   05A3 BF 05       		MYINTADDR DEFW INT_TIMER	;
 34)   05A5 B3 05       		   DEFW SAVETE	;
 35)   05A7 BC 05       		   DEFW DOCLRINT	;
 36)   05A9 BC 05       		   DEFW DOCLRINT	;
 37)   05AB BC 05       		   DEFW DOCLRINT	;
 38)   05AD BC 05       		   DEFW DOCLRINT	;
 39)   05AF BC 05       		   DEFW DOCLRINT	;
 40)   05B1 BC 05       		   DEFW DOCLRINT                    	;
 42)   05B3 D3 40       		SAVETE   OUT (DEVINT),A  ;CLEAR THE INTERRUPT 	;CLEAR THE INTERRUPT
 43)   05B5 21 AB 83    		   LD HL,INT2TE    ;TEARING EFFECT	;TEARING EFFECT
 44)   05B8 3E 01       		   LD A,1	;
 45)   05BA 77          		   LD (HL),A;	;
 46)   05BB C9          		   RET	;
 49)   05BC D3 40       		DOCLRINT  OUT (DEVINT),A	;
 50)   05BE C9          		   RET	;
 52)   05BF D3 40       		INT_TIMER: OUT (DEVINT),A	;
 53)   05C1 21 A7 83    		          LD HL,TIMECTR	;
 54)   05C4 34          		          INC (HL)  	;
 55)   05C5 7E          		          LD A,(HL)	;
 56)   05C6 FE 00       		          CP 0	;
 57)   05C8 C0          		          RET NZ	;
 58)   05C9 23          		          INC HL	;
 59)   05CA 34          		          INC (HL)  	;
 60)   05CB 7E          		          LD A,(HL)	;
 61)   05CC FE 00       		          CP 0	;
 62)   05CE C0          		          RET NZ	;
 63)   05CF 23          		          INC HL	;
 64)   05D0 34          		          INC (HL)  	;
 65)   05D1 7E          		          LD A,(HL)	;
 66)   05D2 FE 00       		          CP 0	;
 67)   05D4 C0          		          RET NZ	;
 68)   05D5 23          		          INC HL	;
 69)   05D6 34          		          INC (HL)  	;
 70)   05D7 7E          		          LD A,(HL)	;
 71)   05D8 FE 00       		          CP 0	;
 72)   05DA C0          		          RET NZ  	;
 74)   05DB 21 00 00    		          LD HL,0	;
 75)   05DE 22 A7 83    		          LD (TIMECTR),HL	;
 76)   05E1 22 A9 83    		          LD (TIMECTR+2),HL	;
 77)   05E4 C9          		          RET	;
 15)   05E5 	            		 RBR EQU DEVSER+0 ;RECEIVER BUFFER REGISTER (READ ONLY) (DLAB = 0)	;RECEIVER BUFFER REGISTER (READ ONLY) (DLAB = 0)
 16)   05E5 	            		 THR EQU DEVSER+0 ;TRANSMITER HOLDING REGISTER (WRITE ONLY) (DLAB = 0)	;TRANSMITER HOLDING REGISTER (WRITE ONLY) (DLAB = 0)
 17)   05E5 	            		 IER EQU DEVSER+1 ;INTERRUPT ENABLE REGISTER (DLAB = 0)	;INTERRUPT ENABLE REGISTER (DLAB = 0)
 22)   05E5 	            		 IIR EQU DEVSER+2 ;INTERRUPT IDENT. REGISTER (READ ONLY)	;INTERRUPT IDENT. REGISTER (READ ONLY)
 27)   05E5 	            		 FCR EQU DEVSER+2 ;FIFO CONTROL REGISTER (WRITE ONLY)	;FIFO CONTROL REGISTER (WRITE ONLY)
 35)   05E5 	            		 LCR EQU DEVSER+3 ;LINE CONTROL REGISTER	;LINE CONTROL REGISTER
 43)   05E5 	            		 MCR EQU DEVSER+4 ;MODEM CONTROL REGISTER 	;MODEM CONTROL REGISTER
 44)   05E5 	            		 LSR EQU DEVSER+5 ;LINE STATUS REGISTER	;LINE STATUS REGISTER
 53)   05E5 	            		 MSR EQU DEVSER+6 ;MODEM STATUS REGISTER	;MODEM STATUS REGISTER
 54)   05E5 	            		 SCR EQU DEVSER+7 ;SCRATCH REGISTER	;SCRATCH REGISTER
 55)   05E5 	            		 DLL EQU DEVSER+0 ;DIVISOR LATCH (LEAST SIGNIFICANT BYTE) (DLAB = 1)	;DIVISOR LATCH (LEAST SIGNIFICANT BYTE) (DLAB = 1)
 56)   05E5 	            		 DLM EQU DEVSER+1 ;DIVISOR LATCH (MOST SIGNIFICANT BYTE) (DLAB = 1)	;DIVISOR LATCH (MOST SIGNIFICANT BYTE) (DLAB = 1)
 62)   05E5 F5          		RS_INI: PUSH AF	;
 63)   05E6 3E 80       		 LD     A,$80           ; Mask to set DLAB on	; Mask to set DLAB on
 64)   05E8 D3 23       		 OUT    (LCR),A         ; Send to LINe Control Register 	; Send to LINe Control Register
 73)   05EA F1          		  POP AF	;
 74)   05EB D3 20       		 OUT    (DLL),A         ; Set LSB of divisor	; Set LSB of divisor
 75)   05ED 3E 00       		 LD     A,00            ; This will be the MSB of the divisior	; This will be the MSB of the divisior
 76)   05EF D3 21       		 OUT    (DLM),A         ; Send to the MSB register	; Send to the MSB register
 77)   05F1 3E 03       		 LD     A,$03           ; 8 bits, 1 stop, no parity (and clear DLAB)	; 8 bits, 1 stop, no parity (and clear DLAB)
 78)   05F3 D3 23       		 OUT    (LCR),A         ; Write new value to LCR	; Write new value to LCR
 80)   05F5 3E 00       		 LD A, 0       	;
 81)   05F7 D3 22       		 OUT  (FCR),A      ;//was commented	;//was commented
 82)   05F9 3E 00       		 LD     A,$00           ; 5 A=0 Disable all INterrupts	; 5 A=0 Disable all INterrupts
 83)   05FB D3 21       		 OUT    (IER),A         ; Send to INterrupt Enable Register 	; Send to INterrupt Enable Register
 84)   05FD C9          		 RET	;
 87)   05FE CD 04 06    		RS_TX: CALL   RSTXRD	;
 88)   0601 D3 20       		       OUT     (THR),A	;
 90)   0603 C9          		       RET	;
 94)   0604 F5          		RSTXRD: PUSH   AF	;
 95)   0605 DB 25       		RSTXLP: IN     A,(LSR)         ; fetch the control register	; fetch the control register
 96)   0607 CB 6F       		       BIT     5,A             ; bit will be set if UART is ready	; bit will be set if UART is ready
 97)   0609 28 FA       		       JR      Z,RSTXLP	;
 98)   060B F1          		       POP     AF	;
 99)   060C C9          		       RET  	;
102)   060D 7E          		RS_TXT: LD A,(HL)	;
103)   060E 23          		 INC HL 	;
104)   060F FE 00       		 CP 0	;
105)   0611 C8          		 RET Z	;
106)   0612 CD FE 05    		       CALL RS_TX	;
107)   0615 18 F6       		 JR RS_TXT	;
114)   0617 F3          		RS_RX: DI	;
115)   0618 3E 01       		       LD A,1     ;ready to receive SIGNAL DSR 1	;ready to receive SIGNAL DSR 1
116)   061A D3 24       		       OUT (MCR),A	;
117)   061C CD 35 06    		   CALL    RSRXRD              	;
118)   061F AF          		RS_GTCH: XOR A     ;NOT ready to receive SIGNAL DSR 0	;NOT ready to receive SIGNAL DSR 0
119)   0620 D3 24       		       OUT (MCR),A        	;
121)   0622 DB 20       		      IN A,(RBR)	;
122)   0624 FB          		      EI	;
123)   0625 C9          		       RET	;
125)   0626 3E 01       		RS_RXNW:LD A,1    ;ready to receive SIGNAL DSR 1	;ready to receive SIGNAL DSR 1
126)   0628 D3 24       		       OUT (MCR),A	;
127)   062A DB 25       		   IN      A,(LSR)         ; fetch the conrtol register	; fetch the conrtol register
128)   062C CB 47       		       BIT     0,A                    	;
129)   062E 28 03       		       JR Z,RS_NOCHAR	;
130)   0630 F3          		       DI	;
131)   0631 18 EC       		       JR RS_GTCH        	;
132)   0633 AF          		RS_NOCHAR: XOR A ;RETURN ZERO	;RETURN ZERO
133)   0634 C9          		       RET	;
140)   0635 F3          		RSRXRD: DI	;
141)   0636 F5          		       PUSH    AF	;
142)   0637 DB 25       		RSRXLP: IN     A,(LSR)         ; fetch the conrtol register	; fetch the conrtol register
143)   0639 CB 47       		       BIT     0,A             ; bit will be set if UART has data	; bit will be set if UART has data
144)   063B 28 FA       		       JR      Z,RSRXLP	;
145)   063D F1          		       POP     AF	;
146)   063E FB          		       EI	;
147)   063F C9          		       RET  	;
151)   0640 DB 25       		RS_KEYRD:IN     A,(LSR)         ; fetch the conrtol register	; fetch the conrtol register
152)   0642 CB 47       		        BIT     0,A             ; bit will be set if UART has data        	; bit will be set if UART has data
153)   0644 C9          		        RET 	;
155)   0645 F5          		SHLCD: PUSH AF	;
157)   0646 F1          		 POP AF	;
159)   0647 C9          		 RET	;
163)   0648 F5          		CHKERR: PUSH AF	;
164)   0649 E5          		 PUSH HL	;
165)   064A C5          		 PUSH BC	;
166)   064B DB 25       		 IN A,(LSR)  ;FETCH LINE STATUS REGISTER	;FETCH LINE STATUS REGISTER
167)   064D CB 67       		 BIT 4,A	;
168)   064F 28 04       		 JR Z,LBLPE	;
169)   0651 3E 42       		 LD A,'B' ;$20 ;BREAK	;$20 ;BREAK
170)   0653 18 1A       		 JR EXIT	;
171)   0655 CB 57       		LBLPE: BIT 2,A 	;
172)   0657 28 04       		 JR Z,LBLFE	;
173)   0659 3E 50       		 LD A,'P' ;$40 ;PARITY	;$40 ;PARITY
174)   065B 18 12       		 JR EXIT	;
175)   065D CB 5F       		LBLFE: BIT 3,A	;
176)   065F 28 04       		 JR Z,LBLOE	;
177)   0661 3E 46       		 LD A,'F' ;$60 ;FRAME 	;$60 ;FRAME
178)   0663 18 0A       		 JR EXIT	;
179)   0665 CB 4F       		LBLOE: BIT 1,A	;
180)   0667 28 04       		 JR Z,LBLNE	;
181)   0669 3E 4F       		 LD A,'O' ;$80  ;OVERRUN	;$80  ;OVERRUN
182)   066B 18 02       		 JR EXIT	;
183)   066D 3E 4E       		LBLNE: LD A,'N' ;NO ERROR	;NO ERROR
184)   066F 21 9F 83    		EXIT: LD HL,SERERR	;
185)   0672 77          		 LD (HL),A	;
187)   0673 C1          		 POP BC	;
188)   0674 E1          		 POP HL	;
189)   0675 F1          		 POP AF	;
190)   0676 C9          		 RET	;
 14)   0677 	            		DEVKBI EQU DEVINP; INPUT FROM THE KEYBOARD IS ROUTED TO BITS 7,6(DAT,CLK) OF THE INPUT DEVICE 74LS257 CHIP	; INPUT FROM THE KEYBOARD IS ROUTED TO BITS 7,6(DAT,CLK) OF THE INPUT DEVICE 74LS257 CHIP
 17)   0677 06 01       		@KEYBCLKON: LD B,UKB_OUT_CLK	;
 18)   0679 CD F6 03    		      CALL FF_OFF	;
 19)   067C C9          		      RET	;
 21)   067D 06 01       		@KEYBCLKOFF: LD B,UKB_OUT_CLK	;
 22)   067F CD 07 04    		     CALL FF_ON	;
 23)   0682 C9          		     RET	;
 25)   0683 06 02       		@KEYBDATON: LD B,UKB_OUT_DAT	;
 26)   0685 CD F6 03    		      CALL FF_OFF	;
 27)   0688 C9          		      RET	;
 29)   0689 06 02       		@KEYBDATOFF: LD B,UKB_OUT_DAT	;
 30)   068B CD 07 04    		     CALL FF_ON	;
 31)   068E C9          		     RET	;
 33)   068F CD 77 06    		PS2ISK:CALL KEYBCLKON ;KEYBOARD ENABLED	;KEYBOARD ENABLED
 34)   0692 06 1E       		   LD B,30 ;CHECK SEVERAL TIMES 0.2 MS (30 ON 10mHZ)	;CHECK SEVERAL TIMES 0.2 MS (30 ON 10mHZ)
 35)   0694 DB 18       		CHAG: IN A,(DEVKBI)	;
 36)   0696 57          		   LD D,A	;
 37)   0697 CB 77       		   BIT UKB_IN_CLK,A ;CHECK BIT 6=CLOCK	;CHECK BIT 6=CLOCK
 38)   0699 28 08       		   JR Z,KEYOK	;
 39)   069B 10 F7       		   DJNZ CHAG	;
 41)   069D 3E 01       		PS2NTP: LD A,1 ;SET A TO 1 MEANS NO KEY AVAILABLE  	;SET A TO 1 MEANS NO KEY AVAILABLE
 42)   069F CD 7D 06    		   CALL KEYBCLKOFF	;
 43)   06A2 C9          		   RET	;
 44)   06A3 AF          		KEYOK: XOR A ;SET A TO 0 MEANS WE HAVE A KEY	;SET A TO 0 MEANS WE HAVE A KEY
 45)   06A4 C9          		   RET	;
 49)   06A5 06 32       		   LD B,50	;
 50)   06A7 B7          		   OR A   ;CLEAR CARRY	;CLEAR CARRY
 51)   06A8 DB 18       		WH1:IN A,(DEVKBI)	;
 52)   06AA 57          		   LD D,A    	;
 53)   06AB CB 77       		   BIT UKB_IN_CLK,A ;CHECK BIT 6=CLOCK	;CHECK BIT 6=CLOCK
 54)   06AD C0          		   RET NZ	;
 55)   06AE 10 F8       		   DJNZ WH1	;
 56)   06B0 37          		   SCF	;
 57)   06B1 C9          		   RET	;
 60)   06B2 06 32       		  LD B,50	;
 61)   06B4 B7          		  OR A    ;CLEAR CARRY	;CLEAR CARRY
 62)   06B5 DB 18       		WL1:IN A,(DEVKBI)	;
 63)   06B7 57          		   LD D,A    	;
 64)   06B8 CB 77       		   BIT UKB_IN_CLK,A ;CHECK BIT 6=CLOCK    	;CHECK BIT 6=CLOCK
 65)   06BA C8          		   RET Z	;
 66)   06BB 10 F8       		   DJNZ WL1	;
 67)   06BD 37          		   SCF	;
 68)   06BE C9          		   RET	;
 70)   06BF CD B2 06    		WAITFORLOW:CALL WAITFORLOW1	;
 71)   06C2 D8          		          RET C	;
 72)   06C3 DB 18       		           IN A,(DEVKBI);SOME MORE TIMES TO BE SURE	;SOME MORE TIMES TO BE SURE
 73)   06C5 DB 18       		           IN A,(DEVKBI)	;
 74)   06C7 57          		           LD D,A	;
 75)   06C8 C9          		           RET	;
 78)   06C9 F3          		@NEWBYTE:DI	;
 79)   06CA 7A          		   LD A,D ;BIT 7 HAS THE DATA	;BIT 7 HAS THE DATA
 80)   06CB CB 7F       		   BIT UKB_IN_DAT,A	;
 81)   06CD 20 2D       		   JR NZ,ERROR0 ;ALWAYS START WITH 0	;ALWAYS START WITH 0
 82)   06CF 06 08       		   LD B,8	;
 83)   06D1 48          		NXTBIT: LD C,B ;SAVE B	;SAVE B
 84)   06D2 CD A5 06    		   CALL WAITFORHIGH 	;
 85)   06D5 D8          		   RET C	;
 86)   06D6 CD BF 06    		   CALL WAITFORLOW	;
 87)   06D9 D8          		   RET C	;
 88)   06DA CB 27       		   SLA A ;BIT 7=DATA IS ON C FLAG	;BIT 7=DATA IS ON C FLAG
 89)   06DC CB 1B       		   RR E ;CARRY GOES TO BIT 7 OF E  	;CARRY GOES TO BIT 7 OF E
 90)   06DE 41          		   LD B,C  ;RESTORE C	;RESTORE C
 91)   06DF 10 F0       		   DJNZ NXTBIT	;
 92)   06E1 CD A5 06    		   CALL WAITFORHIGH 	;
 93)   06E4 D8          		   RET C	;
 94)   06E5 CD BF 06    		   CALL WAITFORLOW     	;
 95)   06E8 D8          		   RET C	;
 97)   06E9 CD A5 06    		   CALL WAITFORHIGH 	;
 98)   06EC D8          		   RET C	;
 99)   06ED CD BF 06    		   CALL WAITFORLOW 	;
100)   06F0 D8          		   RET C	;
101)   06F1 CB 7F       		   BIT UKB_IN_DAT,A	;
102)   06F3 28 10       		   JR Z,ERROR1 ;ALWAYS ENDS WITH 1  	;ALWAYS ENDS WITH 1
103)   06F5 CD A5 06    		   CALL WAITFORHIGH    ;WAIT FOR END OF TRANSMITION	;WAIT FOR END OF TRANSMITION
104)   06F8 D8          		   RET C	;
106)   06F9 7B          		   LD A,E	;
107)   06FA FB          		   EI	;
108)   06FB C9          		   RET	;
109)   06FC 21 11 07    		ERROR0: LD HL,MSER4	;
110)   06FF CD 0D 06    		   CALL RS_TXT	;
111)   0702 37          		   SCF ;FLAGS AN ERROR OCCURED	;FLAGS AN ERROR OCCURED
112)   0703 FB          		   EI	;
113)   0704 C9          		   RET	;
114)   0705 D5          		ERROR1:PUSH DE	;
115)   0706 21 34 07    		   LD HL,MSER5	;
116)   0709 CD 0D 06    		   CALL RS_TXT	;
117)   070C 37          		   SCF ;FLAGS AN ERROR OCCURED	;FLAGS AN ERROR OCCURED
118)   070D D1          		   POP DE	;
119)   070E 7B          		   LD A,E ;MAYBE IGNORE THIS	;MAYBE IGNORE THIS
120)   070F FB          		   EI	;
121)   0710 C9          		   RET	;
122)   0711 45 52 52 4F 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   0715 52 20 53 54 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   0719 41 52 54 20 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   071D 42 49 54 2E 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   0721 4E 4F 54 2E 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   0725 41 53 20 45 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   0729 58 50 45 43 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
122)   072D 54 45 44 2E 		MSER4 DEFM "ERROR START BIT NOT AS EXPECTED."	;
123)   0731 0A 0D 00    		   DB 10,13,0	;
124)   0734 45 52 52 4F 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   0738 52 20 53 54 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   073C 4F 50 20 42 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   0740 49 54 2E 4E 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   0744 4F 54 2E 41 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   0748 53 20 45 58 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   074C 50 45 43 54 		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
124)   0750 45 44 2E    		MSER5 DEFM "ERROR STOP BIT NOT AS EXPECTED."	;
125)   0753 0A 0D 00    		   DB 10,13,0	;
127)   0756 01 0A 00    		PS2KEY: LD BC,10       	;
128)   0759 0B          		PS2AGN DEC BC	;
129)   075A 78          		       LD A,B	;
130)   075B B1          		       OR C	;
131)   075C 28 0F       		       JR Z,PS2TIMEOUT	;
132)   075E C5          		       PUSH BC	;
133)   075F CD 8F 06    		       CALL PS2ISK	;
134)   0762 B7          		       OR A	;
135)   0763 C1          		       POP BC	;
136)   0764 20 F3       		       JR NZ, PS2AGN ;NO KEY YET	;NO KEY YET
138)   0766 CD C9 06    		       CALL NEWBYTE 	;
139)   0769 38 02       		       JR C,PS2TIMEOUT ;ERROR SO INVALIDATE A	;ERROR SO INVALIDATE A
140)   076B 18 02       		       JR PS2EX	;
141)   076D AF          		PS2TIMEOUT:XOR A ;0 CODE IS INVALID	;0 CODE IS INVALID
142)   076E FB          		          EI	;
143)   076F F5          		PS2EX  PUSH AF       	;
144)   0770 CD 7D 06    		       CALL KEYBCLKOFF	;
145)   0773 F1          		       POP AF	;
146)   0774 C9          		       RET	;
149)   0775 CD 7C 07    		READCHAR:CALL GTKEY	;
150)   0778 CD 3B 08    		      CALL PS2LOK	;
151)   077B C9          		      RET	;
154)   077C CD 56 07    		@GTKEY: CALL PS2KEY ;GET A KEY FROM PS2	;GET A KEY FROM PS2
155)   077F FE E1       		 CP $E1 ;BREAK KEY	;BREAK KEY
156)   0781 CC A8 07    		 CALL Z,GTBRK	;
157)   0784 FE F0       		 CP $F0 ;240 KEY RELEASED	;240 KEY RELEASED
158)   0786 CC EC 07    		 CALL Z,GTREL	;
159)   0789 FE E0       		 CP $E0 ;224 EXTENDED KEYS	;224 EXTENDED KEYS
160)   078B CC B2 07    		 CALL Z,GTEXT	;
163)   078E FE 12       		 CP 18 ;LEFT SHIFT	;LEFT SHIFT
164)   0790 CC 17 08    		 CALL Z,SHFTOG	;
165)   0793 FE 59       		 CP 89 ;RIGHT SHIFT	;RIGHT SHIFT
166)   0795 CC 17 08    		 CALL Z,SHFTOG	;
167)   0798 FE 14       		 CP 20 ;RIGHT CONTROL	;RIGHT CONTROL
168)   079A CC 20 08    		 CALL Z,CTRTOG 	;
169)   079D FE 11       		 CP 17 ;LEFT ALT	;LEFT ALT
170)   079F CC 29 08    		 CALL Z,ALTTOG	;
171)   07A2 FE 58       		 CP $58 ;CAPS LOCK	;CAPS LOCK
172)   07A4 CC 32 08    		 CALL Z,CAPSTOG	;
175)   07A7 C9          		 RET	;
177)   07A8 CD 56 07    		GTBRK: CALL PS2KEY ;$14 OR $F0	;$14 OR $F0
178)   07AB FE F0       		 CP $F0	;
179)   07AD C8          		 RET Z	;
180)   07AE CD 56 07    		 CALL PS2KEY ;$77	;$77
181)   07B1 C9          		 RET	;
183)   07B2 CD 56 07    		GTEXT: CALL PS2KEY ; THIS IS THE EXTENDED KEY	; THIS IS THE EXTENDED KEY
184)   07B5 FE 6B       		 CP $6B ;LEFT	;LEFT
185)   07B7 C8          		 RET Z	;
186)   07B8 FE 72       		 CP $72 ;DOWN	;DOWN
187)   07BA C8          		 RET Z	;
188)   07BB FE 74       		 CP $74 ;RIGHT	;RIGHT
189)   07BD C8          		 RET Z	;
190)   07BE FE 75       		 CP $75 ;UP	;UP
191)   07C0 C8          		 RET Z	;
192)   07C1 FE 70       		 CP $70 ;INSERT	;INSERT
193)   07C3 C8          		 RET Z	;
194)   07C4 FE 6C       		 CP $6C ;HOME	;HOME
195)   07C6 C8          		 RET Z	;
196)   07C7 FE 7D       		 CP $7D ;PG UP	;PG UP
197)   07C9 C8          		 RET Z	;
198)   07CA FE 7A       		 CP $7A ;PG DN	;PG DN
199)   07CC C8          		 RET Z	;
200)   07CD FE 69       		 CP $69 ;END	;END
201)   07CF C8          		 RET Z	;
202)   07D0 FE 71       		 CP $71 ;DEL	;DEL
203)   07D2 C8          		 RET Z	;
204)   07D3 FE 66       		 CP $66  ;BACKSPACE	;BACKSPACE
205)   07D5 C8          		 RET Z	;
206)   07D6 FE 5A       		 CP $5A ;ENTER NUM	;ENTER NUM
207)   07D8 C8          		 RET Z	;
208)   07D9 FE 11       		 CP $11 ;RIGHT ALT	;RIGHT ALT
209)   07DB C8          		 RET Z	;
210)   07DC FE 14       		 CP $14 ;LEFT ALT	;LEFT ALT
211)   07DE C8          		 RET Z	;
212)   07DF FE 4A       		 CP $4A ;NUMLOCK /	;NUMLOCK /
213)   07E1 C8          		 RET Z	;
214)   07E2 FE F0       		 CP $F0	;
215)   07E4 C2 EA 07    		 JP NZ, EXGTEX ;GTREL ;EXTENDED KEY RELEASED $E0 $F0 $KEY	;GTREL ;EXTENDED KEY RELEASED $E0 $F0 $KEY
216)   07E7 CD 56 07    		 CALL PS2KEY ; THIS IS THE EXTENDED RELEASED KEY JUST IGNORE IT	; THIS IS THE EXTENDED RELEASED KEY JUST IGNORE IT
218)   07EA AF          		EXGTEX XOR A ;NOT VALID EXTENDED KEY	;NOT VALID EXTENDED KEY
219)   07EB C9          		 RET	;
222)   07EC CD 56 07    		GTREL: CALL PS2KEY ; THIS IS THE RELEASED KEY	; THIS IS THE RELEASED KEY
223)   07EF FE 12       		 CP 18 ; LSHIFT RELEASED	; LSHIFT RELEASED
224)   07F1 CC 05 08    		 CALL Z,SHFRES ; RESET SHIFT	; RESET SHIFT
225)   07F4 FE 14       		 CP 20 ; LCTRL RELEASED	; LCTRL RELEASED
226)   07F6 CC 0B 08    		 CALL Z,CTRRES ; RESET CONTROL	; RESET CONTROL
227)   07F9 FE 11       		 CP 17 ; LALT RELEASED	; LALT RELEASED
228)   07FB CC 11 08    		 CALL Z,ALTRES ; RESET ALT	; RESET ALT
229)   07FE FE 59       		 CP 89 ; RSHIFT RELEASED	; RSHIFT RELEASED
230)   0800 CC 05 08    		 CALL Z,SHFRES ; RESET SHIFT	; RESET SHIFT
231)   0803 AF          		 XOR A ; NO KEY	; NO KEY
232)   0804 C9          		 RET	;
234)   0805 21 9E 83    		SHFRES: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH 	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
235)   0808 CB B6       		 RES 6,(HL)  ; BIT 6 IS SHIFT $40=64	; BIT 6 IS SHIFT $40=64
236)   080A C9          		 RET	;
238)   080B 21 9E 83    		CTRRES: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
239)   080E CB BE       		 RES 7,(HL) ; BIT 7 IS CTRL $80=128	; BIT 7 IS CTRL $80=128
240)   0810 C9          		 RET	;
242)   0811 21 9E 83    		ALTRES: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
243)   0814 CB AE       		 RES 5,(HL) ; BIT 5 IS SHIFT $20=32 	; BIT 5 IS SHIFT $20=32
244)   0816 C9          		 RET	;
246)   0817 21 9E 83    		SHFTOG: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH 	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
247)   081A 3E 40       		 LD A,$40 ; MASK	; MASK
248)   081C AE          		 XOR (HL)  ; BIT 6 IS SHIFT $40=64	; BIT 6 IS SHIFT $40=64
249)   081D 77          		 LD (HL),A ; SAVE	; SAVE
250)   081E AF          		 XOR A ; NO KEY	; NO KEY
251)   081F C9          		 RET	;
253)   0820 21 9E 83    		CTRTOG: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
254)   0823 3E 80       		 LD A,$80 ; MASK	; MASK
255)   0825 AE          		 XOR (HL) ; BIT 7 IS CTRL $80=128	; BIT 7 IS CTRL $80=128
256)   0826 77          		 LD (HL),A ; SAVE	; SAVE
257)   0827 AF          		 XOR A ; NO KEY	; NO KEY
258)   0828 C9          		 RET	;
260)   0829 21 9E 83    		ALTTOG: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH
261)   082C 3E 20       		 LD A,$20	;
262)   082E AE          		 XOR (HL) ; BIT 5 IS ALT $20=32 	; BIT 5 IS ALT $20=32
263)   082F 77          		 LD (HL),A ; SAVE	; SAVE
264)   0830 AF          		 XOR A ; NO KEY	; NO KEY
265)   0831 C9          		 RET	;
267)   0832 21 9E 83    		CAPSTOG: LD HL,KEYCTR ;KEYBOARD FLAGS SHFT,CONTROL,GRAPH,CAPS	;KEYBOARD FLAGS SHFT,CONTROL,GRAPH,CAPS
268)   0835 3E 10       		 LD A,$10	;
269)   0837 AE          		 XOR (HL) ; BIT 4 IS CAPS $10=16 	; BIT 4 IS CAPS $10=16
270)   0838 77          		 LD (HL),A ; SAVE	; SAVE
271)   0839 AF          		 XOR A ; NO KEY	; NO KEY
272)   083A C9          		 RET	;
276)   083B 21 9E 83    		 LD HL,KEYCTR	;
277)   083E 47          		 LD B,A  ; SAVE A	; SAVE A
278)   083F 7E          		 LD A,(HL); GET KEYBFLAGS ON A SHIFT	; GET KEYBFLAGS ON A SHIFT
279)   0840 4F          		 LD C,A  ;CAPS ON C	;CAPS ON C
280)   0841 CB 1F       		 RR A	;
281)   0843 CB 1F       		 RR A    ;2 ROTATIONS RIGHT SHIFT BECOMES BIT 4 FROM 6	;2 ROTATIONS RIGHT SHIFT BECOMES BIT 4 FROM 6
282)   0845 A9          		 XOR C   ;XOR SHIFT WITH CAPS	;XOR SHIFT WITH CAPS
283)   0846 CB 67       		 BIT 4,A ;CHECK IF BIT 4 IS 0 = UNSHIFTED	;CHECK IF BIT 4 IS 0 = UNSHIFTED
284)   0848 78          		 LD A,B  ;RESTORE A	;RESTORE A
289)   0849 21 57 08    		 LD HL,PS2TAB1 ;UNSHIFTED	;UNSHIFTED
290)   084C 28 03       		 JR Z,PLK1	;
291)   084E 21 01 09    		 LD HL,PS2TAB2 ;SHIFTED	;SHIFTED
292)   0851 06 00       		PLK1:  LD B,0	;
293)   0853 4F          		 LD C,A	;
294)   0854 09          		 ADD HL,BC       	;
295)   0855 7E          		 LD A,(HL) ;GET THE CHAR	;GET THE CHAR
296)   0856 C9          		 RET	;
300)   0857 00 00 00 00 		PS2TAB1 DB 0,0,0,0,0,0,0,0,0,0	;
300)   085B 00 00 00 00 		PS2TAB1 DB 0,0,0,0,0,0,0,0,0,0	;
300)   085F 00 00       		PS2TAB1 DB 0,0,0,0,0,0,0,0,0,0	;
301)   0861 00 00 00 00 		      DB 0,0,0,0,'`',0,0,0,0,0	;
301)   0865 60 00 00 00 		      DB 0,0,0,0,'`',0,0,0,0,0	;
301)   0869 00 00       		      DB 0,0,0,0,'`',0,0,0,0,0	;
302)   086B 00 71 31 00 		      DB 0,'q','1',0,0,0,'z','s','a','w'	;
302)   086F 00 00 7A 73 		      DB 0,'q','1',0,0,0,'z','s','a','w'	;
302)   0873 61 77       		      DB 0,'q','1',0,0,0,'z','s','a','w'	;
303)   0875 32 00 00 63 		      DB '2',0,0,'c','x','d','e','4','3',0	;
303)   0879 78 64 65 34 		      DB '2',0,0,'c','x','d','e','4','3',0	;
303)   087D 33 00       		      DB '2',0,0,'c','x','d','e','4','3',0	;
304)   087F 00 20 76 66 		      DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
304)   0883 74 72 35 00 		      DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
304)   0887 00 6E       		      DB 0,' ','v','f','t','r','5',0,0,'n'     ;40-49	;40-49
305)   0889 62 68 67 6D 		      DB 'b','h','g','m','6',0,0,44,'m','j'     ;50-59	;50-59
305)   088D 36 00 00 2C 		      DB 'b','h','g','m','6',0,0,44,'m','j'     ;50-59	;50-59
305)   0891 6D 6A       		      DB 'b','h','g','m','6',0,0,44,'m','j'     ;50-59	;50-59
306)   0893 75 37 38 00 		      DB 'u','7','8',0,0,',','k','i','o','0'   ;60-69	;60-69
306)   0897 00 2C 6B 69 		      DB 'u','7','8',0,0,',','k','i','o','0'   ;60-69	;60-69
306)   089B 6F 30       		      DB 'u','7','8',0,0,',','k','i','o','0'   ;60-69	;60-69
307)   089D 39 00 00 2E 		      DB '9',0,0,'.','/','l',59,'p','-',0       ;70-79	;70-79
307)   08A1 2F 6C 3B 70 		      DB '9',0,0,'.','/','l',59,'p','-',0       ;70-79	;70-79
307)   08A5 2D 00       		      DB '9',0,0,'.','/','l',59,'p','-',0       ;70-79	;70-79
308)   08A7 00 00 27 00 		      DB 0,0,39,0,'[','=',0,0,0,0               ;80-89	;80-89
308)   08AB 5B 3D 00 00 		      DB 0,0,39,0,'[','=',0,0,0,0               ;80-89	;80-89
308)   08AF 00 00       		      DB 0,0,39,0,'[','=',0,0,0,0               ;80-89	;80-89
309)   08B1 0D 5D 00 5C 		      DB 13,']',0,'\',0,0,0,0,0,0               ;90-99	;90-99
309)   08B5 00 00 00 00 		      DB 13,']',0,'\',0,0,0,0,0,0               ;90-99	;90-99
309)   08B9 00 00       		      DB 13,']',0,'\',0,0,0,0,0,0               ;90-99	;90-99
310)   08BB 00 00 06 00 		      DB 0,0,6,0,0,8,0,4,9,0                    ;100-109   	;100-109
310)   08BF 00 08 00 04 		      DB 0,0,6,0,0,8,0,4,9,0                    ;100-109   	;100-109
310)   08C3 09 00       		      DB 0,0,6,0,0,8,0,4,9,0                    ;100-109   	;100-109
311)   08C5 00 00 01 07 		      DB 0,0,1,7,10,0,3,11,ESC,0                ;110-119 	;110-119
311)   08C9 0A 00 03 0B 		      DB 0,0,1,7,10,0,3,11,ESC,0                ;110-119 	;110-119
311)   08CD 1B 00       		      DB 0,0,1,7,10,0,3,11,ESC,0                ;110-119 	;110-119
312)   08CF 00 00 2B 2D 		      DB 0,0,'+','-','*','9',0,0,0,0            ;120-129	;120-129
312)   08D3 2A 39 00 00 		      DB 0,0,'+','-','*','9',0,0,0,0            ;120-129	;120-129
312)   08D7 00 00       		      DB 0,0,'+','-','*','9',0,0,0,0            ;120-129	;120-129
313)   08D9 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                 ;130-139	;130-139
313)   08DD 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                 ;130-139	;130-139
313)   08E1 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                 ;130-139	;130-139
314)   08E3 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;140-149	;140-149
314)   08E7 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;140-149	;140-149
314)   08EB 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                    ;140-149	;140-149
315)   08ED 00 00 00 00 		       DB 0,0,0,0,0,0,0,0,0,0                  ;150-159	;150-159
315)   08F1 00 00 00 00 		       DB 0,0,0,0,0,0,0,0,0,0                  ;150-159	;150-159
315)   08F5 00 00       		       DB 0,0,0,0,0,0,0,0,0,0                  ;150-159	;150-159
316)   08F7 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;160-169	;160-169
316)   08FB 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;160-169	;160-169
316)   08FF 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                    ;160-169	;160-169
319)   0901 00 00 00 00 		PS2TAB2 DB 0,0,0,0,0,0,0,0,0,0	;
319)   0905 00 00 00 00 		PS2TAB2 DB 0,0,0,0,0,0,0,0,0,0	;
319)   0909 00 00       		PS2TAB2 DB 0,0,0,0,0,0,0,0,0,0	;
320)   090B 00 00 00 00 		      DB 0,0,0,0,'~',0,0,0,0,0	;
320)   090F 7E 00 00 00 		      DB 0,0,0,0,'~',0,0,0,0,0	;
320)   0913 00 00       		      DB 0,0,0,0,'~',0,0,0,0,0	;
321)   0915 00 51 21 00 		      DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
321)   0919 00 00 5A 53 		      DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
321)   091D 41 57       		      DB 0,'Q','!',0,0,0,'Z','S','A','W'	;
322)   091F 40 00 00 43 		      DB '@',0,0,'C','X','D','E','$','#',0	;
322)   0923 58 44 45 24 		      DB '@',0,0,'C','X','D','E','$','#',0	;
322)   0927 23 00       		      DB '@',0,0,'C','X','D','E','$','#',0	;
323)   0929 00 20 56 46 		      DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
323)   092D 54 52 25 00 		      DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
323)   0931 00 4E       		      DB 0,' ','V','F','T','R','%',0,0,'N'     ;40-49	;40-49
324)   0933 42 48 47 59 		      DB 'B','H','G','Y','^',0,0,'"','M','J'   ;50-59	;50-59
324)   0937 5E 00 00 22 		      DB 'B','H','G','Y','^',0,0,'"','M','J'   ;50-59	;50-59
324)   093B 4D 4A       		      DB 'B','H','G','Y','^',0,0,'"','M','J'   ;50-59	;50-59
325)   093D 55 5E 2A 00 		      DB 'U','^','*',0,0,'<','K','I','O',')'   ;60-69	;60-69
325)   0941 00 3C 4B 49 		      DB 'U','^','*',0,0,'<','K','I','O',')'   ;60-69	;60-69
325)   0945 4F 29       		      DB 'U','^','*',0,0,'<','K','I','O',')'   ;60-69	;60-69
326)   0947 28 00 00 3E 		      DB '(',0,0,'>','?','L',':','P','_',0      ;70-79	;70-79
326)   094B 3F 4C 3A 50 		      DB '(',0,0,'>','?','L',':','P','_',0      ;70-79	;70-79
326)   094F 5F 00       		      DB '(',0,0,'>','?','L',':','P','_',0      ;70-79	;70-79
327)   0951 00 00 22 00 		      DB 0,0,34,0,'{','+',0,0,0,0               ;80-89	;80-89
327)   0955 7B 2B 00 00 		      DB 0,0,34,0,'{','+',0,0,0,0               ;80-89	;80-89
327)   0959 00 00       		      DB 0,0,34,0,'{','+',0,0,0,0               ;80-89	;80-89
328)   095B 0D 7D 00 7C 		      DB 13,'}',0,'|',0,0,0,0,0,0               ;90-99	;90-99
328)   095F 00 00 00 00 		      DB 13,'}',0,'|',0,0,0,0,0,0               ;90-99	;90-99
328)   0963 00 00       		      DB 13,'}',0,'|',0,0,0,0,0,0               ;90-99	;90-99
329)   0965 00 00 06 00 		      DB 0,0,6,0,0,8,0,4,9,0                    ;100-109   	;100-109
329)   0969 00 08 00 04 		      DB 0,0,6,0,0,8,0,4,9,0                    ;100-109   	;100-109
329)   096D 09 00       		      DB 0,0,6,0,0,8,0,4,9,0                    ;100-109   	;100-109
330)   096F 00 00 01 07 		      DB 0,0,1,7,10,0,3,11,ESC,0                ;110-119 	;110-119
330)   0973 0A 00 03 0B 		      DB 0,0,1,7,10,0,3,11,ESC,0                ;110-119 	;110-119
330)   0977 1B 00       		      DB 0,0,1,7,10,0,3,11,ESC,0                ;110-119 	;110-119
331)   0979 00 00 2B 2D 		      DB 0,0,'+','-','*','9',0,0,0,0            ;120-129	;120-129
331)   097D 2A 39 00 00 		      DB 0,0,'+','-','*','9',0,0,0,0            ;120-129	;120-129
331)   0981 00 00       		      DB 0,0,'+','-','*','9',0,0,0,0            ;120-129	;120-129
332)   0983 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                 ;130-139	;130-139
332)   0987 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                 ;130-139	;130-139
332)   098B 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                 ;130-139	;130-139
333)   098D 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;140-149	;140-149
333)   0991 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;140-149	;140-149
333)   0995 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                    ;140-149	;140-149
334)   0997 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                  ;150-159	;150-159
334)   099B 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                  ;150-159	;150-159
334)   099F 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                  ;150-159	;150-159
335)   09A1 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;160-169	;160-169
335)   09A5 00 00 00 00 		      DB 0,0,0,0,0,0,0,0,0,0                    ;160-169	;160-169
335)   09A9 00 00       		      DB 0,0,0,0,0,0,0,0,0,0                    ;160-169	;160-169
 16)   09AB 	            		      LCD_RS EQU DEVTFT;  ;PORT TO CONTROL RS PIN 16=cs+rs+low = COMMAND  A0 CONNECT TO RS	;  ;PORT TO CONTROL RS PIN 16=cs+rs+low = COMMAND  A0 CONNECT TO RS
 17)   09AB 	            		      LCD_CS EQU DEVTFT+1;  ;PORT TO CONTROL CS PIN 17=cs+rs_high  = DATA	;  ;PORT TO CONTROL CS PIN 17=cs+rs_high  = DATA
 31)   09AB 7B          		   LD A,E	;
 32)   09AC D3 11       		   OUT (LCD_CS),A	;
 37)   09AE DB 11       		   IN A,(LCD_CS)	;
 38)   09B0 C9          		   RET	;
 45)   09B1 7A          		   LD A,D  	;
 46)   09B2 D3 11       		   OUT (LCD_CS),A	;
 47)   09B4 C9          		   RET	;
 53)   09B5 7A          		   LD A,D  	;
 54)   09B6 D3 10       		   OUT (LCD_RS),A	;
 55)   09B8 C9          		   RET	;
 62)   09B9 AF          		   XOR A	;
 63)   09BA D3 10       		   OUT (LCD_RS),A  ;RS LOW = COMMAND BYTE      	;RS LOW = COMMAND BYTE
 64)   09BC CD B1 09    		   CALL LCD_WR_BUS	;
 65)   09BF 3E 01       		   LD A,1	;
 66)   09C1 D3 10       		   OUT (LCD_RS),A  ;RS HIGH  = DATA BYTE	;RS HIGH  = DATA BYTE
 67)   09C3 C9          		   RET	;
 71)   09C4 16 E2       		   LD D,0xE2         ;PLL multiplier, set PLL clock to 120M	;PLL multiplier, set PLL clock to 120M
 72)   09C6 CD B5 09    		   CALL LCD_WR_COM   ;N=0x36 for 6.5M, 0x23 for 10M crystal	;N=0x36 for 6.5M, 0x23 for 10M crystal
 73)   09C9 16 23       		   LD D,0x23 ;1E	;1E
 74)   09CB CD B1 09    		   CALL LCD_WR_DAT	;
 75)   09CE 16 02       		   LD D,0x02	;
 76)   09D0 CD B1 09    		   CALL LCD_WR_DAT	;
 77)   09D3 16 54       		   LD D,0x54	;
 78)   09D5 CD B1 09    		   CALL LCD_WR_DAT	;
 79)   09D8 16 E0       		   LD D,0xE0         ; PLL enable    	; PLL enable
 80)   09DA CD B5 09    		   CALL LCD_WR_COM	;
 81)   09DD 16 01       		   LD D,0x01	;
 82)   09DF CD B1 09    		   CALL LCD_WR_DAT	;
 83)   09E2 06 0A       		   LD B,10        ;delay(10);	;delay(10);
 84)   09E4 CD D9 21    		   CALL DELAYMICRO	;
 85)   09E7 16 E0       		   LD D,0xE0         ; PLL enable    	; PLL enable
 86)   09E9 CD B5 09    		   CALL LCD_WR_COM   	;
 87)   09EC 16 03       		   LD D,0x03	;
 88)   09EE CD B1 09    		   CALL LCD_WR_DAT	;
 89)   09F1 06 0A       		   LD B,10        ;delay(10);	;delay(10);
 90)   09F3 CD D9 21    		   CALL DELAYMICRO    	;
 92)   09F6 16 01       		   LD D,0x01         ; software reset  	; software reset
 93)   09F8 CD B5 09    		   CALL LCD_WR_COM   	;
 94)   09FB 06 14       		   LD B,20       ;delay(20); MICROSECS	;delay(20); MICROSECS
 95)   09FD CD D9 21    		   CALL DELAYMICRO        	;
 96)   0A00 16 E6       		   LD D,0xE6         ;PLL setting for PCLK, depends on resolution  	;PLL setting for PCLK, depends on resolution
 97)   0A02 CD B5 09    		   CALL LCD_WR_COM           	;
 98)   0A05 16 03       		   LD D,0x03	;
 99)   0A07 CD B1 09    		   CALL LCD_WR_DAT   	;
100)   0A0A 16 33       		   LD D,0x33 ;FF	;FF
101)   0A0C CD B1 09    		   CALL LCD_WR_DAT       	;
102)   0A0F 16 33       		   LD D,0x33 ;FF	;FF
103)   0A11 CD B1 09    		   CALL LCD_WR_DAT   	;
105)   0A14 16 B0       		   LD D,0xB0         ;LCD SPECIFICATION	;LCD SPECIFICATION
106)   0A16 CD B5 09    		   CALL LCD_WR_COM       	;
107)   0A19 16 20       		   LD D,0x20	;
108)   0A1B CD B1 09    		   CALL LCD_WR_DAT   	;
109)   0A1E 16 00       		   LD D,0x00	;
110)   0A20 CD B1 09    		   CALL LCD_WR_DAT       	;
111)   0A23 16 03       		   LD D,0x03         ;Set HDP  799	;Set HDP  799
112)   0A25 CD B1 09    		   CALL LCD_WR_DAT   	;
113)   0A28 16 1F       		   LD D,0x1F	;
114)   0A2A CD B1 09    		   CALL LCD_WR_DAT   	;
115)   0A2D 16 01       		   LD D,0x01         ;Set VDP  479	;Set VDP  479
116)   0A2F CD B1 09    		   CALL LCD_WR_DAT   	;
117)   0A32 16 DF       		   LD D,0xDF	;
118)   0A34 CD B1 09    		   CALL LCD_WR_DAT 	;
119)   0A37 16 00       		   LD D,0x00	;
120)   0A39 CD B1 09    		   CALL LCD_WR_DAT     	;
123)   0A3C 16 B4       		   LD D,0xB4         ;HSYNC	;HSYNC
124)   0A3E CD B5 09    		   CALL LCD_WR_COM       	;
125)   0A41 16 04       		   LD D,0x04 ;03         ;Set HT 928	;03         ;Set HT 928
126)   0A43 CD B1 09    		   CALL LCD_WR_DAT   	;
127)   0A46 16 1F       		   LD D,0x1F ;A0	;A0
128)   0A48 CD B1 09    		   CALL LCD_WR_DAT       	;
129)   0A4B 16 00       		   LD D,0x00         ;Set HPS  46	;Set HPS  46
130)   0A4D CD B1 09    		   CALL LCD_WR_DAT   	;
131)   0A50 16 D2       		   LD D,0xD2 ;2E	;2E
132)   0A52 CD B1 09    		   CALL LCD_WR_DAT   	;
133)   0A55 16 00       		   LD D,0x00 ;30         ;Set HPW  48	;30         ;Set HPW  48
134)   0A57 CD B1 09    		   CALL LCD_WR_DAT   	;
135)   0A5A 16 00       		   LD D,0x00         ;Set LPS  15	;Set LPS  15
136)   0A5C CD B1 09    		   CALL LCD_WR_DAT 	;
137)   0A5F 16 00       		   LD D,0x00 ;0F	;0F
138)   0A61 CD B1 09    		   CALL LCD_WR_DAT   	;
139)   0A64 16 00       		   LD D,0x00	;
140)   0A66 CD B1 09    		   CALL LCD_WR_DAT     	;
142)   0A69 16 B6       		   LD D,0xB6         ;VSYNC	;VSYNC
143)   0A6B CD B5 09    		   CALL LCD_WR_COM       	;
144)   0A6E 16 02       		   LD D,0x02         ;Set VT 525	;Set VT 525
145)   0A70 CD B1 09    		   CALL LCD_WR_DAT   	;
146)   0A73 16 0C       		   LD D,0x0C ;0D	;0D
147)   0A75 CD B1 09    		   CALL LCD_WR_DAT       	;
148)   0A78 16 00       		   LD D,0x00         ;Set VPS  16	;Set VPS  16
149)   0A7A CD B1 09    		   CALL LCD_WR_DAT   	;
150)   0A7D 16 22       		   LD D,0x22 ;10	;10
151)   0A7F CD B1 09    		   CALL LCD_WR_DAT   	;
152)   0A82 16 00       		   LD D,0x00 ;10         ;Set VPW  16	;10         ;Set VPW  16
153)   0A84 CD B1 09    		   CALL LCD_WR_DAT   	;
154)   0A87 16 00       		   LD D,0x00         ;Set FPS  8	;Set FPS  8
155)   0A89 CD B1 09    		   CALL LCD_WR_DAT 	;
156)   0A8C 16 00       		   LD D,0x00 ; 08	; 08
157)   0A8E CD B1 09    		   CALL LCD_WR_DAT   	;
159)   0A91 16 B8       		   LD D,0xB8         	;
160)   0A93 CD B5 09    		   CALL LCD_WR_COM           	;
161)   0A96 16 0F       		   LD D,0x0F ;07         ;GPIO3=input, GPIO[2:0]=output	;07         ;GPIO3=input, GPIO[2:0]=output
162)   0A98 CD B1 09    		   CALL LCD_WR_DAT         	;
163)   0A9B 16 01       		   LD D,0x01         ;GPIO0 normal	;GPIO0 normal
164)   0A9D CD B1 09    		   CALL LCD_WR_DAT 	;
166)   0AA0 16 BA       		   LD D,0xBA         	;
167)   0AA2 CD B5 09    		   CALL LCD_WR_COM           	;
168)   0AA5 16 01       		   LD D,0x01 ;0F	;0F
169)   0AA7 CD B1 09    		   CALL LCD_WR_DAT   ;GPIO[3:0] out 1	;GPIO[3:0] out 1
171)   0AAA 16 36       		   LD D,0x36         ;rotation	;rotation
172)   0AAC CD B5 09    		   CALL LCD_WR_COM           	;
173)   0AAF 16 08       		   LD D,0x08 ;2A         	;2A
174)   0AB1 CD B1 09    		   CALL LCD_WR_DAT         	;
176)   0AB4 16 F0       		   LD D,0xF0         ;pixel data interface	;pixel data interface
177)   0AB6 CD B5 09    		   CALL LCD_WR_COM           	;
178)   0AB9 16 06       		   LD D,0x06         ;CHANGE THIS FOR 8 BIT INTERFACE  6=9BIT SEND 2 BYTES 	;CHANGE THIS FOR 8 BIT INTERFACE  6=9BIT SEND 2 BYTES
179)   0ABB CD B1 09    		   CALL LCD_WR_DAT     	;
181)   0ABE 06 05       		   LD B,5       ;delay(5);	;delay(5);
182)   0AC0 CD D9 21    		   CALL DELAYMICRO        	;
184)   0AC3 16 BC       		   LD D,0xBC          ;SET THE IMAGE POST PROCESSOR	;SET THE IMAGE POST PROCESSOR
185)   0AC5 CD B5 09    		   CALL LCD_WR_COM           	;
186)   0AC8 16 40       		   LD D,0x40	;
187)   0ACA CD B1 09    		   CALL LCD_WR_DAT   	;
188)   0ACD 16 80       		   LD D,0x80	;
189)   0ACF CD B1 09    		   CALL LCD_WR_DAT   	;
190)   0AD2 16 40       		   LD D,0x40	;
191)   0AD4 CD B1 09    		   CALL LCD_WR_DAT   	;
192)   0AD7 16 01       		   LD D,0x01	;
193)   0AD9 CD B1 09    		   CALL LCD_WR_DAT       	;
194)   0ADC 06 05       		   LD B,5       ;delay(5);	;delay(5);
195)   0ADE CD D9 21    		   CALL DELAYMICRO  	;
197)   0AE1 16 35       		   LD D,0x35         ;tear on  0X34 TEAR OFF	;tear on  0X34 TEAR OFF
198)   0AE3 CD B5 09    		   CALL LCD_WR_COM     	;
199)   0AE6 16 00       		   LD D,0x00         ;ONLY V-BLNK=0 , V + H =1	;ONLY V-BLNK=0 , V + H =1
200)   0AE8 CD B1 09    		   CALL LCD_WR_DAT     	;
202)   0AEB 16 29       		   LD D,0x29         ;display on 	;display on
203)   0AED CD B5 09    		   CALL LCD_WR_COM       	;
204)   0AF0 16 BE       		   LD D,0xBE         ;set PWM for B/L	;set PWM for B/L
205)   0AF2 CD B5 09    		   CALL LCD_WR_COM                 	;
206)   0AF5 16 06       		   LD D,0x06	;
207)   0AF7 CD B1 09    		   CALL LCD_WR_DAT                 	;
208)   0AFA 16 F0       		   LD D,0xF0         	;
209)   0AFC CD B1 09    		   CALL LCD_WR_DAT   	;
210)   0AFF 16 01       		   LD D,0x01         	;
211)   0B01 CD B1 09    		   CALL LCD_WR_DAT   	;
212)   0B04 16 F0       		   LD D,0xF0         	;
213)   0B06 CD B1 09    		   CALL LCD_WR_DAT   	;
214)   0B09 16 00       		   LD D,0x00         	;
215)   0B0B CD B1 09    		   CALL LCD_WR_DAT   	;
216)   0B0E 16 00       		   LD D,0x00         	;
217)   0B10 CD B1 09    		   CALL LCD_WR_DAT                   	;
219)   0B13 16 D0       		   LD D,0xD0         	;
220)   0B15 CD B5 09    		   CALL LCD_WR_COM                 	;
221)   0B18 16 0D       		   LD D,0x0D         	;
222)   0B1A CD B1 09    		   CALL LCD_WR_DAT         	;
225)   0B1D 21 00 00    		   LD HL,0	;
226)   0B20 E5          		   PUSH HL	;
227)   0B21 E5          		   PUSH HL	;
228)   0B22 21 1F 03    		   LD HL,799	;
229)   0B25 E5          		   PUSH HL	;
230)   0B26 21 DF 01    		   LD HL,479	;
231)   0B29 E5          		   PUSH HL	;
232)   0B2A CD 2E 0B    		   CALL LCD_SETXY	;
233)   0B2D C9          		   RET	;
250)   0B2E DD 21 02 00 		   LD IX,2	;
251)   0B32 DD 39       		   ADD IX,SP         	;
252)   0B34 16 2A       		   LD D,0x2A         ;SEND IX PARAMS	;SEND IX PARAMS
253)   0B36 CD B5 09    		   CALL LCD_WR_COM    	;
254)   0B39 DD 56 07    		   LD D,(IX+7)	;
255)   0B3C CD B1 09    		   CALL LCD_WR_DAT	;
256)   0B3F DD 56 06    		   LD D,(IX+6)	;
257)   0B42 CD B1 09    		   CALL LCD_WR_DAT	;
258)   0B45 DD 56 03    		   LD D,(IX+3)	;
259)   0B48 CD B1 09    		   CALL LCD_WR_DAT	;
260)   0B4B DD 56 02    		   LD D,(IX+2)	;
261)   0B4E CD B1 09    		   CALL LCD_WR_DAT       	;
262)   0B51 16 2B       		   LD D,0x2B         ;SEND Y PARAMS	;SEND Y PARAMS
263)   0B53 CD B5 09    		   CALL LCD_WR_COM   	;
264)   0B56 DD 56 05    		   LD D,(IX+5)	;
265)   0B59 CD B1 09    		   CALL LCD_WR_DAT	;
266)   0B5C DD 56 04    		   LD D,(IX+4)	;
267)   0B5F CD B1 09    		   CALL LCD_WR_DAT	;
268)   0B62 DD 56 01    		   LD D,(IX+1)	;
269)   0B65 CD B1 09    		   CALL LCD_WR_DAT	;
270)   0B68 DD 56 00    		   LD D,(IX)	;
271)   0B6B CD B1 09    		   CALL LCD_WR_DAT       	;
272)   0B6E 16 2C       		   LD D,0x2C         ;SEND DATA	;SEND DATA
273)   0B70 CD B5 09    		   CALL LCD_WR_COM   	;
274)   0B73 D1          		   POP DE	;
275)   0B74 21 08 00    		   LD HL,4*2       ;REMOVE 4 PARAMS FROM STACK	;REMOVE 4 PARAMS FROM STACK
276)   0B77 39          		   ADD HL,SP	;
277)   0B78 F9          		   LD SP,HL	;
278)   0B79 EB          		   EX DE,HL	;
279)   0B7A E9          		   JP (HL)        	;
285)   0B7B 54          		   LD D,H        	;
286)   0B7C CD B1 09    		   CALL LCD_WR_DAT 	;
287)   0B7F 55          		   LD D,L	;
288)   0B80 CD B1 09    		   CALL LCD_WR_DAT 	;
289)   0B83 C9          		   RET	;
294)   0B84 16 2E       		   LD D,0x2E         ;READ DATA	;READ DATA
295)   0B86 CD B5 09    		   CALL LCD_WR_COM           	;
296)   0B89 CD AE 09    		@LCD_GTPXL:   CALL LCD_RD_DAT 	;
297)   0B8C 67          		   LD H,A	;
298)   0B8D CD AE 09    		   CALL LCD_RD_DAT 	;
299)   0B90 6F          		   LD L,A	;
300)   0B91 C9          		   RET    	;
306)   0B92 DD E5       		@LCD_READPIXEL: PUSH IX ; 2 PARAMS ON STACK TOTAL 4 BYTES	; 2 PARAMS ON STACK TOTAL 4 BYTES
307)   0B94 DD 21 04 00 		   LD IX,4    ;2 FOR RET ADDR AND 2 FOR PUSH IX	;2 FOR RET ADDR AND 2 FOR PUSH IX
308)   0B98 DD 39       		   ADD IX,SP    	;
309)   0B9A DD 66 03    		   LD H,(IX+3)   ;X	;X
310)   0B9D DD 6E 02    		   LD L,(IX+2)   ;X	;X
311)   0BA0 DD 56 01    		   LD D,(IX+1) ;Y	;Y
312)   0BA3 DD 5E 00    		   LD E,(IX) ;Y	;Y
313)   0BA6 E5          		   PUSH HL	;
314)   0BA7 D5          		   PUSH DE	;
315)   0BA8 E5          		   PUSH HL	;
316)   0BA9 D5          		   PUSH DE	;
317)   0BAA CD 2E 0B    		   CALL LCD_SETXY	;
318)   0BAD CD 84 0B    		   CALL LCD_GETPIXEL	;
319)   0BB0 E5          		   PUSH HL    	;
320)   0BB1 CD E3 0B    		   CALL LCD_CLRXY	;
321)   0BB4 D1          		   POP DE  ;RESULT COLOR	;RESULT COLOR
322)   0BB5 DD E1       		   POP IX	;
323)   0BB7 C1          		   POP BC  ;RET ADDR	;RET ADDR
324)   0BB8 21 04 00    		   LD HL,2*2        ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
325)   0BBB 39          		   ADD HL,SP	;
326)   0BBC F9          		   LD SP,HL	;
327)   0BBD EB          		   EX DE,HL ;HL RESULT	;HL RESULT
328)   0BBE C5          		   PUSH BC  ;RET ADDR ON STACK	;RET ADDR ON STACK
329)   0BBF C9          		   RET	;
333)   0BC0 DD 21 02 00 		   LD IX,2     ;setXY(x, y, x, y);	;setXY(x, y, x, y);
334)   0BC4 DD 39       		   ADD IX,SP	;
335)   0BC6 DD 66 03    		   LD H,(IX+3)   ;X	;X
336)   0BC9 DD 6E 02    		   LD L,(IX+2)   ;X	;X
337)   0BCC DD 56 01    		   LD D,(IX+1) ;Y	;Y
338)   0BCF DD 5E 00    		   LD E,(IX) ;Y	;Y
339)   0BD2 E5          		   PUSH HL	;
340)   0BD3 D5          		   PUSH DE	;
341)   0BD4 E5          		   PUSH HL	;
342)   0BD5 D5          		   PUSH DE	;
343)   0BD6 CD 2E 0B    		   CALL LCD_SETXY	;
344)   0BD9 2A 01 83    		   LD HL,(FCOLOR)	;
345)   0BDC CD 7B 0B    		   CALL LCD_SETPIXEL	;
346)   0BDF CD E3 0B    		   CALL LCD_CLRXY	;
347)   0BE2 C9          		   RET	;
350)   0BE3 21 00 00    		    LD HL,0	;
351)   0BE6 E5          		    PUSH HL	;
352)   0BE7 E5          		    PUSH HL	;
353)   0BE8 21 1F 03    		    LD HL,LCD_WIDTH	;
354)   0BEB E5          		    PUSH HL	;
355)   0BEC 21 DF 01    		    LD HL,LCD_HEIGHT	;
356)   0BEF E5          		    PUSH HL	;
357)   0BF0 CD 2E 0B    		    CALL LCD_SETXY	;
358)   0BF3 C9          		    RET	;
362)   0BF4 DD 21 02 00 		     LD IX,2	;
363)   0BF8 DD 39       		     ADD IX,SP	;
364)   0BFA DD 66 05    		     LD H,(IX+5)   ;X  	;X
365)   0BFD DD 6E 04    		     LD L,(IX+4)   ;X	;X
366)   0C00 DD 56 03    		     LD D,(IX+3)   ;Y	;Y
367)   0C03 DD 5E 02    		     LD E,(IX+2)   ;Y	;Y
368)   0C06 DD 46 01    		     LD B,(IX+1)   ;LENGTH	;LENGTH
369)   0C09 DD 4E 00    		     LD C,(IX)     ;LENGTH	;LENGTH
372)   0C0C E5          		     PUSH HL	;
373)   0C0D 21 00 00    		     LD HL,0	;
374)   0C10 B7          		     OR A           ;CLEAR CARRY	;CLEAR CARRY
375)   0C11 ED 42       		     SBC HL,BC      ;CHECK IF LENGTH<0	;CHECK IF LENGTH<0
376)   0C13 38 0A       		     JR C,POSH1	;
377)   0C15 AF          		     XOR A          ;l=-l	;l=-l
378)   0C16 91          		  SUB C	;
379)   0C17 4F          		  LD C,A	;
380)   0C18 9F          		  SBC A,A	;
381)   0C19 90          		  SUB B	;
382)   0C1A 47          		  LD B,A	;
383)   0C1B E1          		  POP HL	;
384)   0C1C ED 42       		     SBC HL,BC       ;x -= l;	;x -= l;
385)   0C1E E5          		     PUSH HL                    	;
386)   0C1F E1          		POSH1: POP HL	;
387)   0C20 E5          		  PUSH HL	;
388)   0C21 D5          		     PUSH DE	;
389)   0C22 09          		     ADD HL,BC	;
390)   0C23 E5          		     PUSH HL	;
391)   0C24 D5          		     PUSH DE	;
392)   0C25 CD 2E 0B    		     CALL LCD_SETXY   ;setXY(x, y, x+l, y);	;setXY(x, y, x+l, y);
393)   0C28 2A 01 83    		     LD HL,(FCOLOR)    	;
394)   0C2B CD 7B 0B    		NXTH1: CALL LCD_SETPIXEL	;
395)   0C2E 0B          		     DEC BC	;
396)   0C2F 79          		     LD A,C	;
397)   0C30 B0          		     OR B	;
398)   0C31 20 F8       		     JR NZ, NXTH1     	;
399)   0C33 CD E3 0B    		     CALL LCD_CLRXY	;
400)   0C36 D1          		     POP DE	;
401)   0C37 21 06 00    		     LD HL,6       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
402)   0C3A 39          		     ADD HL,SP	;
403)   0C3B F9          		     LD SP,HL      	;
404)   0C3C EB          		     EX DE,HL	;
405)   0C3D E9          		     JP (HL)	;
411)   0C3E DD 21 02 00 		     LD IX,2	;
412)   0C42 DD 39       		     ADD IX,SP	;
413)   0C44 DD 56 05    		     LD D,(IX+5)   ;X  	;X
414)   0C47 DD 5E 04    		     LD E,(IX+4)   ;X	;X
415)   0C4A DD 66 03    		     LD H,(IX+3)   ;Y	;Y
416)   0C4D DD 6E 02    		     LD L,(IX+2)   ;Y	;Y
417)   0C50 DD 46 01    		     LD B,(IX+1)   ;LENGTH	;LENGTH
418)   0C53 DD 4E 00    		     LD C,(IX)     ;LENGTH     	;LENGTH
419)   0C56 E5          		     PUSH HL	;
420)   0C57 21 00 00    		     LD HL,0	;
421)   0C5A B7          		     OR A           ;CLEAR CARRY	;CLEAR CARRY
422)   0C5B ED 42       		     SBC HL,BC      ;CHECK IF LENGTH<0	;CHECK IF LENGTH<0
423)   0C5D 38 0A       		     JR C,POSV1	;
424)   0C5F AF          		     XOR A          ;l=-l	;l=-l
425)   0C60 91          		  SUB C	;
426)   0C61 4F          		  LD C,A	;
427)   0C62 9F          		  SBC A,A	;
428)   0C63 90          		  SUB B	;
429)   0C64 47          		  LD B,A	;
430)   0C65 E1          		  POP HL	;
431)   0C66 ED 42       		     SBC HL,BC       ;Y -= l;	;Y -= l;
432)   0C68 E5          		     PUSH HL                   	;
433)   0C69 E1          		POSV1: POP HL	;
434)   0C6A D5          		  PUSH DE	;
435)   0C6B E5          		     PUSH HL	;
436)   0C6C D5          		     PUSH DE	;
437)   0C6D 09          		     ADD HL,BC	;
438)   0C6E E5          		     PUSH HL	;
439)   0C6F CD 2E 0B    		     CALL LCD_SETXY   ;setXY(x, y, x, y+l);	;setXY(x, y, x, y+l);
440)   0C72 2A 01 83    		     LD HL,(FCOLOR)    	;
441)   0C75 CD 7B 0B    		NXTV1: CALL LCD_SETPIXEL	;
442)   0C78 0B          		     DEC BC	;
443)   0C79 79          		     LD A,C	;
444)   0C7A B0          		     OR B	;
445)   0C7B 20 F8       		     JR NZ, NXTV1     	;
446)   0C7D CD E3 0B    		     CALL LCD_CLRXY	;
447)   0C80 D1          		     POP DE	;
448)   0C81 21 06 00    		     LD HL,6       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
449)   0C84 39          		     ADD HL,SP	;
450)   0C85 F9          		     LD SP,HL	;
451)   0C86 EB          		     EX DE,HL	;
452)   0C87 E9          		     JP (HL)	;
456)   0C88 DD 21 02 00 		     LD IX,2	;
457)   0C8C DD 39       		     ADD IX,SP	;
467)   0C8E DD 66 05    		     LD H,(IX+5)   ;Y1	;Y1
468)   0C91 DD 6E 04    		     LD L,(IX+4)   ;Y1	;Y1
469)   0C94 DD 56 01    		     LD D,(IX+1)   ;Y2	;Y2
470)   0C97 DD 5E 00    		     LD E,(IX)     ;Y2	;Y2
471)   0C9A B7          		     OR A	;
472)   0C9B ED 52       		     SBC HL,DE	;
473)   0C9D 20 17       		     JR NZ,YNOTEQ	;
475)   0C9F DD 46 07    		     LD B,(IX+7)   ;X1	;X1
476)   0CA2 DD 4E 06    		     LD C,(IX+6)   ;X1	;X1
477)   0CA5 C5          		     PUSH BC       ;X1 1ST PARAM ON STACK	;X1 1ST PARAM ON STACK
478)   0CA6 D5          		     PUSH DE    ;Y 2ND PARAM ON STACK	;Y 2ND PARAM ON STACK
479)   0CA7 DD 66 03    		     LD H,(IX+3)   ;X2	;X2
480)   0CAA DD 6E 02    		     LD L,(IX+2)   ;X2       	;X2
481)   0CAD ED 42       		     SBC HL,BC     ;X2-X1 = LENGTH OF HORIZ LINE	;X2-X1 = LENGTH OF HORIZ LINE
482)   0CAF E5          		     PUSH HL       ;LENGTH 3RD PARAM ON STACK 	;LENGTH 3RD PARAM ON STACK
483)   0CB0 CD F4 0B    		     CALL LCD_DRAWHLINE	;
484)   0CB3 C3 63 0E    		     JP DLNEX	;
486)   0CB6 DD 66 07    		     LD H,(IX+7)   ;X1	;X1
487)   0CB9 DD 6E 06    		     LD L,(IX+6)   ;X1	;X1
488)   0CBC DD 56 03    		     LD D,(IX+3)   ;X2	;X2
489)   0CBF DD 5E 02    		     LD E,(IX+2)   ;X2 	;X2
490)   0CC2 B7          		     OR A	;
491)   0CC3 ED 52       		     SBC HL,DE	;
492)   0CC5 20 17       		     JR NZ,XNOTEQ	;
494)   0CC7 D5          		     PUSH DE       ;X2=X1 1ST PARAM ON STACK	;X2=X1 1ST PARAM ON STACK
495)   0CC8 DD 46 05    		     LD B,(IX+5)   ;Y1	;Y1
496)   0CCB DD 4E 04    		     LD C,(IX+4)   ;Y1	;Y1
497)   0CCE C5          		     PUSH BC       ;Y1 2ND PARAM ON STACK	;Y1 2ND PARAM ON STACK
498)   0CCF DD 66 01    		     LD H,(IX+1)   ;Y2	;Y2
499)   0CD2 DD 6E 00    		     LD L,(IX)   ;Y2       	;Y2
500)   0CD5 ED 42       		     SBC HL,BC     ;Y2-Y1 = LENGTH OF VERT LINE	;Y2-Y1 = LENGTH OF VERT LINE
501)   0CD7 E5          		     PUSH HL       ;LENGTH 3RD PARAM ON STACK 	;LENGTH 3RD PARAM ON STACK
502)   0CD8 CD 3E 0C    		     CALL LCD_DRAWVLINE	;
503)   0CDB C3 63 0E    		     JP DLNEX	;
506)   0CDE 38 04       		     JR C,X2GTX1	;
508)   0CE0 AF          		     XOR A  	;
509)   0CE1 3D          		     DEC A  ;XSTEP=-1	;XSTEP=-1
510)   0CE2 18 0D       		     JR DLNXT1	;
513)   0CE4 D5          		     PUSH DE	;
514)   0CE5 E1          		     POP HL	;
515)   0CE6 DD 56 07    		     LD D,(IX+7)   ;X1	;X1
516)   0CE9 DD 5E 06    		     LD E,(IX+6)   ;X1 	;X1
517)   0CEC B7          		     OR A     	;
518)   0CED ED 52       		     SBC HL,DE     ;X2-X1 ON HL	;X2-X1 ON HL
520)   0CEF 3E 01       		     LD A,1        ;XSTEP=1	;XSTEP=1
522)   0CF1 06 00       		     LD B,0	;
523)   0CF3 0E 00       		     LD C,0	;
524)   0CF5 C5          		     PUSH BC       ;T	;T
525)   0CF6 E5          		     PUSH HL       ;DX	;DX
526)   0CF7 FE 01       		     CP 1	;
527)   0CF9 28 02       		     JR Z,DLXMINUS1	;
528)   0CFB 06 FF       		     LD B,0XFF	;
529)   0CFD 4F          		DLXMINUS1:LD C,A     	;
530)   0CFE C5          		     PUSH BC       ;XSTEP	;XSTEP
531)   0CFF DD 66 05    		     LD H,(IX+5)   ;Y1	;Y1
532)   0D02 DD 6E 04    		     LD L,(IX+4)   ;Y1	;Y1
533)   0D05 DD 56 01    		     LD D,(IX+1)   ;Y2	;Y2
534)   0D08 DD 5E 00    		     LD E,(IX)     ;Y2      	;Y2
535)   0D0B B7          		     OR A	;
536)   0D0C ED 52       		     SBC HL,DE	;
537)   0D0E 38 04       		     JR C,Y2GTY1  ;HL=Y1-Y2	;HL=Y1-Y2
538)   0D10 AF          		     XOR A	;
539)   0D11 3D          		     DEC A         ;YSTEP=-1	;YSTEP=-1
540)   0D12 18 0F       		     JR DLNXT2	;
543)   0D14 D5          		     PUSH DE	;
544)   0D15 E1          		     POP HL	;
545)   0D16 DD 56 05    		     LD D,(IX+5)   ;Y1	;Y1
546)   0D19 DD 5E 04    		     LD E,(IX+4)   ;Y1  	;Y1
547)   0D1C B7          		     OR A	;
548)   0D1D ED 52       		     SBC HL,DE  ;HL=Y2-Y1    HL=DY      	;HL=Y2-Y1    HL=DY
549)   0D1F 06 00       		     LD B,0	;
550)   0D21 3E 01       		     LD A,1        ;YSTEP=1	;YSTEP=1
552)   0D23 FE 01       		     CP 1	;
553)   0D25 28 02       		     JR Z,DLYMINUS1	;
554)   0D27 06 FF       		     LD B,0XFF	;
556)   0D29 4F          		     LD C,A      	;
557)   0D2A E5          		     PUSH HL       ;DY	;DY
558)   0D2B C5          		     PUSH BC       ;YSTEP   	;YSTEP
559)   0D2C FD 21 00 00 		     LD IY,0	;
560)   0D30 FD 39       		     ADD IY,SP	;
575)   0D32 FD 56 07    		     LD D,(IY+7)    ;DX	;DX
576)   0D35 FD 5E 06    		     LD E,(IY+6)    ;DX	;DX
577)   0D38 B7          		     OR A	;
578)   0D39 ED 52       		     SBC HL,DE      ;DY-DX	;DY-DX
579)   0D3B DA D0 0D    		     JP C,DXGTDY	;
580)   0D3E CA D0 0D    		     JP Z,DXGTDY	;
582)   0D41 19          		     ADD HL,DE      ;HL=DY	;HL=DY
583)   0D42 44          		     LD B,H	;
584)   0D43 4D          		     LD C,L	;
585)   0D44 CB 38       		     SRL B	;
586)   0D46 CB 19       		     RR C           ;(dy >> 1)	;(dy >> 1)
587)   0D48 21 00 00    		     LD HL,0	;
588)   0D4B ED 42       		     SBC HL,BC      ;t = - (dy >> 1);	;t = - (dy >> 1);
589)   0D4D FD 74 09    		     LD (IY+9),H    ;SAVE T	;SAVE T
590)   0D50 FD 75 08    		     LD (IY+8),L    ;SAVE T	;SAVE T
592)   0D53 DD 56 05    		     LD D,(IX+5)   ;ROW	;ROW
593)   0D56 DD 5E 04    		     LD E,(IX+4)   ;ROW=Y1	;ROW=Y1
594)   0D59 DD 66 07    		     LD H,(IX+7)   ;COL	;COL
595)   0D5C DD 6E 06    		     LD L,(IX+6)   ;COL=X1	;COL=X1
596)   0D5F D5          		     PUSH DE	;
597)   0D60 DD E5       		     PUSH IX	;
598)   0D62 E5          		     PUSH HL	;
599)   0D63 D5          		     PUSH DE	;
600)   0D64 E5          		     PUSH HL	;
601)   0D65 D5          		     PUSH DE	;
602)   0D66 CD 2E 0B    		     CALL LCD_SETXY	;
603)   0D69 2A 01 83    		     LD HL,(FCOLOR)    	;
604)   0D6C CD 7B 0B    		     CALL LCD_SETPIXEL	;
605)   0D6F DD E1       		     POP IX	;
606)   0D71 D1          		     POP DE	;
607)   0D72 DD 66 01    		     LD H,(IX+1)   ;Y2	;Y2
608)   0D75 DD 6E 00    		     LD L,(IX)     ;Y2 	;Y2
609)   0D78 ED 52       		     SBC HL,DE     ; ROW=Y2	; ROW=Y2
610)   0D7A CA 5E 0E    		     JP Z,DLEXIT	;
611)   0D7D FD 46 01    		     LD B,(IY+1)   ;YSTEP HI	;YSTEP HI
612)   0D80 FD 4E 00    		     LD C,(IY)     ;YSTEP LO	;YSTEP LO
613)   0D83 EB          		     EX DE,HL	;
614)   0D84 09          		     ADD HL,BC     ;row += ystep;	;row += ystep;
615)   0D85 DD 74 05    		     LD (IX+5),H   ;SAVE ROW	;SAVE ROW
616)   0D88 DD 75 04    		     LD (IX+4),L   ;   	;
618)   0D8B FD 56 09    		     LD D,(IY+9)   ; T	; T
619)   0D8E FD 5E 08    		     LD E,(IY+8)   ; T      	; T
620)   0D91 FD 66 07    		     LD H,(IY+7)   ;DX	;DX
621)   0D94 FD 6E 06    		     LD L,(IY+6)   ;DX	;DX
622)   0D97 19          		     ADD HL,DE	;
623)   0D98 FD 74 09    		     LD (IY+9),H   ;t += dx;	;t += dx;
624)   0D9B FD 75 08    		     LD (IY+8),L	;
625)   0D9E EB          		     EX DE,HL	;
626)   0D9F 21 00 80    		     LD HL,$8000	;
627)   0DA2 ED 52       		     SBC HL,DE     ;CHECK IF T<0	;CHECK IF T<0
628)   0DA4 38 AD       		     JR C,DLAGN1   ; CARRY SET IF NEGATIVE	; CARRY SET IF NEGATIVE
629)   0DA6 FD 46 05    		     LD B,(IY+5)   ;XSTEP HI	;XSTEP HI
630)   0DA9 FD 4E 04    		     LD C,(IY+4)   ;XSTEP LO	;XSTEP LO
631)   0DAC DD 66 07    		     LD H,(IX+7)   ;COL HI	;COL HI
632)   0DAF DD 6E 06    		     LD L,(IX+6)   ;COL LO	;COL LO
633)   0DB2 09          		     ADD HL,BC     ;col += xstep;	;col += xstep;
634)   0DB3 DD 74 07    		     LD (IX+7),H   ;SAVE COL	;SAVE COL
635)   0DB6 DD 75 06    		     LD (IX+6),L   ;         	;
637)   0DB9 FD 66 09    		     LD H,(IY+9)   ; T	; T
638)   0DBC FD 6E 08    		     LD L,(IY+8)   ; T      	; T
639)   0DBF FD 46 03    		     LD B,(IY+3)   ;DY	;DY
640)   0DC2 FD 4E 02    		     LD C,(IY+2)   ;DY	;DY
641)   0DC5 ED 42       		     SBC HL,BC	;
642)   0DC7 FD 74 09    		     LD (IY+9),H   ;t -= dY;	;t -= dY;
643)   0DCA FD 75 08    		     LD (IY+8),L       	;
644)   0DCD C3 53 0D    		     JP DLAGN1	;
646)   0DD0 19          		     ADD HL,DE      ;HL=DY DE=DX	;HL=DY DE=DX
647)   0DD1 42          		     LD B,D	;
648)   0DD2 4B          		     LD C,E	;
649)   0DD3 CB 38       		     SRL B	;
650)   0DD5 CB 19       		     RR C           ;(dX >> 1)	;(dX >> 1)
651)   0DD7 21 00 00    		     LD HL,0	;
652)   0DDA ED 42       		     SBC HL,BC      ;t = - (dX >> 1);	;t = - (dX >> 1);
653)   0DDC FD 74 09    		     LD (IY+9),H    ;SAVE T	;SAVE T
654)   0DDF FD 75 08    		     LD (IY+8),L    ;SAVE T	;SAVE T
656)   0DE2 DD 56 05    		     LD D,(IX+5)   ;ROW	;ROW
657)   0DE5 DD 5E 04    		     LD E,(IX+4)   ;ROW=Y1	;ROW=Y1
658)   0DE8 DD 66 07    		     LD H,(IX+7)   ;COL	;COL
659)   0DEB DD 6E 06    		     LD L,(IX+6)   ;COL=X1	;COL=X1
660)   0DEE E5          		     PUSH HL       ;SAVE COL	;SAVE COL
661)   0DEF DD E5       		     PUSH IX	;
662)   0DF1 E5          		     PUSH HL	;
663)   0DF2 D5          		     PUSH DE	;
664)   0DF3 E5          		     PUSH HL	;
665)   0DF4 D5          		     PUSH DE	;
666)   0DF5 CD 2E 0B    		     CALL LCD_SETXY	;
667)   0DF8 2A 01 83    		     LD HL,(FCOLOR)    	;
668)   0DFB CD 7B 0B    		     CALL LCD_SETPIXEL	;
669)   0DFE DD E1       		     POP IX	;
670)   0E00 D1          		     POP DE        ;RETRIEVE COL	;RETRIEVE COL
671)   0E01 DD 66 03    		     LD H,(IX+3)   ;X2	;X2
672)   0E04 DD 6E 02    		     LD L,(IX+2)   ;X2 	;X2
673)   0E07 ED 52       		     SBC HL,DE     ; COL=X2?	; COL=X2?
674)   0E09 28 53       		     JR Z,DLEXIT	;
675)   0E0B EB          		     EX DE,HL      ;HL=COL	;HL=COL
676)   0E0C FD 46 05    		     LD B,(IY+5)   ;XSTEP HI	;XSTEP HI
677)   0E0F FD 4E 04    		     LD C,(IY+4)   ;XSTEP LO	;XSTEP LO
678)   0E12 09          		     ADD HL,BC     ;col += xstep;	;col += xstep;
679)   0E13 DD 74 07    		     LD (IX+7),H   ;SAVE COL	;SAVE COL
680)   0E16 DD 75 06    		     LD (IX+6),L   ;   	;
681)   0E19 FD 56 09    		     LD D,(IY+9)   ; T	; T
682)   0E1C FD 5E 08    		     LD E,(IY+8)   ; T      	; T
683)   0E1F FD 66 03    		     LD H,(IY+3)   ;DY	;DY
684)   0E22 FD 6E 02    		     LD L,(IY+2)   ;DY	;DY
685)   0E25 19          		     ADD HL,DE	;
686)   0E26 FD 74 09    		     LD (IY+9),H   ;t += dY;	;t += dY;
687)   0E29 FD 75 08    		     LD (IY+8),L	;
688)   0E2C EB          		     EX DE,HL      ;T=DE	;T=DE
689)   0E2D 21 00 80    		     LD HL,$8000  	;
690)   0E30 ED 52       		     SBC HL,DE    ;CHECK IF T<0	;CHECK IF T<0
691)   0E32 38 AE       		     JR C,DLAGN2  ;CARRY SET IF NEGATIVE    	;CARRY SET IF NEGATIVE
692)   0E34 FD 46 01    		     LD B,(IY+1)   ;YSTEP HI	;YSTEP HI
693)   0E37 FD 4E 00    		     LD C,(IY)     ;YSTEP LO	;YSTEP LO
694)   0E3A DD 66 05    		     LD H,(IX+5)   ;ROW HI	;ROW HI
695)   0E3D DD 6E 04    		     LD L,(IX+4)   ;ROW LO	;ROW LO
696)   0E40 09          		     ADD HL,BC     ;ROW += Ystep;	;ROW += Ystep;
697)   0E41 DD 74 05    		     LD (IX+5),H   ;SAVE COL	;SAVE COL
698)   0E44 DD 75 04    		     LD (IX+4),L   ;         	;
700)   0E47 FD 66 09    		     LD H,(IY+9)   ; T	; T
701)   0E4A FD 6E 08    		     LD L,(IY+8)   ; T      	; T
702)   0E4D FD 46 07    		     LD B,(IY+7)   ;DX	;DX
703)   0E50 FD 4E 06    		     LD C,(IY+6)   ;DX	;DX
704)   0E53 ED 42       		     SBC HL,BC	;
705)   0E55 FD 74 09    		     LD (IY+9),H   ;t -= dX;	;t -= dX;
706)   0E58 FD 75 08    		     LD (IY+8),L       	;
707)   0E5B C3 E2 0D    		     JP DLAGN2	;
710)   0E5E 21 0A 00    		     LD HL,5*2     ;REMOVE 5 IY PARAMS FROM STACK	;REMOVE 5 IY PARAMS FROM STACK
711)   0E61 39          		     ADD HL,SP     ;	;
712)   0E62 F9          		     LD SP,HL           	;
713)   0E63 D1          		DLNEX:POP DE       ;RET ADDR	;RET ADDR
714)   0E64 21 08 00    		     LD HL,4*2       ;REMOVE 4 PARAMS FROM STACK	;REMOVE 4 PARAMS FROM STACK
715)   0E67 39          		     ADD HL,SP	;
716)   0E68 F9          		     LD SP,HL     	;
717)   0E69 EB          		     EX DE,HL	;
718)   0E6A E9          		     JP (HL)	;
723)   0E6B C5          		@PLOTP:PUSH BC      ;SAVE BC	;SAVE BC
724)   0E6C DD E5       		     PUSH IX	;
726)   0E6E D5          		     PUSH DE	;
727)   0E6F E5          		     PUSH HL	;
728)   0E70 D5          		     PUSH DE	;
729)   0E71 E5          		     PUSH HL	;
730)   0E72 CD 2E 0B    		     CALL LCD_SETXY      	;
731)   0E75 2A 01 83    		     LD HL,(FCOLOR)	;
732)   0E78 CD 7B 0B    		     CALL LCD_SETPIXEL  	;
734)   0E7B DD E1       		     POP IX	;
735)   0E7D C1          		     POP BC        ;RESTORE BC	;RESTORE BC
736)   0E7E C9          		     RET   	;
741)   0E7F E1          		     POP HL         ;GET THE RETURN ADDRESS	;GET THE RETURN ADDRESS
742)   0E80 D5          		     PUSH DE        ;F VAR 	;F VAR
743)   0E81 D5          		     PUSH DE        ;DDF_X 	;DDF_X
744)   0E82 D5          		     PUSH DE        ;DDF_Y	;DDF_Y
745)   0E83 D5          		     PUSH DE        ;X1	;X1
746)   0E84 D5          		     PUSH DE        ;Y1	;Y1
747)   0E85 E5          		     PUSH HL        ;RET ADDR	;RET ADDR
748)   0E86 DD 21 02 00 		     LD IX,2	;
749)   0E8A DD 39       		     ADD IX,SP	;
767)   0E8C AF          		     XOR A	;
768)   0E8D DD 56 0B    		     LD D,(IX+11)    ;R	;R
769)   0E90 DD 5E 0A    		     LD E,(IX+10)    ;R	;R
770)   0E93 DD 72 01    		     LD (IX+1),D     ;Y1=R	;Y1=R
771)   0E96 DD 73 00    		     LD (IX+0),E	;
772)   0E99 21 01 00    		     LD HL,1	;
773)   0E9C DD 74 07    		     LD (IX+7),H     ;DDF_X=1	;DDF_X=1
774)   0E9F DD 75 06    		     LD (IX+6),L	;
775)   0EA2 DD 74 03    		     LD (IX+3),H     ;X1=0	;X1=0
776)   0EA5 DD 74 02    		     LD (IX+2),H      	;
777)   0EA8 ED 52       		     SBC HL,DE	;
778)   0EAA DD 74 09    		     LD (IX+9),H     ;F	;F
779)   0EAD DD 75 08    		     LD (IX+8),L     ;F	;F
781)   0EB0 EB          		     EX DE,HL        ;HL=RADIUS	;HL=RADIUS
782)   0EB1 29          		     ADD HL,HL       ;2*R	;2*R
783)   0EB2 EB          		     EX DE,HL	;
784)   0EB3 21 00 00    		     LD HL,0	;
785)   0EB6 ED 52       		     SBC HL,DE          ;-2*R	;-2*R
786)   0EB8 DD 74 05    		     LD (IX+5),H	;
787)   0EBB DD 75 04    		     LD (IX+4),L     ;DDF_Y	;DDF_Y
789)   0EBE DD 66 0D    		     LD H,(IX+13)    ;Y	;Y
790)   0EC1 DD 6E 0C    		     LD L,(IX+12)	;
791)   0EC4 E5          		     PUSH HL         ;SAVE Y	;SAVE Y
792)   0EC5 DD 56 0B    		     LD D,(IX+11)    ;R	;R
793)   0EC8 DD 5E 0A    		     LD E,(IX+10)	;
794)   0ECB D5          		     PUSH DE         ;SAVE R	;SAVE R
795)   0ECC 19          		     ADD HL,DE       ;Y+R      	;Y+R
796)   0ECD DD 56 0F    		     LD D,(IX+15)    ;X	;X
797)   0ED0 DD 5E 0E    		     LD E,(IX+14)	;
798)   0ED3 D5          		     PUSH DE         ;SAVE X	;SAVE X
800)   0ED4 CD 6B 0E    		     CALL PLOTP      	;
802)   0ED7 D1          		     POP DE        ;GET X	;GET X
803)   0ED8 C1          		     POP BC        ;GET R	;GET R
804)   0ED9 E1          		     POP HL        ;GET Y	;GET Y
805)   0EDA E5          		     PUSH HL       ;SAVE VARS	;SAVE VARS
806)   0EDB C5          		     PUSH BC	;
807)   0EDC D5          		     PUSH DE	;
808)   0EDD AF          		     XOR A	;
809)   0EDE ED 42       		     SBC HL,BC     ;	;
811)   0EE0 CD 6B 0E    		     CALL PLOTP      	;
813)   0EE3 E1          		    POP HL        ;GET X	;GET X
814)   0EE4 C1          		    POP BC        ;GET R	;GET R
815)   0EE5 D1          		    POP DE        ;GET Y	;GET Y
816)   0EE6 D5          		    PUSH DE       ;SAVE VARS	;SAVE VARS
817)   0EE7 C5          		    PUSH BC	;
818)   0EE8 E5          		    PUSH HL	;
819)   0EE9 AF          		    XOR A	;
820)   0EEA ED 4A       		    ADC HL,BC	;
821)   0EEC EB          		    EX DE,HL	;
823)   0EED CD 6B 0E    		     CALL PLOTP      	;
825)   0EF0 E1          		    POP HL        ;GET X	;GET X
826)   0EF1 C1          		    POP BC        ;GET R	;GET R
827)   0EF2 D1          		    POP DE        ;GET Y	;GET Y
828)   0EF3 AF          		    XOR A	;
829)   0EF4 ED 42       		    SBC HL,BC	;
830)   0EF6 EB          		    EX DE,HL	;
832)   0EF7 CD 6B 0E    		     CALL PLOTP      	;
835)   0EFA DD 66 03    		CIRC_AGN:LD H,(IX+3)   ;X1	;X1
836)   0EFD DD 6E 02    		     LD L,(IX+2)    ;X1	;X1
837)   0F00 DD 56 01    		     LD D,(IX+1)    ;Y1	;Y1
838)   0F03 DD 5E 00    		     LD E,(IX+0)    ;Y1	;Y1
839)   0F06 AF          		     XOR A	;
840)   0F07 ED 52       		     SBC HL,DE	;
841)   0F09 D2 F8 0F    		     JP NC,CIRC_EXIT	;
843)   0F0C 19          		    ADD HL,DE	;
844)   0F0D E5          		    PUSH HL        ;SAVE X1	;SAVE X1
845)   0F0E D5          		    PUSH DE        ;SAVE Y1	;SAVE Y1
846)   0F0F 21 00 00    		    LD HL,0	;
847)   0F12 AF          		    XOR A	;
850)   0F13 DD 7E 09    		    LD A,(IX+9)     ;F HI BYTE	;F HI BYTE
851)   0F16 FE 50       		    CP 80	;
852)   0F18 30 26       		    JR NC,CIRC_SKIP	;
853)   0F1A 28 24       		    JR Z,CIRC_SKIP	;
857)   0F1C D1          		    POP DE        ;Y1	;Y1
858)   0F1D 1B          		    DEC DE	;
859)   0F1E DD 72 01    		    LD (IX+1),D   ;SAVE Y1	;SAVE Y1
860)   0F21 DD 73 00    		    LD (IX+0),E	;
861)   0F24 D5          		    PUSH DE       ;Y1	;Y1
862)   0F25 DD 66 05    		    LD H,(IX+5)   ;DDF_Y	;DDF_Y
863)   0F28 DD 6E 04    		    LD L,(IX+4)   	;
864)   0F2B 23          		    INC HL	;
865)   0F2C 23          		    INC HL	;
866)   0F2D DD 74 05    		    LD (IX+5),H   ;SAVE DDF_Y	;SAVE DDF_Y
867)   0F30 DD 75 04    		    LD (IX+4),L	;
868)   0F33 DD 56 09    		    LD D,(IX+9)   ;F	;F
869)   0F36 DD 5E 08    		    LD E,(IX+8)	;
870)   0F39 19          		    ADD HL,DE	;
871)   0F3A DD 74 09    		    LD (IX+9),H    ;SAVE F	;SAVE F
872)   0F3D DD 75 08    		    LD (IX+8),L          	;
876)   0F40 C1          		   POP BC       ;Y1	;Y1
877)   0F41 E1          		   POP HL       ;X1	;X1
878)   0F42 23          		   INC HL	;
879)   0F43 DD 74 03    		   LD (IX+3),H  ;SAVE X1	;SAVE X1
880)   0F46 DD 75 02    		   LD (IX+2),L	;
881)   0F49 E5          		   PUSH HL      ;X1	;X1
882)   0F4A DD 66 07    		    LD H,(IX+7)   ;DDF_X	;DDF_X
883)   0F4D DD 6E 06    		    LD L,(IX+6)   	;
884)   0F50 23          		    INC HL	;
885)   0F51 23          		    INC HL	;
886)   0F52 DD 74 07    		    LD (IX+7),H   ;SAVE DDF_X	;SAVE DDF_X
887)   0F55 DD 75 06    		    LD (IX+6),L	;
888)   0F58 DD 56 09    		    LD D,(IX+9)   ;F	;F
889)   0F5B DD 5E 08    		    LD E,(IX+8)	;
890)   0F5E 19          		    ADD HL,DE	;
891)   0F5F DD 74 09    		    LD (IX+9),H    ;SAVE F	;SAVE F
892)   0F62 DD 75 08    		    LD (IX+8),L      	;
895)   0F65 E1          		     POP HL        ;X1	;X1
896)   0F66 E5          		     PUSH HL	;
897)   0F67 DD 56 0F    		     LD D,(IX+15)  ;X	;X
898)   0F6A DD 5E 0E    		     LD E,(IX+14)	;
899)   0F6D D5          		     PUSH DE	;
900)   0F6E 19          		     ADD HL,DE	;
901)   0F6F EB          		     EX DE,HL      ;DE=X+X1	;DE=X+X1
902)   0F70 DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
903)   0F73 DD 6E 0C    		     LD L,(IX+12)	;
904)   0F76 09          		     ADD HL,BC     ;HL=Y+Y1	;HL=Y+Y1
906)   0F77 CD 6B 0E    		     CALL PLOTP	;
908)   0F7A E1          		   POP HL        ;X	;X
909)   0F7B D1          		   POP DE        ;X1	;X1
910)   0F7C D5          		   PUSH DE	;
911)   0F7D E5          		   PUSH HL	;
912)   0F7E AF          		   XOR A	;
913)   0F7F ED 52       		   SBC HL,DE	;
914)   0F81 EB          		   EX DE,HL      ;DE=X-X1	;DE=X-X1
915)   0F82 DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
916)   0F85 DD 6E 0C    		     LD L,(IX+12)	;
917)   0F88 09          		     ADD HL,BC     ;HL=Y+Y1	;HL=Y+Y1
919)   0F89 CD 6B 0E    		     CALL PLOTP	;
921)   0F8C E1          		   POP HL        ;X	;X
922)   0F8D D1          		   POP DE        ;X1 	;X1
923)   0F8E D5          		   PUSH DE	;
924)   0F8F E5          		   PUSH HL	;
925)   0F90 19          		   ADD HL,DE	;
926)   0F91 EB          		   EX DE,HL      ;DE=X+X1	;DE=X+X1
927)   0F92 DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
928)   0F95 DD 6E 0C    		     LD L,(IX+12)	;
929)   0F98 AF          		     XOR A	;
930)   0F99 ED 42       		     SBC HL,BC     ;HL=Y+Y1	;HL=Y+Y1
932)   0F9B CD 6B 0E    		     CALL PLOTP	;
934)   0F9E E1          		   POP HL        ;X	;X
935)   0F9F D1          		   POP DE        ;X1  	;X1
936)   0FA0 D5          		   PUSH DE	;
937)   0FA1 E5          		   PUSH HL	;
938)   0FA2 AF          		   XOR A	;
939)   0FA3 ED 52       		   SBC HL,DE	;
940)   0FA5 EB          		   EX DE,HL      ;DE=X-X1	;DE=X-X1
941)   0FA6 DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
942)   0FA9 DD 6E 0C    		     LD L,(IX+12)	;
943)   0FAC AF          		     XOR A	;
944)   0FAD ED 42       		     SBC HL,BC     ;HL=Y-Y1	;HL=Y-Y1
946)   0FAF CD 6B 0E    		     CALL PLOTP	;
948)   0FB2 E1          		     POP HL         ;X	;X
949)   0FB3 D1          		     POP DE         ;X1	;X1
950)   0FB4 C5          		     PUSH BC        ;SAVE Y1 SWITCH DE AND BC	;SAVE Y1 SWITCH DE AND BC
951)   0FB5 E5          		     PUSH HL        ;SAVE X      	;SAVE X
952)   0FB6 D5          		     PUSH DE        ;SAVE X1      	;SAVE X1
953)   0FB7 09          		     ADD HL,BC      ;	;
954)   0FB8 C1          		     POP BC         ;BC=X1	;BC=X1
955)   0FB9 EB          		     EX DE,HL       ;DE=X+Y1	;DE=X+Y1
956)   0FBA DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
957)   0FBD DD 6E 0C    		     LD L,(IX+12)	;
958)   0FC0 09          		     ADD HL,BC     ;HL=Y+X1	;HL=Y+X1
960)   0FC1 CD 6B 0E    		     CALL PLOTP	;
962)   0FC4 E1          		   POP HL        ;X	;X
963)   0FC5 D1          		   POP DE        ;Y1	;Y1
964)   0FC6 D5          		   PUSH DE	;
965)   0FC7 E5          		   PUSH HL	;
966)   0FC8 AF          		   XOR A	;
967)   0FC9 ED 52       		   SBC HL,DE	;
968)   0FCB EB          		   EX DE,HL      ;DE=X-Y1	;DE=X-Y1
969)   0FCC DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
970)   0FCF DD 6E 0C    		     LD L,(IX+12)	;
971)   0FD2 09          		     ADD HL,BC     ;HL=Y+X1	;HL=Y+X1
973)   0FD3 CD 6B 0E    		     CALL PLOTP	;
975)   0FD6 E1          		   POP HL        ;X	;X
976)   0FD7 D1          		   POP DE        ;Y1	;Y1
977)   0FD8 D5          		   PUSH DE	;
978)   0FD9 E5          		   PUSH HL	;
979)   0FDA 19          		     ADD HL,DE	;
980)   0FDB EB          		     EX DE,HL      ;DE=X+Y1	;DE=X+Y1
981)   0FDC DD 66 0D    		     LD H,(IX+13)  ;Y	;Y
982)   0FDF DD 6E 0C    		     LD L,(IX+12)	;
983)   0FE2 AF          		     XOR A	;
984)   0FE3 ED 42       		     SBC HL,BC     ;HL=Y-X1	;HL=Y-X1
985)   0FE5 E5          		     PUSH HL	;
987)   0FE6 CD 6B 0E    		     CALL PLOTP	;
989)   0FE9 C1          		     POP BC        ;Y-X1	;Y-X1
990)   0FEA E1          		     POP HL        ;X	;X
991)   0FEB D1          		     POP DE        ;Y1 	;Y1
992)   0FEC AF          		     XOR A	;
993)   0FED ED 52       		     SBC HL,DE	;
994)   0FEF EB          		     EX DE,HL      ;DE=X-Y1	;DE=X-Y1
995)   0FF0 C5          		     PUSH BC	;
996)   0FF1 E1          		     POP HL        ;HL=Y-X1	;HL=Y-X1
998)   0FF2 CD 6B 0E    		     CALL PLOTP        	;
999)   0FF5 C3 FA 0E    		    JP CIRC_AGN	;
1000)   0FF8 CD E3 0B    		CIRC_EXIT: CALL LCD_CLRXY	;
1001)   0FFB D1          		     POP DE ;GET RET ADDR	;GET RET ADDR
1002)   0FFC 21 10 00    		     LD HL,8*2       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
1003)   0FFF 39          		     ADD HL,SP     ;	;
1004)   1000 F9          		     LD SP,HL 	;
1005)   1001 EB          		     EX DE,HL     	;
1006)   1002 E9          		     JP (HL)	;
1013)   1003 D9          		   EXX	;
1014)   1004 D1          		   POP DE  ;save return addr to de'	;save return addr to de'
1015)   1005 D9          		   EXX  	;
1016)   1006 CD A4 12    		   CALL _FILL         	;
1017)   1009 D9          		   EXX	;
1018)   100A D5          		   PUSH DE ;restore return addr from de'	;restore return addr from de'
1019)   100B D9          		   EXX	;
1020)   100C C9          		   RET	;
1027)   100D FE 08       		     CP 0X08   ;BACKSPACE	;BACKSPACE
1028)   100F CA 1F 10    		     JP Z,PRCH_DOBCKSPC	;
1029)   1012 FE 0A       		     CP 0X0A   ;LINE FEED JUST IGNORE IT	;LINE FEED JUST IGNORE IT
1030)   1014 C8          		     RET Z	;
1031)   1015 FE 0D       		     CP 0X0D   ;CHECK FOR ENTER	;CHECK FOR ENTER
1032)   1017 20 3A       		     JR NZ,PRCH_DOPRN	;
1033)   1019 21 0D 83    		     LD HL,CURSORX	;
1034)   101C C3 6C 11    		     JP PRCH_NEWLN 	;
1036)   101F 21 0D 83    		     LD HL,CURSORX      	;
1037)   1022 7E          		     LD A,(HL)	;
1038)   1023 38 05       		     JR C,DOREALBCKSPC	;
1040)   1025 FE 01       		     CP 1      ;COMPARE WITH COLUMN 1 CAUSE OF THE PROMPT ON COLUMN 0	;COMPARE WITH COLUMN 1 CAUSE OF THE PROMPT ON COLUMN 0
1041)   1027 C8          		     RET Z	;
1042)   1028 35          		     DEC (HL)	;
1043)   1029 C9          		     RET      	;
1045)   102A FE 01       		     CP 1      ;COMPARE WITH COLUMN 1 CAUSE OF THE PROMPT ON COLUMN 0	;COMPARE WITH COLUMN 1 CAUSE OF THE PROMPT ON COLUMN 0
1046)   102C 28 0A       		     JR Z,PRCH_DOBCKSPC2     ;IF 0 WE ARE ON THE 1ST COLUMN SO NOTHING TO DO JUST DELETE THE 8=BS FROM BUFFER	;IF 0 WE ARE ON THE 1ST COLUMN SO NOTHING TO DO JUST DELETE THE 8=BS FROM BUFFER
1047)   102E 35          		     DEC (HL)  ;GO 1 POSITION BACK	;GO 1 POSITION BACK
1048)   102F E5          		     PUSH HL	;
1049)   1030 3E 20       		     LD A,32   ;PRINT SPACE	;PRINT SPACE
1050)   1032 CD 53 10    		     CALL PRCH_DOPRN ;THIS FORWARDS THE CURSOR SO WE SHOULD GO BACK AGAIN	;THIS FORWARDS THE CURSOR SO WE SHOULD GO BACK AGAIN
1051)   1035 E1          		     POP HL	;
1052)   1036 35          		     DEC (HL)  ;GO 1 POSITION BACK	;GO 1 POSITION BACK
1053)   1037 B7          		     OR A      	;
1057)   1038 DD 21 02 00 		     LD IX,2	;
1058)   103C DD 39       		     ADD IX,SP	;
1059)   103E DD 66 01    		     LD H,(IX+1);POSITION IN ACCS FOR THE NEW CHARACTER      	;POSITION IN ACCS FOR THE NEW CHARACTER
1060)   1041 DD 6E 00    		     LD L,(IX) ;POSITION IN ACCS FOR THE NEW CHARACTER  	;POSITION IN ACCS FOR THE NEW CHARACTER
1061)   1044 3E 00       		     LD A,0    ;NOT XOR WE DONT WANT TO MESS WITH ZERO FLAG	;NOT XOR WE DONT WANT TO MESS WITH ZERO FLAG
1062)   1046 28 02       		     JR Z,PRCH_SKIP1  ;WE ARE ON COLUMN 1	;WE ARE ON COLUMN 1
1063)   1048 2B          		     DEC HL     ;PREVIOUS POSITION DELETE BACKSPACE	;PREVIOUS POSITION DELETE BACKSPACE
1064)   1049 77          		     LD (HL),A  ;PUT 0 ON LAST POSITION	;PUT 0 ON LAST POSITION
1066)   104A 2B          		     DEC HL     ;PREVIOUS POSITION DELETE PREVIOUS CHAR	;PREVIOUS POSITION DELETE PREVIOUS CHAR
1067)   104B 77          		     LD (HL),A  ;PUT 0 ON LAST POSITION      	;PUT 0 ON LAST POSITION
1068)   104C DD 74 01    		     LD (IX+1),H ;PUT POSITION BACK ON STACK IT WILL POPED	;PUT POSITION BACK ON STACK IT WILL POPED
1069)   104F DD 75 00    		     LD (IX),L	;
1070)   1052 C9          		     RET	;
1073)   1053 F5          		     PUSH AF  ;SAVE CHAR TO STACK	;SAVE CHAR TO STACK
1074)   1054 32 10 83    		     LD (LASTCHAR),A ;SAVE LAST PRINTED CHAR	;SAVE LAST PRINTED CHAR
1078)   1057 3A 16 83    		     LD A,(VDUMODE)	;
1079)   105A FE 05       		     CP 5	;
1080)   105C 20 19       		     JR NZ,VDU4	;
1081)   105E 2A 5F 83    		     LD HL,(GR_LASTX)	;
1082)   1061 E5          		     PUSH HL	;
1083)   1062 ED 5B 61 83 		     LD DE,(GR_LASTY)	;
1084)   1066 D5          		     PUSH DE	;
1085)   1067 01 07 00    		     LD BC,FONT_WIDTH-1	;
1086)   106A 09          		     ADD HL,BC	;
1087)   106B E5          		     PUSH HL	;
1088)   106C 01 09 00    		     LD BC,FONT_HEIGHT-1	;
1089)   106F EB          		     EX DE,HL	;
1090)   1070 09          		     ADD HL,BC	;
1091)   1071 E5          		     PUSH HL	;
1092)   1072 CD 2E 0B    		     CALL LCD_SETXY	;
1093)   1075 18 34       		     JR PRCHDO	;
1094)   1077 3A 0D 83    		VDU4: LD A,(CURSORX)	;
1095)   107A 06 08       		     LD B,FONT_WIDTH	;
1096)   107C 16 00       		     LD D,0	;
1097)   107E 5F          		     LD E,A	;
1098)   107F 21 00 00    		     LD HL,0	;
1099)   1082 B7          		     OR A          ; CLEAR CARRY	; CLEAR CARRY
1101)   1083 ED 5A       		     ADC HL,DE	;
1102)   1085 10 FC       		     DJNZ PRCH_AGN1 ;HL=DE*B	;HL=DE*B
1103)   1087 E5          		     PUSH HL       ;1ST PARAM X1	;1ST PARAM X1
1104)   1088 11 08 00    		     LD DE,FONT_WIDTH 	;
1105)   108B ED 5A       		     ADC HL,DE      	;
1106)   108D 2B          		     DEC HL	;
1107)   108E E5          		     PUSH HL       ;SAVE 3RD PARAM X2	;SAVE 3RD PARAM X2
1109)   108F CD E1 10    		     CALL LCD_CALCLINE ;SCROLL CALC	;SCROLL CALC
1110)   1092 06 0A       		     LD B,FONT_HEIGHT 	;
1111)   1094 16 00       		     LD D,0	;
1112)   1096 5F          		     LD E,A	;
1113)   1097 21 00 00    		     LD HL,0	;
1115)   109A ED 5A       		     ADC HL,DE	;
1116)   109C 10 FC       		     DJNZ PRCH_AGN2      	;
1117)   109E D1          		     POP DE        ;RETREIVE 3RD PARAM X2	;RETREIVE 3RD PARAM X2
1118)   109F E5          		     PUSH HL       ;2ND PARAM Y1	;2ND PARAM Y1
1119)   10A0 D5          		     PUSH DE       ;3RD PARAM X2	;3RD PARAM X2
1120)   10A1 11 0A 00    		     LD DE,FONT_HEIGHT	;
1121)   10A4 ED 5A       		     ADC HL,DE     ;CALC 4TH PARAM      	;CALC 4TH PARAM
1122)   10A6 2B          		     DEC HL        ;4TH PARAM -1  	;4TH PARAM -1
1123)   10A7 E5          		     PUSH HL    ;4TH PARAM Y2	;4TH PARAM Y2
1124)   10A8 CD 2E 0B    		     CALL LCD_SETXY	;
1125)   10AB F1          		PRCHDO: POP AF       ;CHAR TO PRINT FROM STACK	;CHAR TO PRINT FROM STACK
1126)   10AC B7          		     OR A	;
1127)   10AD 21 00 75    		     LD HL,FONT_ADDR	;
1128)   10B0 16 00       		     LD D,0	;
1129)   10B2 5F          		     LD E,A	;
1130)   10B3 ED 5A       		     ADC HL,DE     ;THIS IS THE CHAR ADDRESS	;THIS IS THE CHAR ADDRESS
1131)   10B5 E5          		     PUSH HL	;
1132)   10B6 D1          		     POP DE        ; CHAR ADDRESS ON DE	; CHAR ADDRESS ON DE
1133)   10B7 0E 0A       		     LD C,FONT_HEIGHT   ; TOTAL FONT LINES	; TOTAL FONT LINES
1135)   10B9 1A          		     LD A,(DE)           ;FONT 8BIT PATTERN FOR A LINE	;FONT 8BIT PATTERN FOR A LINE
1136)   10BA 06 08       		     LD B,FONT_WIDTH      	;
1138)   10BC CB 27       		     SLA A               ;CHECK BIT FOR 1=FCOLOR OR 0=BCOLOR	;CHECK BIT FOR 1=FCOLOR OR 0=BCOLOR
1139)   10BE 38 05       		     JR C,FORECOLOR	;
1140)   10C0 2A 03 83    		     LD HL,(BCOLOR)	;
1141)   10C3 18 03       		     JR PRCH_CONT	;
1143)   10C5 2A 01 83    		     LD HL,(FCOLOR)      	;
1145)   10C8 F5          		     PUSH AF	;
1146)   10C9 D5          		     PUSH DE             ;TODO:PROBABLY NOT NEEDED HERE 	;TODO:PROBABLY NOT NEEDED HERE
1147)   10CA CD 7B 0B    		     CALL LCD_SETPIXEL	;
1148)   10CD D1          		     POP DE	;
1149)   10CE F1          		     POP AF      	;
1150)   10CF 10 EB       		     DJNZ PRCH_AGN4	;
1151)   10D1 14          		     INC D             ;ADD 256 FOR NEXT CHAR PATTERN	;ADD 256 FOR NEXT CHAR PATTERN
1152)   10D2 0D          		     DEC C	;
1153)   10D3 20 E4       		     JR NZ,PRCH_AGN3	;
1155)   10D5 21 0D 83    		     LD HL,CURSORX	;
1156)   10D8 7E          		     LD A,(HL)	;
1157)   10D9 3C          		     INC A	;
1158)   10DA FE 50       		     CP 80	;
1159)   10DC CA 6C 11    		     JP Z,PRCH_NEWLN  ;NEW LINE	;NEW LINE
1160)   10DF 77          		     LD (HL),A	;
1161)   10E0 C9          		     RET	;
1164)   10E1 3A 0F 83    		@LCD_CALCLINE: LD A,(SCRLN)	;
1165)   10E4 57          		               LD D,A 	;
1166)   10E5 3A 0E 83    		               LD A,(CURSORY)  ;480/10 MAKES 48 LINES                	;480/10 MAKES 48 LINES
1167)   10E8 82          		               ADD A,D	;
1168)   10E9 FE 30       		               CP TOTLINES	;
1169)   10EB D8          		               RET C	;
1171)   10EC D6 30       		               SUB TOTLINES	;
1172)   10EE C9          		               RET             	;
1177)   10EF 16 33       		LCD_SETSCROLL: LD D,0x33	;
1178)   10F1 CD B5 09    		               CALL LCD_WR_COM	;
1179)   10F4 16 00       		 LD D,0X00 ;TOP FIXED NO OF LINES 2 BYTES HIGH (0)	;TOP FIXED NO OF LINES 2 BYTES HIGH (0)
1180)   10F6 CD B1 09    		               CALL LCD_WR_DAT	;
1181)   10F9 16 00       		 LD D,0X00 ;TOP FIXED NO OF LINES 2 BYTES LOW	;TOP FIXED NO OF LINES 2 BYTES LOW
1182)   10FB CD B1 09    		               CALL LCD_WR_DAT	;
1183)   10FE 16 01       		 LD D,0X01 ;SCROLL LINES NO OF LINES 2 BYTES HIGH (480)	;SCROLL LINES NO OF LINES 2 BYTES HIGH (480)
1184)   1100 CD B1 09    		               CALL LCD_WR_DAT	;
1185)   1103 16 E0       		 LD D,0XE0 ;SCROLL LINES NO OF LINES 2 BYTES LOW	;SCROLL LINES NO OF LINES 2 BYTES LOW
1186)   1105 CD B1 09    		               CALL LCD_WR_DAT	;
1187)   1108 16 00       		 LD D,0X00 ;BOTTOM FIXED NO OF LINES 2 BYTES HIGH (0)	;BOTTOM FIXED NO OF LINES 2 BYTES HIGH (0)
1188)   110A CD B1 09    		               CALL LCD_WR_DAT	;
1189)   110D 16 00       		 LD D,0X00 ;BOTTOM FIXED NO OF LINES 2 BYTES LOW	;BOTTOM FIXED NO OF LINES 2 BYTES LOW
1190)   110F CD B1 09    		               CALL LCD_WR_DAT	;
1191)   1112 AF          		               XOR A	;
1192)   1113 32 0F 83    		               LD (SCRLN),A	;
1193)   1116 C9          		 RET	;
1196)   1117 3A 0F 83    		@LCD_DOSCROLL:  LD A,(SCRLN)	;
1197)   111A 3C          		               INC A	;
1198)   111B FE 30       		               CP TOTLINES	;
1199)   111D 38 02       		               JR C, DS_NXT	;
1200)   111F D6 30       		               SUB TOTLINES	;
1201)   1121 32 0F 83    		DS_NXT:        LD (SCRLN),A	;
1202)   1124 6F          		               LD L,A	;
1203)   1125 26 00       		               LD H,0	;
1204)   1127 29          		               ADD HL,HL ;*10=FONT_HEIGHT	;*10=FONT_HEIGHT
1205)   1128 29          		               ADD HL,HL	;
1206)   1129 29          		               ADD HL,HL  	;
1207)   112A 5F          		               LD E,A	;
1208)   112B 16 00       		               LD D,0	;
1209)   112D 19          		               ADD HL,DE	;
1210)   112E 19          		               ADD HL,DE	;
1211)   112F 16 37       		               LD D,0x37	;
1212)   1131 CD B5 09    		               CALL LCD_WR_COM	;
1213)   1134 54          		 LD D,H ;NEW TOP SCROLL LINE BYTES HIGH (1-480) 	;NEW TOP SCROLL LINE BYTES HIGH (1-480)
1214)   1135 CD B1 09    		               CALL LCD_WR_DAT	;
1215)   1138 55          		 LD D,L ;NEW TOP SCROLL LINE BYTES LOW	;NEW TOP SCROLL LINE BYTES LOW
1216)   1139 CD B1 09    		               CALL LCD_WR_DAT	;
1217)   113C C9          		               RET	;
1220)   113D 11 00 00    		@LCD_CLRTXTLN: LD DE,0	;
1222)   1140 D5          		               PUSH DE	;
1223)   1141 6F          		               LD L,A	;
1224)   1142 26 00       		               LD H,0	;
1225)   1144 29          		               ADD HL,HL ;*10=FONT_HEIGHT	;*10=FONT_HEIGHT
1226)   1145 29          		               ADD HL,HL	;
1227)   1146 29          		               ADD HL,HL  	;
1228)   1147 5F          		               LD E,A	;
1229)   1148 16 00       		               LD D,0	;
1230)   114A 19          		               ADD HL,DE	;
1231)   114B 19          		               ADD HL,DE	;
1233)   114C E5          		               PUSH HL  	;
1234)   114D 11 0A 00    		               LD DE,FONT_HEIGHT	;
1235)   1150 19          		               ADD HL,DE	;
1237)   1151 EB          		               EX DE,HL                	;
1238)   1152 21 1F 03    		               LD HL,LCD_WIDTH	;
1240)   1155 E5          		               PUSH HL	;
1241)   1156 D5          		               PUSH DE ;PARAM4	;PARAM4
1242)   1157 CD 2E 0B    		               CALL LCD_SETXY	;
1243)   115A 01 40 1F    		               LD BC, 8000; LCD_WIDTH * FONT_HEIGHT ;8000 BYTES 800*10	; LCD_WIDTH * FONT_HEIGHT ;8000 BYTES 800*10
1244)   115D 2A 03 83    		               LD HL,(BCOLOR)     	;
1245)   1160 CD 7B 0B    		CTL_AGN:       CALL LCD_SETPIXEL ;DESTROYS D,A	;DESTROYS D,A
1246)   1163 0B          		               DEC BC	;
1247)   1164 78          		               LD A,B	;
1248)   1165 B1          		               OR C	;
1249)   1166 20 F8       		               JR NZ,CTL_AGN	;
1250)   1168 CD E3 0B    		       CALL LCD_CLRXY 	;
1251)   116B C9          		       RET                	;
1255)   116C AF          		     XOR A  	;
1256)   116D 77          		     LD (HL),A   	;
1257)   116E 23          		     INC HL	;
1258)   116F 7E          		     LD A,(HL)	;
1259)   1170 3C          		     INC A       	;
1261)   1171 FE 30       		     CP 48         ;47 LINES MAX THEN WRAP OR BETTER SCROLL THE SCREEN!!!	;47 LINES MAX THEN WRAP OR BETTER SCROLL THE SCREEN!!!
1262)   1173 28 02       		     JR Z,PRCH_SCROLL	;
1263)   1175 77          		     LD (HL),A                             	;
1264)   1176 C9          		     RET	;
1266)   1177 F5          		PRCH_SCROLL: PUSH AF	;
1267)   1178 E5          		     PUSH HL	;
1269)   1179 3A 0F 83    		     LD A,(SCRLN)	;
1270)   117C CD 3D 11    		     CALL LCD_CLRTXTLN	;
1272)   117F CD 17 11    		     CALL LCD_DOSCROLL	;
1273)   1182 E1          		     POP HL	;
1274)   1183 F1          		     POP AF	;
1276)   1184 3D          		     DEC A	;
1277)   1185 77          		     LD (HL),A ;CURSORY                            	;CURSORY
1278)   1186 AF          		     XOR A	;
1279)   1187 32 0D 83    		     LD (CURSORX),A	;
1280)   118A C9          		     RET	;
1295)   118B 2A 03 83    		     LD HL,(BCOLOR);      	;
1296)   118E 18 03       		     JR LCD_SETCURS	;
1307)   1190 2A 01 83    		     LD HL,(FCOLOR)      ;COLOR PARAM      	;COLOR PARAM
1310)   1193 E5          		     PUSH HL             ;COLOR PARAM	;COLOR PARAM
1311)   1194 3A 0D 83    		     LD A,(CURSORX)	;
1312)   1197 06 08       		     LD B,FONT_WIDTH	;
1313)   1199 16 00       		     LD D,0	;
1314)   119B 5F          		     LD E,A	;
1315)   119C 21 00 00    		     LD HL,0	;
1316)   119F B7          		     OR A                ;CLEAR CARRY	;CLEAR CARRY
1318)   11A0 ED 5A       		     ADC HL,DE	;
1319)   11A2 10 FC       		     DJNZ SCUR_AGN1      ;HL = DE * B 	;HL = DE * B
1320)   11A4 E5          		     PUSH HL             ;1ST PARAM X1	;1ST PARAM X1
1321)   11A5 01 08 00    		     LD BC,FONT_WIDTH	;
1322)   11A8 ED 4A       		     ADC HL,BC           ;NEXT CHAR	;NEXT CHAR
1323)   11AA 2B          		     DEC HL              ;MINUS 1	;MINUS 1
1324)   11AB E5          		     PUSH HL             ;SAVE 3RD PARAM X2      	;SAVE 3RD PARAM X2
1326)   11AC CD E1 10    		     CALL LCD_CALCLINE	;
1327)   11AF 06 0A       		     LD B,FONT_HEIGHT 	;
1328)   11B1 16 00       		     LD D,0	;
1329)   11B3 5F          		     LD E,A	;
1330)   11B4 21 00 00    		     LD HL,0	;
1332)   11B7 ED 5A       		     ADC HL,DE	;
1333)   11B9 10 FC       		     DJNZ SCUR_AGN2      ;HL=B*DE	;HL=B*DE
1334)   11BB 0E 08       		     LD C,FONT_HEIGHT-2  ;2 PIXEL HEIGTH CURSOR       	;2 PIXEL HEIGTH CURSOR
1335)   11BD 06 00       		     LD B,0	;
1336)   11BF ED 4A       		     ADC HL,BC           ;ADD FONT_HEIGHT-2 PIXELS	;ADD FONT_HEIGHT-2 PIXELS
1337)   11C1 D1          		     POP DE              ;RETREIVE 3RD PARAM ON DE	;RETREIVE 3RD PARAM ON DE
1338)   11C2 E5          		     PUSH HL             ;2ND PARAM Y1	;2ND PARAM Y1
1339)   11C3 D5          		     PUSH DE             ;3RD PARAM X2	;3RD PARAM X2
1341)   11C4 23          		     INC HL              ; Y2 ADD THE LAST +2 PIXELS  	; Y2 ADD THE LAST +2 PIXELS
1342)   11C5 E5          		     PUSH HL             ;4TH PARAM Y2	;4TH PARAM Y2
1343)   11C6 CD 2E 0B    		     CALL LCD_SETXY	;
1345)   11C9 E1          		     POP HL              ;GET THE COLOR	;GET THE COLOR
1346)   11CA 06 10       		     LD B,2*FONT_WIDTH   ;2*8=16	;2*8=16
1348)   11CC CD 7B 0B    		     CALL LCD_SETPIXEL   ;DESTROYS D,A	;DESTROYS D,A
1349)   11CF 10 FB       		     DJNZ SCUR_AGN3                            	;
1354)   11D1 C9          		     RET	;
1357)   11D2 CD E3 0B    		    CALL LCD_CLRXY;	;
1358)   11D5 2A 03 83    		    LD HL,(BCOLOR)     	;
1360)   11D8 01 E0 01    		    LD BC,LCD_HEIGHT+1	;
1361)   11DB C5          		CS_AGNA2: PUSH BC	;
1362)   11DC 01 20 03    		    LD BC,LCD_WIDTH+1	;
1363)   11DF CD 7B 0B    		CS_AGNA1: CALL LCD_SETPIXEL         ;DESTROYS D,A, HL HAS COLOR INFO	;DESTROYS D,A, HL HAS COLOR INFO
1364)   11E2 0B          		    DEC BC	;
1365)   11E3 78          		    LD A,B	;
1366)   11E4 B1          		    OR C	;
1367)   11E5 20 F8       		    JR NZ,CS_AGNA1	;
1368)   11E7 C1          		    POP BC	;
1369)   11E8 0B          		    DEC BC	;
1370)   11E9 78          		    LD A,B	;
1371)   11EA B1          		    OR C     	;
1372)   11EB 20 EE       		    JR NZ,CS_AGNA2	;
1373)   11ED 21 00 00    		    LD HL,0                   ;RESET CURSOR AT 0,0	;RESET CURSOR AT 0,0
1374)   11F0 22 0D 83    		    LD (CURSORX),HL       	;
1375)   11F3 C9          		  RET	;
1380)   11F4 06 DF       		    LD B,LCD_HEIGHT.AND.0xFF   ;lsb	;lsb
1381)   11F6 0E 02       		    LD C,LCD_HEIGHT.SHR.8+1      ;MSB+1	;MSB+1
1383)   11F8 C5          		    PUSH BC          	;
1385)   11F9 06 1F       		    LD B,LCD_WIDTH.AND.0xFF   ;lsb	;lsb
1386)   11FB 0E 04       		    LD C,LCD_WIDTH.SHR.8+1      ;MSV+1          	;MSV+1
1388)   11FD CD 7B 0B    		    CALL LCD_SETPIXEL         ;DESTROYS D,A, HL HAS COLOR INFO	;DESTROYS D,A, HL HAS COLOR INFO
1389)   1200 10 FB       		    DJNZ CS_AGN1	;
1390)   1202 0D          		    DEC C	;
1391)   1203 20 F8       		    JR NZ,CS_AGN1     	;
1392)   1205 C1          		    POP BC	;
1393)   1206 10 F0       		    DJNZ CS_AGN2	;
1394)   1208 0D          		    DEC C	;
1395)   1209 20 ED       		    JR NZ,CS_AGN2 	;
1396)   120B 21 00 00    		    LD HL,0                   ;RESET CURSOR AT 0,0	;RESET CURSOR AT 0,0
1397)   120E 22 0D 83    		    LD (CURSORX),HL       	;
1398)   1211 C9          		    RET	;
1404)   1212 7E          		    LD A,(HL)	;
1405)   1213 FE 00       		    CP 0	;
1406)   1215 C8          		    RET Z	;
1407)   1216 E5          		    PUSH HL	;
1408)   1217 CD 0D 10    		    CALL LCD_PRINTCHAR     	;
1409)   121A E1          		    POP HL	;
1410)   121B 23          		    INC HL	;
1411)   121C 18 F4       		    JR LCD_MSG	;
  4)   121E AF          		NEGHL:xor a	;
  5)   121F 95          		     sub l	;
  6)   1220 6F          		     ld l,a	;
  7)   1221 9F          		     sbc a,a	;
  8)   1222 94          		     sub h	;
  9)   1223 67          		     ld h,a	;
 10)   1224 C9          		     RET	;
 14)   1225 2A 79 83    		     LD HL,(FILL_IDX)	;
 15)   1228 01 58 02    		     LD BC,MAXQ	;
 16)   122B A7          		     AND A	;
 17)   122C ED 42       		     SBC HL,BC	;
 18)   122E D0          		     RET NC ;IF IDX=HL>=MAXQ THEN EXIT	;IF IDX=HL>=MAXQ THEN EXIT
 19)   122F 2A 7B 83    		     LD HL,(FILL_PY)	;
 20)   1232 ED 5B 81 83 		     LD DE,(FILL_PDY)	;
 21)   1236 19          		     ADD HL,DE	;
 22)   1237 7C          		     LD A,H	;
 23)   1238 FE 80       		     CP 80H	;
 24)   123A D0          		     RET NC ;NC MEANS NEGATIVE <0	;NC MEANS NEGATIVE <0
 25)   123B 11 1F 03    		     LD DE,LCD_WIDTH	;
 26)   123E ED 52       		     SBC HL,DE	;
 27)   1240 D0          		     RET NC  ;C MEANS Y+DY<=LCD_WIDTH	;C MEANS Y+DY<=LCD_WIDTH
 29)   1241 2A 77 83    		     LD HL,(FILL_Q)	;
 30)   1244 ED 4B 79 83 		     LD BC,(FILL_IDX)	;
 31)   1248 78          		     LD A,B	;
 32)   1249 B1          		     OR C         ;IF IDX=0 THEN NXT1	;IF IDX=0 THEN NXT1
 33)   124A 28 08       		     JR Z,QPS_NXT1 	;
 34)   124C EB          		     EX DE,HL	;
 35)   124D C5          		     PUSH BC	;
 36)   124E E1          		     POP HL      	;
 37)   124F 29          		     ADD HL, HL	;
 38)   1250 29          		     ADD HL, HL	;
 39)   1251 29          		     ADD HL, HL        ; SLEFT 3 TIMES MEANS *8	; SLEFT 3 TIMES MEANS *8
 40)   1252 EB          		     EX DE,HL	;
 41)   1253 19          		     ADD HL,DE      	;
 43)   1254 11 7B 83    		     LD DE,FILL_PY	;
 44)   1257 EB          		     EX DE,HL  ;DEST=QUEUE ORIGIN=FILL_PY	;DEST=QUEUE ORIGIN=FILL_PY
 45)   1258 01 08 00    		     LD BC,8   ;8 BYTES	;8 BYTES
 46)   125B ED B0       		     LDIR      ;COPY	;COPY
 47)   125D 2A 79 83    		     LD HL,(FILL_IDX)      	;
 48)   1260 23          		     INC HL	;
 49)   1261 22 79 83    		     LD (FILL_IDX),HL	;
 50)   1264 C9          		QPS_EXT: RET   	;
 52)   1265 2A 77 83    		QPOP: LD HL,(FILL_Q)	;
 53)   1268 ED 4B 79 83 		     LD BC,(FILL_IDX)	;
 54)   126C 0B          		     DEC BC      	;
 55)   126D C5          		     PUSH BC	;
 56)   126E 78          		     LD A,B	;
 57)   126F B1          		     OR C         ;IF IDX=0 THEN WE ARE ON START	;IF IDX=0 THEN WE ARE ON START
 58)   1270 28 08       		     JR Z,QPP_NXT1                        	;
 59)   1272 EB          		     EX DE,HL	;
 60)   1273 C5          		     PUSH BC	;
 61)   1274 E1          		     POP HL      	;
 62)   1275 29          		     ADD HL, HL	;
 63)   1276 29          		     ADD HL, HL	;
 64)   1277 29          		     ADD HL, HL        ; SLEFT 3 TIMES MEANS *8	; SLEFT 3 TIMES MEANS *8
 65)   1278 EB          		     EX DE,HL	;
 66)   1279 19          		     ADD HL,DE      	;
 67)   127A C1          		QPP_NXT1: POP BC 	;
 68)   127B ED 43 79 83 		     LD (FILL_IDX),BC	;
 70)   127F 11 7B 83    		     LD DE,FILL_PY  ;ORIGIN=QUEUE DEST=FILL_PY               	;ORIGIN=QUEUE DEST=FILL_PY
 71)   1282 01 08 00    		     LD BC,8   ;8 BYTES	;8 BYTES
 72)   1285 ED B0       		     LDIR      ;COPY	;COPY
 73)   1287 2A 7D 83    		     LD HL,(FILL_PXL)	;
 74)   128A 22 71 83    		     LD (FILL_X1),HL	;
 75)   128D 2A 7F 83    		     LD HL,(FILL_PXR)	;
 76)   1290 22 73 83    		     LD (FILL_X2),HL	;
 77)   1293 ED 5B 81 83 		     LD DE,(FILL_PDY)	;
 78)   1297 ED 53 75 83 		     LD (FILL_DY),DE      	;
 79)   129B 2A 7B 83    		     LD HL,(FILL_PY)	;
 80)   129E A7          		     AND A	;
 81)   129F 19          		     ADD HL,DE	;
 82)   12A0 22 6D 83    		     LD (FILL_Y),HL 	;
 90)   12A3 C9          		     RET	;
 92)   12A4 E1          		@_FILL: POP HL        ;GET THE RETURN ADDRESS	;GET THE RETURN ADDRESS
 93)   12A5 D1          		     POP DE          ;Y	;Y
 94)   12A6 C1          		     POP BC          ;X      	;X
 95)   12A7 E5          		     PUSH HL         ;RET ADDR TO SP	;RET ADDR TO SP
 96)   12A8 ED 43 6B 83 		     LD (FILL_X),BC	;
 97)   12AC ED 53 6D 83 		     LD (FILL_Y),DE   	;
 98)   12B0 ED 73 85 83 		     LD (FILL_OLDSP),SP   	;
 99)   12B4 21 3E ED    		     LD HL,-((MAXQ*8)+2) ; MAKE SPACE FOR OUR QUEUE	; MAKE SPACE FOR OUR QUEUE
100)   12B7 39          		     ADD HL,SP	;
101)   12B8 F9          		     LD SP,HL        ;NEW SP	;NEW SP
104)   12B9 22 77 83    		     LD (FILL_Q),HL  ;START OF QUEUE STACK VAR IN C	;START OF QUEUE STACK VAR IN C
105)   12BC 21 00 00    		     LD HL,0	;
106)   12BF 22 79 83    		     LD (FILL_IDX),HL ;INDEX OF ITEMS SP IN C	;INDEX OF ITEMS SP IN C
110)   12C2 2A 6B 83    		     LD HL,(FILL_X);	;
111)   12C5 E5          		     PUSH HL	;
112)   12C6 2A 6D 83    		     LD HL,(FILL_y);	;
113)   12C9 E5          		     PUSH HL	;
114)   12CA CD 92 0B    		     CALL LCD_READPIXEL	;
115)   12CD 22 83 83    		     LD (FILL_OV),HL	;
117)   12D0 ED 5B 01 83 		     LD DE,(FCOLOR)	;
118)   12D4 A7          		     AND A	;
119)   12D5 ED 52       		     SBC HL,DE      ;CHK OV=NV	;CHK OV=NV
120)   12D7 CA 5C 14    		     JP Z,FL_EXIT	;
121)   12DA 2A 6B 83    		     LD HL,(FILL_X)	;
122)   12DD 7C          		     LD A,H	;
123)   12DE FE 80       		     CP 0x80         ;CHK <0	;CHK <0
124)   12E0 D2 5C 14    		     JP NC,FL_EXIT	;
125)   12E3 11 1F 03    		     LD DE,LCD_WIDTH 	;
126)   12E6 A7          		     AND A	;
127)   12E7 ED 52       		     SBC HL,DE       ;CHK>799	;CHK>799
128)   12E9 D2 5C 14    		     JP NC,FL_EXIT	;
129)   12EC 2A 6D 83    		     LD HL,(FILL_Y)	;
130)   12EF 7C          		     LD A,H	;
131)   12F0 FE 80       		     CP 0x80         ;CHK <0	;CHK <0
132)   12F2 D2 5C 14    		     JP NC,FL_EXIT	;
133)   12F5 11 DF 01    		     LD DE,LCD_HEIGHT 	;
134)   12F8 A7          		     AND A	;
135)   12F9 ED 52       		     SBC HL,DE       ;CHK>480	;CHK>480
136)   12FB D2 5C 14    		     JP NC,FL_EXIT           	;
138)   12FE 2A 6D 83    		     LD HL,(FILL_Y)	;
139)   1301 22 7B 83    		     LD (FILL_PY),HL	;
140)   1304 2A 6B 83    		     LD HL,(FILL_X)	;
141)   1307 22 7D 83    		     LD (FILL_PXL),HL	;
142)   130A 22 7F 83    		     LD (FILL_PXR),HL	;
143)   130D 21 01 00    		     LD HL,1	;
144)   1310 22 81 83    		     LD (FILL_PDY),HL	;
145)   1313 CD 25 12    		     CALL QPUSH         ;     /PUSH VALUES TO QUEUE ADD 8 TO IDX	;     /PUSH VALUES TO QUEUE ADD 8 TO IDX
147)   1316 2A 6D 83    		     LD HL,(FILL_Y)	;
148)   1319 23          		     INC HL	;
149)   131A 22 7B 83    		     LD (FILL_PY),HL	;
150)   131D 21 FF FF    		     LD HL,-1	;
151)   1320 22 81 83    		     LD (FILL_PDY),HL	;
152)   1323 CD 25 12    		     CALL QPUSH	;
154)   1326 ED 5B 79 83 		    LD DE,(FILL_IDX)	;
155)   132A 7A          		    LD A,D	;
156)   132B B3          		    OR E	;
157)   132C CA 5C 14    		    JP Z,FL_EXIT    ; IF FILL_IDX=0 THEN NO MORE ITEMS ON QUEUE SO EXIT 	; IF FILL_IDX=0 THEN NO MORE ITEMS ON QUEUE SO EXIT
161)   132F CD 65 12    		     CALL QPOP            ;POP VALUES FROM QUEUE SUB 8 FROM IDX TO Y,X1,X2,DY	;POP VALUES FROM QUEUE SUB 8 FROM IDX TO Y,X1,X2,DY
164)   1332 2A 71 83    		      LD HL,(FILL_X1)	;
165)   1335 22 6B 83    		     LD (FILL_X),HL	;
166)   1338 7C          		FL_LP1: LD A,H	;
167)   1339 FE 80       		     CP 0x80          ;CHK X<0 THEN EXIT LOOP	;CHK X<0 THEN EXIT LOOP
168)   133B D2 63 13    		     JP NC,FL_NXT1	;
169)   133E ED 5B 6D 83 		     LD DE,(FILL_Y)	;
170)   1342 E5          		     PUSH HL	;
171)   1343 D5          		     PUSH DE	;
172)   1344 CD 92 0B    		     CALL LCD_READPIXEL	;
173)   1347 ED 5B 83 83 		     LD DE,(FILL_OV)	;
174)   134B A7          		     AND A	;
175)   134C ED 52       		     SBC HL,DE      ;PIXELREAD<>0 THEN  EXIT LOOP	;PIXELREAD<>0 THEN  EXIT LOOP
176)   134E C2 63 13    		     JP NZ,FL_NXT1	;
177)   1351 ED 5B 6B 83 		     LD DE,(FILL_X)	;
178)   1355 2A 6D 83    		     LD HL,(FILL_Y)	;
179)   1358 D5          		     PUSH DE	;
180)   1359 CD 6B 0E    		     CALL PLOTP	;
181)   135C E1          		     POP HL	;
182)   135D 2B          		     DEC HL	;
183)   135E 22 6B 83    		     LD (FILL_X),HL	;
184)   1361 18 D5       		     JR FL_LP1     	;
188)   1363 2A 6B 83    		     LD HL,(FILL_X)	;
189)   1366 ED 5B 71 83 		     LD DE,(FILL_X1)	;
190)   136A 7C          		     LD A,H	;
191)   136B FE 80       		     CP 80H	;
192)   136D 30 08       		     JR NC,FL_NXT1A   ;IF X<0 THEN X<X1 IF NEGATIVE DON'T SKIP      	;IF X<0 THEN X<X1 IF NEGATIVE DON'T SKIP
193)   136F A7          		     AND A	;
194)   1370 ED 52       		     SBC HL,DE       ;CHK X-X1<0 THEN CONTINUE ELSE SKIP	;CHK X-X1<0 THEN CONTINUE ELSE SKIP
195)   1372 D2 1A 14    		     JP NC,FL_SKIP   ;C IF DE>HL X1>X, NC IF X>=X1    	;C IF DE>HL X1>X, NC IF X>=X1
196)   1375 ED 5A       		     ADC HL,DE	;
199)   1377 23          		    INC HL	;
200)   1378 22 6F 83    		    LD (FILL_L),HL	;
203)   137B A7          		    AND A     	;
204)   137C ED 52       		    SBC HL,DE   ;CHK L-X1	;CHK L-X1
205)   137E 30 1E       		    JR NC,FL_NXT2   ;C IF DE>HL X1>L	;C IF DE>HL X1>L
206)   1380 28 1C       		    JR Z,FL_NXT2	;
207)   1382 ED 5A       		    ADC HL,DE	;
208)   1384 22 7D 83    		    LD (FILL_PXL),HL ;L	;L
209)   1387 2A 6D 83    		    LD HL,(FILL_Y)	;
210)   138A 22 7B 83    		    LD (FILL_PY),HL	;
211)   138D 1B          		    DEC DE	;
212)   138E ED 53 7F 83 		    LD (FILL_PXR),DE	;
213)   1392 2A 75 83    		    LD HL,(FILL_DY) 	;
214)   1395 CD 1E 12    		    CALL NEGHL	;
215)   1398 22 81 83    		    LD (FILL_PDY),HL     	;
216)   139B CD 25 12    		    CALL QPUSH     	;
220)   139E 2A 71 83    		     LD HL,(FILL_X1)  ;COULD USE DE=X1 OR DE=X1-1 IF WE INCREASE IT	;COULD USE DE=X1 OR DE=X1-1 IF WE INCREASE IT
221)   13A1 23          		     INC HL	;
222)   13A2 22 6B 83    		     LD (FILL_X),HL	;
226)   13A5 11 1F 03    		   LD DE,LCD_WIDTH	;
227)   13A8 A7          		   AND A	;
228)   13A9 EB          		   EX DE,HL	;
229)   13AA ED 52       		   SBC HL,DE    ;800-(X=DE)	;800-(X=DE)
230)   13AC 38 24       		   JR C,FL_NXT3   ;C IF X>800	;C IF X>800
231)   13AE EB          		   EX DE,HL      ;HL=X	;HL=X
232)   13AF E5          		   PUSH HL	;
233)   13B0 2A 6D 83    		   LD HL,(FILL_Y)	;
234)   13B3 E5          		   PUSH HL	;
235)   13B4 CD 92 0B    		   CALL LCD_READPIXEL	;
236)   13B7 ED 5B 83 83 		   LD DE,(FILL_OV)	;
237)   13BB A7          		   AND A	;
238)   13BC ED 52       		   SBC HL,DE       ;PIXELREAD=OV	;PIXELREAD=OV
239)   13BE 20 12       		   JR NZ,FL_NXT3	;
240)   13C0 ED 5B 6B 83 		   LD DE,(FILL_X)	;
241)   13C4 2A 6D 83    		   LD HL,(FILL_Y)	;
242)   13C7 D5          		   PUSH DE	;
243)   13C8 CD 6B 0E    		   CALL PLOTP	;
244)   13CB E1          		   POP HL	;
245)   13CC 23          		   INC HL	;
246)   13CD 22 6B 83    		   LD (FILL_X),HL	;
247)   13D0 18 D3       		   JR FL_LP2	;
250)   13D2 2A 6D 83    		    LD HL,(FILL_Y)	;
251)   13D5 22 7B 83    		    LD (FILL_PY),HL	;
252)   13D8 2A 6F 83    		    LD HL,(FILL_L)	;
253)   13DB 22 7D 83    		    LD (FILL_PXL),HL	;
254)   13DE 2A 6B 83    		    LD HL,(FILL_X)	;
255)   13E1 2B          		    DEC HL	;
256)   13E2 22 7F 83    		    LD (FILL_PXR),HL	;
257)   13E5 2A 75 83    		    LD HL,(FILL_DY)	;
258)   13E8 22 81 83    		    LD (FILL_PDY),HL	;
259)   13EB CD 25 12    		    CALL QPUSH         	;
261)   13EE 2A 6B 83    		    LD HL,(FILL_X)	;
262)   13F1 ED 5B 73 83 		    LD DE,(FILL_X2)	;
263)   13F5 13          		    INC DE	;
264)   13F6 A7          		    AND A	;
265)   13F7 ED 52       		    SBC HL,DE    ;X-(X2+1) C IF X2+1>X 	;X-(X2+1) C IF X2+1>X
266)   13F9 38 1F       		    JR C,FL_NXT4	;
267)   13FB 28 1D       		    JR Z,FL_NXT4	;
268)   13FD 2A 6D 83    		    LD HL,(FILL_Y)	;
269)   1400 22 7B 83    		    LD (FILL_PY),HL	;
270)   1403 ED 53 7D 83 		    LD (FILL_PXL),DE	;
271)   1407 2A 6B 83    		    LD HL,(FILL_X);	;
272)   140A 2B          		    DEC HL	;
273)   140B 22 7F 83    		    LD (FILL_PXR),HL	;
274)   140E 2A 75 83    		    LD HL,(FILL_DY)	;
275)   1411 CD 1E 12    		    CALL NEGHL	;
276)   1414 22 81 83    		    LD (FILL_PDY),HL  	;
277)   1417 CD 25 12    		    CALL QPUSH         	;
280)   141A 2A 6B 83    		       LD HL,(FILL_X)	;
281)   141D 23          		       INC HL	;
282)   141E 22 6B 83    		       LD (FILL_X),HL	;
283)   1421 ED 5B 73 83 		FL_LP3: LD DE,(FILL_X2)	;
284)   1425 A7          		       AND A	;
285)   1426 EB          		       EX DE,HL         ;X2=HL X=DE	;X2=HL X=DE
286)   1427 ED 52       		       SBC HL,DE        ;C IF DE>HL X>X2       	;C IF DE>HL X>X2
287)   1429 38 1C       		       JR C,FL_NXT5	;
288)   142B 19          		       ADD HL,DE        ;	;
289)   142C EB          		       EX DE,HL         ;X=HL X2=DE	;X=HL X2=DE
290)   142D E5          		       PUSH HL	;
291)   142E 2A 6D 83    		       LD HL,(FILL_Y)	;
292)   1431 E5          		       PUSH HL	;
293)   1432 CD 92 0B    		       CALL LCD_READPIXEL	;
294)   1435 ED 5B 83 83 		       LD DE,(FILL_OV)	;
295)   1439 A7          		       AND A	;
296)   143A ED 52       		       SBC HL,DE     ;CHK PIXELREAD!=OV ELSE EXIT LOOP	;CHK PIXELREAD!=OV ELSE EXIT LOOP
297)   143C 28 09       		       JR Z,FL_NXT5	;
298)   143E 2A 6B 83    		       LD HL,(FILL_X)	;
299)   1441 23          		       INC HL	;
300)   1442 22 6B 83    		       LD (FILL_X),HL	;
301)   1445 18 DA       		       JR FL_LP3	;
304)   1447 2A 6B 83    		       LD HL,(FILL_X)	;
305)   144A 22 6F 83    		       LD (FILL_L),HL	;
307)   144D ED 5B 73 83 		      LD DE,(FILL_X2)	;
308)   1451 A7          		      AND A	;
309)   1452 EB          		      EX DE,HL    ;X2=HL X=DE	;X2=HL X=DE
310)   1453 ED 52       		      SBC HL,DE   ;X2-X C IF X>X2	;X2-X C IF X>X2
311)   1455 EB          		      EX DE,HL    ;X=HL X2-X=DE	;X=HL X2-X=DE
312)   1456 DA 26 13    		      JP C,FL_LP0 ; IF X>X2 THEN EXIT DO WHILE GOTO ;while (sp>stack)	; IF X>X2 THEN EXIT DO WHILE GOTO ;while (sp>stack)
313)   1459 C3 A5 13    		      JP FL_LP2   ;GOTO DO WHILE	;GOTO DO WHILE
316)   145C 21 C2 12    		FL_EXIT: LD HL,(MAXQ*8)+2 ; RETREIVE SPACE FOR OUR QUEUE	; RETREIVE SPACE FOR OUR QUEUE
317)   145F 39          		        ADD HL,SP	;
318)   1460 F9          		        LD SP,HL        ;NEW SP	;NEW SP
319)   1461 C9          		        RET	;
  9)   1462 FE 01       		    CP 1          ;IS IT FOR GRAPHICS?	;IS IT FOR GRAPHICS?
 10)   1464 28 0E       		    JR Z,GRCOLS	;
 11)   1466 21 03 83    		    LD HL,BCOLOR	;
 12)   1469 22 69 83    		    LD (GR_PARAM4),HL	;
 13)   146C 21 01 83    		    LD HL,FCOLOR	;
 14)   146F 22 67 83    		    LD (GR_PARAM3),HL	;
 15)   1472 18 0C       		    JR BS_DOCOL	;
 16)   1474 21 07 83    		GRCOLS: LD HL,BGRCOL	;
 17)   1477 22 69 83    		    LD (GR_PARAM4),HL	;
 18)   147A 21 05 83    		    LD HL,FGRCOL	;
 19)   147D 22 67 83    		    LD (GR_PARAM3),HL         	;
 20)   1480 CD 94 5E    		BS_DOCOL: CALL EXPRI   ;GET 1ST PARAM	;GET 1ST PARAM
 21)   1483 D9          		    EXX	;
 22)   1484 FD 7E 00    		    LD A,(IY)	;
 23)   1487 FE 0D       		    CP 0x0D       ;FINISHED COMD LINE	;FINISHED COMD LINE
 24)   1489 28 32       		    JR Z,COLSEL	;
 25)   148B FE 3A       		    CP ':'	;
 26)   148D 28 2E       		    JR Z,COLSEL	;
 27)   148F FE 2C       		    CP ','        ;CHECK FOR ','	;CHECK FOR ','
 28)   1491 C2 30 18    		    JP NZ,GRPHERR	;
 30)   1494 E5          		    PUSH HL       ;SAVE 1ST PARAM	;SAVE 1ST PARAM
 31)   1495 FD 23       		    INC IY        ;NEXT PARAM	;NEXT PARAM
 32)   1497 CD 94 5E    		    CALL EXPRI    ;GET 2ND PARAM	;GET 2ND PARAM
 33)   149A D9          		    EXX	;
 34)   149B D1          		    POP DE        ;RESTORE 1ST PARAM ON DE HL HAS THE 2ND	;RESTORE 1ST PARAM ON DE HL HAS THE 2ND
 35)   149C 7B          		    LD A,E	;
 36)   149D D6 80       		    SUB 128	;
 37)   149F 38 07       		    JR C,COLFC	;
 38)   14A1 5F          		    LD E,A	;
 39)   14A2 DD 21 37 83 		    LD IX,BCOLPAL	;
 40)   14A6 18 04       		    JR DOPALCOL	;
 41)   14A8 DD 21 17 83 		COLFC: LD IX,FCOLPAL	;
 43)   14AC 7B          		    LD A,E	;
 44)   14AD FE 0F       		    CP 15     ;MAX 16 COLORS	;MAX 16 COLORS
 45)   14AF D2 30 18    		    JP NC,GRPHERR	;
 46)   14B2 DD 19       		    ADD IX,DE     	;
 47)   14B4 DD 19       		    ADD IX,DE     ;2*DE CAUSE ITS A 2 BYTE ARRAY	;2*DE CAUSE ITS A 2 BYTE ARRAY
 48)   14B6 DD 75 00    		    LD (IX),L    ;SAVE THE NEW COLOR 	;SAVE THE NEW COLOR
 49)   14B9 DD 74 01    		    LD (IX+1),H  	;
 50)   14BC C9          		    RET  	;
 53)   14BD E5          		    PUSH HL	;
 54)   14BE D1          		    POP DE     	;
 55)   14BF 7B          		    LD A,E	;
 56)   14C0 D6 80       		    SUB 128        ;CHECK MSB	;CHECK MSB
 57)   14C2 38 11       		    JR C,CFC	;
 58)   14C4 5F          		    LD E,A	;
 59)   14C5 DD 21 69 83 		    LD IX,GR_PARAM4	;
 60)   14C9 DD 6E 00    		    LD L,(IX)	;
 61)   14CC DD 66 01    		    LD H,(IX+1)     	;
 62)   14CF DD 21 37 83 		    LD IX,BCOLPAL  ;BACKCOLOR	;BACKCOLOR
 63)   14D3 18 0E       		    JR SFC	;
 64)   14D5 DD 21 67 83 		CFC: LD IX,GR_PARAM3	;
 65)   14D9 DD 6E 00    		    LD L,(IX)	;
 66)   14DC DD 66 01    		    LD H,(IX+1)     	;
 67)   14DF DD 21 17 83 		    LD IX,FCOLPAL  ;FRONTCOLOR	;FRONTCOLOR
 68)   14E3 7B          		SFC: LD A,E	;
 69)   14E4 FE 10       		    CP 16     ;MAX 16 COLORS	;MAX 16 COLORS
 70)   14E6 D2 30 18    		    JP NC,GRPHERR	;
 71)   14E9 DD 19       		    ADD IX,DE	;
 72)   14EB DD 19       		    ADD IX,DE	;
 73)   14ED DD 56 00    		    LD D,(IX)	;
 74)   14F0 DD 5E 01    		    LD E,(IX+1)     	;
 75)   14F3 72          		    LD (HL),D  ;SAVE AGAIN 	;SAVE AGAIN
 76)   14F4 23          		    INC HL     	;
 77)   14F5 73          		    LD (HL),E       	;
 78)   14F6 C9          		    RET          	;
 84)   14F7 AF          		    XOR A	;
 85)   14F8 21 63 83    		    LD HL,GR_PARAM1	;
 87)   14FB F5          		    PUSH AF	;
 88)   14FC E5          		    PUSH HL	;
 89)   14FD CD 94 5E    		    CALL EXPRI    ;GET 1ST PARAM	;GET 1ST PARAM
 90)   1500 D9          		    EXX           ;HL HAS THE PARAM     	;HL HAS THE PARAM
 91)   1501 D1          		    POP DE        ;GET PARAM ADDRESS	;GET PARAM ADDRESS
 92)   1502 EB          		    EX DE,HL	;
 93)   1503 73          		    LD (HL),E	;
 94)   1504 23          		    INC HL	;
 95)   1505 72          		    LD (HL),D	;
 96)   1506 23          		    INC HL        ;PARAM SAVED     	;PARAM SAVED
 97)   1507 F1          		    POP AF	;
 98)   1508 3C          		    INC A          	;
 99)   1509 FE 04       		    CP 4	;
100)   150B C8          		    RET Z     	;
101)   150C F5          		    PUSH AF	;
102)   150D FD 7E 00    		    LD A,(IY)     	;
103)   1510 FE 0D       		    CP 0x0D       ;FINISHED COMD LINE	;FINISHED COMD LINE
104)   1512 28 0D       		    JR Z,NOMORE 	;
105)   1514 FE 3A       		    CP ':'       ;FINISHED COMD LINE	;FINISHED COMD LINE
106)   1516 28 09       		    JR Z,NOMORE      	;
107)   1518 FE 2C       		    CP ','        ;CHECK FOR ','	;CHECK FOR ','
108)   151A 20 05       		    JR NZ,NOMORE     	;
109)   151C FD 23       		    INC IY        ;NEXT PARAM	;NEXT PARAM
110)   151E F1          		    POP AF    	;
111)   151F 18 DA       		    JR GBP_NXT     	;
112)   1521 F1          		NOMORE:POP AF    	;
113)   1522 C9          		    RET	;
118)   1523 01 08 00    		    LD BC,8     ;8 BYTES SHIFT UP KEEPS 2 LAST POSITIONS NEEDED IN PLOT COMMD	;8 BYTES SHIFT UP KEEPS 2 LAST POSITIONS NEEDED IN PLOT COMMD
119)   1526 11 57 83    		    LD DE,GR_LASTX3	;
120)   1529 21 5B 83    		    LD HL,GR_LASTX2	;
121)   152C ED B0       		    LDIR     	;
122)   152E 2A 63 83    		    LD HL,(GR_PARAM1)	;
123)   1531 22 5F 83    		    LD (GR_LASTX),HL  ;SAVE TO LAST              	;SAVE TO LAST
124)   1534 2A 65 83    		    LD HL,(GR_PARAM2)	;
125)   1537 22 61 83    		    LD (GR_LASTY),HL  ;SAVE TO LAST     	;SAVE TO LAST
126)   153A C9          		  RET	;
130)   153B CD F7 14    		    CALL GETBASICPARAMS	;
131)   153E FE 02       		    CP 2	;
132)   1540 C2 30 18    		    JP NZ,GRPHERR          	;
133)   1543 CD 5D 16    		BAS_DODRAW: CALL GRPH_SAVECOLORS	;
134)   1546 FD E5       		    PUSH IY	;
137)   1548 2A 5F 83    		    LD HL,(GR_LASTX)	;
138)   154B E5          		    PUSH HL	;
139)   154C 2A 61 83    		    LD HL,(GR_LASTY)	;
140)   154F E5          		    PUSH HL	;
141)   1550 CD 23 15    		    CALL GRPH_SAVELASTPOS	;
142)   1553 2A 63 83    		    LD HL,(GR_PARAM1)	;
143)   1556 E5          		    PUSH HL	;
144)   1557 2A 65 83    		    LD HL,(GR_PARAM2)	;
145)   155A E5          		    PUSH HL 	;
146)   155B CD 88 0C    		    CALL LCD_DRAWLINE 	;
148)   155E FD E1       		    POP IY	;
149)   1560 CD 74 16    		    CALL GRPH_RESTORECOLORS	;
150)   1563 C9          		    RET           ;RETURN TO BASIC  	;RETURN TO BASIC
154)   1564 CD F7 14    		@BAS_MOVE: CALL GETBASICPARAMS	;
155)   1567 FE 02       		         CP 2	;
156)   1569 C2 30 18    		         JP NZ,GRPHERR   	;
158)   156C CD 23 15    		         CALL GRPH_SAVELASTPOS	;
159)   156F C9          		         RET	;
165)   1570 CD F7 14    		@BAS_POINT:CALL GETBASICPARAMS	;
166)   1573 FE 02       		          CP 2	;
167)   1575 C2 30 18    		          JP NZ,GRPHERR   	;
170)   1578 2A 63 83    		          LD HL,(GR_PARAM1)	;
171)   157B E5          		          PUSH HL	;
172)   157C 2A 65 83    		          LD HL,(GR_PARAM2)	;
173)   157F E5          		          PUSH HL           	;
174)   1580 CD 92 0B    		          CALL LCD_READPIXEL	;
178)   1583 FD 7E 00    		          LD A,(IY)  	;
179)   1586 FE 29       		          CP ')'	;
180)   1588 C2 30 18    		          JP NZ,GRPHERR 	;
181)   158B FD 23       		          INC IY 	;
184)   158D 01 00 00    		          LD BC,0	;
185)   1590 F3          		          DI	;
186)   1591 E5          		          PUSH HL	;
187)   1592 D9          		          EXX	;
188)   1593 E1          		          POP HL	;
189)   1594 D9          		          EXX           	;
190)   1595 21 00 00    		          LD HL,0	;
191)   1598 FB          		          EI	;
192)   1599 C9          		          RET	;
198)   159A FE 00       		GRPH_GETGROUP: CP 0	;
200)   159C 21 A0 17    		    LD HL,PLOT00	;
201)   159F C8          		    RET Z	;
202)   15A0 FE 0A       		         CP 80.SHR.3	;
203)   15A2 21 B0 17    		    LD HL,PLOT80	;
204)   15A5 C8          		    RET Z	;
205)   15A6 FE 0C       		         CP 96.SHR.3	;
206)   15A8 21 C0 17    		    LD HL,PLOT96	;
207)   15AB C8          		    RET Z       	;
208)   15AC FE 10       		         CP 128.SHR.3	;
209)   15AE 21 D0 17    		    LD HL,PLOT128	;
210)   15B1 C8          		    RET Z                   	;
211)   15B2 FE 12       		        CP 144.SHR.3	;
212)   15B4 21 E0 17    		    LD HL,PLOT144	;
213)   15B7 C8          		    RET Z                   	;
214)   15B8 FE 13       		         CP 152.SHR.3	;
215)   15BA 21 F0 17    		    LD HL,PLOT152	;
216)   15BD C8          		    RET Z                   	;
217)   15BE FE 14       		         CP 160.SHR.3	;
218)   15C0 21 00 18    		    LD HL,PLOT160	;
219)   15C3 C8          		    RET Z                   	;
220)   15C4 FE 18       		         CP 192.SHR.3	;
221)   15C6 21 10 18    		    LD HL,PLOT192	;
222)   15C9 C8          		    RET Z                   	;
223)   15CA FE 19       		         CP 200.SHR.3	;
224)   15CC 21 20 18    		         LD HL,PLOT200	;
225)   15CF C8          		         RET Z 	;
226)   15D0 21 00 00    		    LD HL,0	;
227)   15D3 C9          		    RET                                  	;
230)   15D4 CD F7 14    		@BAS_PLOT:CALL GETBASICPARAMS	;
231)   15D7 FE 03       		         CP 3	;
232)   15D9 C2 30 18    		         JP NZ,GRPHERR   	;
233)   15DC 3A 63 83    		         LD A,(GR_PARAM1)	;
235)   15DF 01 04 00    		         LD BC,4	;
236)   15E2 21 65 83    		         LD HL,GR_PARAM2	;
237)   15E5 11 63 83    		         LD DE,GR_PARAM1	;
238)   15E8 ED B0       		         LDIR                    	;
239)   15EA 47          		         LD B,A  ;COMMAND GROUP 5 BITS	;COMMAND GROUP 5 BITS
240)   15EB CB 38       		         SRL B	;
241)   15ED CB 38       		         SRL B	;
242)   15EF CB 38       		         SRL B          	;
243)   15F1 E6 07       		         AND 7  	;
244)   15F3 4F          		         LD C,A  ;SPECIFIC COMMAND IN GROUP	;SPECIFIC COMMAND IN GROUP
245)   15F4 78          		         LD A,B	;
246)   15F5 CD 9A 15    		         CALL GRPH_GETGROUP	;
247)   15F8 7C          		         LD A,H	;
248)   15F9 FE 00       		         CP 0	;
249)   15FB C8          		         RET Z ;RET IF HL=0 GROUP NOT IMPLEMENTED	;RET IF HL=0 GROUP NOT IMPLEMENTED
250)   15FC 06 00       		         LD B,0	;
251)   15FE CB 21       		         SLA C      ;C=C*2 2BYTE ADDRESSES	;C=C*2 2BYTE ADDRESSES
252)   1600 09          		         ADD HL,BC  ;C IS 0-7 SPECIFIC COMMD	;C IS 0-7 SPECIFIC COMMD
253)   1601 5E          		         LD E,(HL)	;
254)   1602 23          		         INC HL	;
255)   1603 56          		         LD D,(HL)	;
256)   1604 EB          		         EX DE,HL	;
257)   1605 E9          		         JP (HL)	;
259)   1606 AF          		GRPH_NOTIMPL:  XOR     A	;
260)   1607 CD F0 46    		  CALL    EXTERR	;
261)   160A 4E 4F 54 20 		  DEFM    'NOT IMPLEMENTED'	;
261)   160E 49 4D 50 4C 		  DEFM    'NOT IMPLEMENTED'	;
261)   1612 45 4D 45 4E 		  DEFM    'NOT IMPLEMENTED'	;
261)   1616 54 45 44    		  DEFM    'NOT IMPLEMENTED'	;
262)   1619 00          		  DEFB    0     	;
266)   161A 2A 63 83    		GRPH_CALCREL: LD HL,(GR_PARAM1)	;
267)   161D ED 5B 5F 83 		        LD DE,(GR_LASTX)	;
268)   1621 19          		        ADD HL,DE	;
269)   1622 22 63 83    		        LD (GR_PARAM1),HL	;
270)   1625 2A 65 83    		        LD HL,(GR_PARAM2)	;
271)   1628 ED 5B 61 83 		        LD DE,(GR_LASTY)	;
272)   162C 19          		        ADD HL,DE	;
273)   162D 22 65 83    		        LD (GR_PARAM2),HL	;
274)   1630 C9          		    RET	;
277)   1631 CD 1A 16    		        CALL GRPH_CALCREL	;
278)   1634 CD 23 15    		        CALL GRPH_SAVELASTPOS         	;
279)   1637 C9          		        RET	;
282)   1638 CD 1A 16    		        CALL GRPH_CALCREL	;
283)   163B CD 43 15    		        CALL BAS_DODRAW	;
284)   163E C9          		        RET	;
287)   163F 2A 01 83    		        LD HL,(FCOLOR)	;
288)   1642 E5          		        PUSH HL	;
289)   1643 2A 03 83    		        LD HL,(BCOLOR)	;
290)   1646 22 01 83    		        LD (FCOLOR),HL	;
291)   1649 E1          		        POP HL	;
292)   164A 22 03 83    		        LD (BCOLOR),HL	;
293)   164D C9          		        RET	;
296)   164E 2A 05 83    		        LD HL,(FGRCOL)	;
297)   1651 E5          		        PUSH HL	;
298)   1652 2A 07 83    		        LD HL,(BGRCOL)	;
299)   1655 22 05 83    		        LD (FGRCOL),HL	;
300)   1658 E1          		        POP HL	;
301)   1659 22 07 83    		        LD (BGRCOL),HL	;
302)   165C C9          		        RET	;
306)   165D 01 04 00    		        LD BC,4 ;2 FCOLOR + 2 BCOLOR	;2 FCOLOR + 2 BCOLOR
307)   1660 21 01 83    		        LD HL,FCOLOR	;
308)   1663 11 09 83    		        LD DE,FCOLTM 	;
309)   1666 ED B0       		        LDIR	;
310)   1668 01 04 00    		        LD BC,4 ;2 FGRCOL + 2 BGRCOL	;2 FGRCOL + 2 BGRCOL
311)   166B 21 05 83    		        LD HL,FGRCOL	;
312)   166E 11 01 83    		        LD DE,FCOLOR	;
313)   1671 ED B0       		        LDIR         	;
314)   1673 C9          		    RET	;
318)   1674 01 04 00    		        LD BC,4 ;2 FCOLOR + 2 BCOLOR	;2 FCOLOR + 2 BCOLOR
319)   1677 21 09 83    		        LD HL,FCOLTM	;
320)   167A 11 01 83    		        LD DE,FCOLOR 	;
321)   167D ED B0       		        LDIR	;
322)   167F C9          		    RET	;
326)   1680 CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
327)   1683 CD 1A 16    		        CALL GRPH_CALCREL	;
328)   1686 CD 43 15    		        CALL BAS_DODRAW	;
329)   1689 CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
330)   168C C9          		        RET	;
333)   168D CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
334)   1690 CD 43 15    		        CALL BAS_DODRAW	;
335)   1693 CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
336)   1696 C9          		        RET	;
339)   1697 CD 43 15    		        CALL BAS_DODRAW  ;FROM LASTX=2ND PT TO GR_PARAM1=3RD PT	;FROM LASTX=2ND PT TO GR_PARAM1=3RD PT
340)   169A 2A 57 83    		        LD HL,(GR_LASTX3)	;
341)   169D 22 63 83    		        LD (GR_PARAM1),HL	;
342)   16A0 2A 59 83    		        LD HL,(GR_LASTY3)	;
343)   16A3 22 65 83    		        LD (GR_PARAM2),HL	;
344)   16A6 CD 43 15    		        CALL BAS_DODRAW  ;FROM LASTX=3RD PT TO GR_PARAM1=1ST PT	;FROM LASTX=3RD PT TO GR_PARAM1=1ST PT
345)   16A9 2A 57 83    		        LD HL,(GR_LASTX3)	;
346)   16AC 22 63 83    		        LD (GR_PARAM1),HL	;
347)   16AF 2A 59 83    		        LD HL,(GR_LASTY3)	;
348)   16B2 22 65 83    		        LD (GR_PARAM2),HL	;
349)   16B5 CD 43 15    		        CALL BAS_DODRAW  ;FROM LASTX=1ST PT TO GR_PARAM1=2ND PT	;FROM LASTX=1ST PT TO GR_PARAM1=2ND PT
350)   16B8 01 04 00    		        LD BC,4	;
351)   16BB 21 57 83    		        LD HL,GR_LASTX3	;
352)   16BE 11 5F 83    		        LD DE,GR_LASTX	;
353)   16C1 ED B0       		        LDIR               ;SET LASTX,LASTY         	;SET LASTX,LASTY
354)   16C3 C9          		    RET	;
356)   16C4 CD 4E 16    		GRPH_TRIANGLEBC:CALL GRPH_SWAPGRCOLS	;
357)   16C7 CD 97 16    		        CALL GRPH_TRIANGLE	;
358)   16CA CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
359)   16CD C9          		    RET	;
362)   16CE 21 63 83    		GRPH_RECT:LD HL,GR_PARAM1	;
363)   16D1 11 67 83    		        LD DE,GR_PARAM3	;
364)   16D4 01 04 00    		        LD BC,4	;
365)   16D7 ED B0       		        LDIR               ;COPY PARAM1,2 TO 3,4         	;COPY PARAM1,2 TO 3,4
366)   16D9 2A 61 83    		        LD HL,(GR_LASTY)	;
367)   16DC E5          		        PUSH HL            ;PT1_Y	;PT1_Y
368)   16DD 2A 5F 83    		        LD HL,(GR_LASTX)	;
369)   16E0 E5          		        PUSH HL            ;PT1_X         	;PT1_X
370)   16E1 2A 61 83    		        LD HL,(GR_LASTY)         	;
371)   16E4 22 65 83    		        LD (GR_PARAM2),HL         	;
372)   16E7 CD 43 15    		        CALL BAS_DODRAW    ;PT1_X,PT1_Y TO PT2_X,PT1_Y	;PT1_X,PT1_Y TO PT2_X,PT1_Y
373)   16EA 2A 69 83    		        LD HL,(GR_PARAM4)	;
374)   16ED 22 65 83    		        LD (GR_PARAM2),HL	;
375)   16F0 CD 43 15    		        CALL BAS_DODRAW    ;PT2_X,PT1_Y TO PT2_X,PT2_Y	;PT2_X,PT1_Y TO PT2_X,PT2_Y
376)   16F3 E1          		        POP HL             ;PT1_X	;PT1_X
377)   16F4 22 63 83    		        LD (GR_PARAM1),HL         	;
378)   16F7 CD 43 15    		        CALL BAS_DODRAW    ;PT2_X,PT2_Y TO PT1_X,PT2_Y	;PT2_X,PT2_Y TO PT1_X,PT2_Y
379)   16FA E1          		        POP HL             ;PT1_Y	;PT1_Y
380)   16FB 22 65 83    		        LD (GR_PARAM2),HL	;
381)   16FE CD 43 15    		        CALL BAS_DODRAW    ;PT1_X,PT2_Y TO PT1_X,PT1_Y	;PT1_X,PT2_Y TO PT1_X,PT1_Y
382)   1701 01 04 00    		        LD BC,4	;
383)   1704 21 67 83    		        LD HL,GR_PARAM3	;
384)   1707 11 5F 83    		        LD DE,GR_LASTX	;
385)   170A ED B0       		        LDIR               ;SET LASTX,LASTY	;SET LASTX,LASTY
386)   170C C9          		        RET	;
388)   170D CD 4E 16    		GRPH_RECTBC:CALL GRPH_SWAPGRCOLS	;
389)   1710 CD CE 16    		        CALL GRPH_RECT	;
390)   1713 CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
391)   1716 C9          		    RET	;
394)   1717 CD 5D 16    		GRPH_CIRCREL: CALL GRPH_SAVECOLORS	;
395)   171A 2A 63 83    		        LD HL,(GR_PARAM1)	;
396)   171D 7C          		        LD A,H	;
397)   171E B5          		        OR L	;
398)   171F 20 06       		        JR NZ,CIRE_DOIT 	;
399)   1721 2A 65 83    		        LD HL,(GR_PARAM2)	;
400)   1724 7C          		        LD A,H	;
401)   1725 B5          		        OR L	;
402)   1726 C8          		        RET Z              ; RETURN IF BOTH PARAMS ARE ZERO         	; RETURN IF BOTH PARAMS ARE ZERO
403)   1727 ED 5B 5F 83 		CIRE_DOIT:LD DE,(GR_LASTX)	;
404)   172B D5          		        PUSH DE	;
405)   172C ED 5B 61 83 		        LD DE,(GR_LASTY)	;
406)   1730 D5          		        PUSH DE 	;
407)   1731 E5          		        PUSH HL	;
408)   1732 CD 7F 0E    		        CALL LCD_CIRCLE	;
409)   1735 CD 74 16    		        CALL GRPH_RESTORECOLORS	;
410)   1738 C9          		        RET  	;
412)   1739 CD 4E 16    		GRPH_CIRCRELBC:CALL GRPH_SWAPGRCOLS	;
413)   173C CD 17 17    		        CALL GRPH_CIRCREL	;
414)   173F CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
415)   1742 C9          		        RET	;
421)   1743 C9          		GRPH_CIRCLE:RET	;
422)   1744 2A 5F 83    		        LD HL,(GR_LASTX)	;
423)   1747 ED 5B 63 83 		        LD DE,(GR_PARAM1)	;
424)   174B AF          		        XOR A	;
425)   174C ED 42       		        SBC HL,BC	;
426)   174E 22 67 83    		        LD (GR_PARAM3),HL    ;X2-X1	;X2-X1
427)   1751 2A 61 83    		        LD HL,(GR_LASTY)	;
428)   1754 ED 5B 65 83 		        LD DE,(GR_PARAM2)	;
429)   1758 AF          		        XOR A	;
430)   1759 ED 42       		        SBC HL,BC	;
431)   175B 22 69 83    		        LD (GR_PARAM4),HL    ;Y2-Y1         	;Y2-Y1
433)   175E ED 4B 67 83 		        LD BC,(GR_PARAM3)	;
434)   1762 C5          		        PUSH BC	;
435)   1763 D1          		        POP DE	;
436)   1764 CD BE 22    		        CALL MULT32   ;BCHL RESULT	;BCHL RESULT
437)   1767 D9          		        EXX	;
438)   1768 C5          		        PUSH BC	;
439)   1769 D1          		        POP DE	;
440)   176A D9          		        EXX	;
441)   176B E5          		        PUSH HL       ;DE LOW         	;DE LOW
442)   176C ED 4B 69 83 		        LD BC,(GR_PARAM4)	;
443)   1770 C5          		        PUSH BC	;
444)   1771 D1          		        POP DE	;
445)   1772 CD BE 22    		        CALL MULT32   ;BCHL RESULT	;BCHL RESULT
446)   1775 D9          		        EXX         	;
447)   1776 C5          		        PUSH BC	;
448)   1777 E1          		        POP HL	;
449)   1778 D9          		        EXX	;
450)   1779 D1          		        POP DE	;
452)   177A CD D9 22    		        CALL ADD32	;
456)   177D C9          		        RET	;
458)   177E CD 4E 16    		GRPH_CIRCLEBC:CALL GRPH_SWAPGRCOLS	;
459)   1781 CD 43 17    		        CALL GRPH_CIRCLE	;
460)   1784 CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
461)   1787 C9          		        RET  	;
465)   1788 CD 4E 16    		GRPH_FILL: CALL GRPH_SWAPGRCOLS 	;
466)   178B CD 5D 16    		        CALL GRPH_SAVECOLORS	;
467)   178E 2A 63 83    		        LD HL,(GR_PARAM1)	;
468)   1791 E5          		        PUSH HL	;
469)   1792 2A 65 83    		        LD HL,(GR_PARAM2)	;
470)   1795 E5          		        PUSH HL	;
471)   1796 CD 03 10    		        CALL LCD_FILL	;
472)   1799 CD 74 16    		        CALL GRPH_RESTORECOLORS	;
473)   179C CD 4E 16    		        CALL GRPH_SWAPGRCOLS	;
474)   179F C9          		        RET         	;
476)   17A0 31 16       		PLOT00: DW GRPH_MOVEREL	;
477)   17A2 38 16       		    DW GRPH_LINEREL	;
478)   17A4 06 16       		    DW GRPH_NOTIMPL	;
479)   17A6 80 16       		    DW GRPH_LINERELBC	;
480)   17A8 23 15       		    DW GRPH_SAVELASTPOS	;
481)   17AA 43 15       		    DW BAS_DODRAW	;
482)   17AC 06 16       		    DW GRPH_NOTIMPL     	;
483)   17AE 8D 16       		    DW GRPH_DRAWBC	;
485)   17B0 06 16       		PLOT80: DW GRPH_NOTIMPL	;
486)   17B2 97 16       		    DW GRPH_TRIANGLE	;
487)   17B4 06 16       		    DW GRPH_NOTIMPL	;
488)   17B6 C4 16       		    DW GRPH_TRIANGLEBC	;
489)   17B8 06 16       		    DW GRPH_NOTIMPL	;
490)   17BA 97 16       		    DW GRPH_TRIANGLE	;
491)   17BC 06 16       		    DW GRPH_NOTIMPL     	;
492)   17BE C4 16       		    DW GRPH_TRIANGLEBC	;
494)   17C0 06 16       		PLOT96: DW GRPH_NOTIMPL	;
495)   17C2 CE 16       		    DW GRPH_RECT	;
496)   17C4 06 16       		    DW GRPH_NOTIMPL	;
497)   17C6 0D 17       		    DW GRPH_RECTBC	;
498)   17C8 06 16       		    DW GRPH_NOTIMPL	;
499)   17CA CE 16       		    DW GRPH_RECT	;
500)   17CC 06 16       		    DW GRPH_NOTIMPL     	;
501)   17CE 0D 17       		    DW GRPH_RECTBC	;
503)   17D0 06 16       		PLOT128: DW GRPH_NOTIMPL	;
504)   17D2 88 17       		    DW GRPH_FILL	;
505)   17D4 06 16       		    DW GRPH_NOTIMPL	;
506)   17D6 06 16       		    DW GRPH_NOTIMPL	;
507)   17D8 06 16       		    DW GRPH_NOTIMPL	;
508)   17DA 06 16       		    DW GRPH_NOTIMPL	;
509)   17DC 06 16       		    DW GRPH_NOTIMPL     	;
510)   17DE 06 16       		    DW GRPH_NOTIMPL	;
512)   17E0 17 17       		PLOT144: DW GRPH_CIRCREL	;
513)   17E2 17 17       		    DW GRPH_CIRCREL	;
514)   17E4 06 16       		    DW GRPH_NOTIMPL	;
515)   17E6 39 17       		    DW GRPH_CIRCRELBC	;
516)   17E8 43 17       		    DW GRPH_CIRCLE	;
517)   17EA 43 17       		    DW GRPH_CIRCLE	;
518)   17EC 06 16       		    DW GRPH_NOTIMPL     	;
519)   17EE 7E 17       		    DW GRPH_CIRCLEBC	;
521)   17F0 06 16       		PLOT152: DW GRPH_NOTIMPL	;
522)   17F2 06 16       		    DW GRPH_NOTIMPL	;
523)   17F4 06 16       		    DW GRPH_NOTIMPL	;
524)   17F6 06 16       		    DW GRPH_NOTIMPL	;
525)   17F8 06 16       		    DW GRPH_NOTIMPL	;
526)   17FA 06 16       		    DW GRPH_NOTIMPL	;
527)   17FC 06 16       		    DW GRPH_NOTIMPL     	;
528)   17FE 06 16       		    DW GRPH_NOTIMPL	;
530)   1800 06 16       		PLOT160: DW GRPH_NOTIMPL	;
531)   1802 06 16       		    DW GRPH_NOTIMPL	;
532)   1804 06 16       		    DW GRPH_NOTIMPL	;
533)   1806 06 16       		    DW GRPH_NOTIMPL	;
534)   1808 06 16       		    DW GRPH_NOTIMPL	;
535)   180A 06 16       		    DW GRPH_NOTIMPL	;
536)   180C 06 16       		    DW GRPH_NOTIMPL     	;
537)   180E 06 16       		    DW GRPH_NOTIMPL	;
539)   1810 06 16       		PLOT192: DW GRPH_NOTIMPL	;
540)   1812 06 16       		    DW GRPH_NOTIMPL	;
541)   1814 06 16       		    DW GRPH_NOTIMPL	;
542)   1816 06 16       		    DW GRPH_NOTIMPL	;
543)   1818 06 16       		    DW GRPH_NOTIMPL	;
544)   181A 06 16       		    DW GRPH_NOTIMPL	;
545)   181C 06 16       		    DW GRPH_NOTIMPL     	;
546)   181E 06 16       		    DW GRPH_NOTIMPL	;
548)   1820 06 16       		PLOT200: DW GRPH_NOTIMPL	;
549)   1822 06 16       		    DW GRPH_NOTIMPL	;
550)   1824 06 16       		    DW GRPH_NOTIMPL	;
551)   1826 06 16       		    DW GRPH_NOTIMPL	;
552)   1828 06 16       		    DW GRPH_NOTIMPL	;
553)   182A 06 16       		    DW GRPH_NOTIMPL	;
554)   182C 06 16       		    DW GRPH_NOTIMPL     	;
555)   182E 06 16       		    DW GRPH_NOTIMPL	;
558)   1830 AF          		  XOR     A	;
559)   1831 CD F0 46    		  CALL    EXTERR	;
560)   1834 70 61 72 61 		  DEFM    'param error'	;
560)   1838 6D 20 65 72 		  DEFM    'param error'	;
560)   183C 72 6F 72    		  DEFM    'param error'	;
561)   183F 00          		  DEFB    0     	;
 30)   1840 C3 D2 11    		@MYOS_CLRSCN:JP LCD_CLRSCR       ; CLRSCN: clears the screen.	; CLRSCN: clears the screen.
 33)   1843 7D          		         LD A,L	;
 34)   1844 32 A7 83    		         LD (TIMECTR),A	;
 35)   1847 7C          		     LD A,H	;
 36)   1848 32 A8 83    		        LD (TIMECTR+1),A	;
 37)   184B 7B          		        LD A,E	;
 38)   184C 32 A9 83    		        LD (TIMECTR+2),A	;
 39)   184F 7A          		        LD A,D	;
 40)   1850 32 AA 83    		        LD (TIMECTR+3),A         	;
 41)   1853 C9          		        RET	;
 45)   1854 3A A7 83    		         LD A,(TIMECTR)	;
 46)   1857 6F          		         LD L,A	;
 47)   1858 3A A8 83    		        LD A,(TIMECTR+1)	;
 48)   185B 67          		        LD H,A	;
 49)   185C 3A A9 83    		        LD A,(TIMECTR+2)	;
 50)   185F 5F          		        LD E,A	;
 51)   1860 3A AA 83    		        LD A,(TIMECTR+3)	;
 52)   1863 57          		        LD D,A	;
 53)   1864 C9          		       RET         	;
 55)   1865 63          		          LD H,E	;
 56)   1866 E5          		          PUSH HL	;
 57)   1867 CD 8B 11    		          CALL LCD_RMVCURS	;
 58)   186A E1          		          POP HL	;
 59)   186B 7C          		          LD A,H	;
 60)   186C 32 0D 83    		          LD (CURSORX),A	;
 61)   186F 7D          		          LD A,L	;
 62)   1870 32 0E 83    		          LD (CURSORY),A	;
 63)   1873 CD 90 11    		          CALL LCD_PRNCURS                      	;
 64)   1876 C9          		          RET	;
 66)   1877 16 00       		          LD D,0	;
 67)   1879 3A 0D 83    		          LD A,(CURSORX)	;
 68)   187C 5F          		          LD E,A	;
 69)   187D 26 00       		          LD H,0	;
 71)   187F CD E1 10    		          CALL LCD_CALCLINE ;GETS CURSORY WITH SCROLL	;GETS CURSORY WITH SCROLL
 72)   1882 6F          		       LD L,A	;
 73)   1883 C9          		       RET	;
 74)   1884 06 50       		KEYGET: LD      B,80 ;SCREEN WIDTH IN CHARS      	;SCREEN WIDTH IN CHARS
 76)   1886 E5          		         PUSH    HL	;
 77)   1887 ED 62       		          SBC     HL,HL           ;HL=0	;HL=0
 78)   1889 CD 71 1A    		          CALL    MYOS_OSKEY	;
 79)   188C E1          		          POP     HL	;
 80)   188D D8          		          RET     C	;
 81)   188E 18 F6       		          JR      MYOS_OSRDCH           	;
 82)   1890 C9          		       RET  	;
 84)   1891 F5          		       PUSH    AF	;
 85)   1892 D5          		          PUSH    DE	;
 86)   1893 E5          		          PUSH    HL	;
 87)   1894 DD E5       		          PUSH    IX                      	;
 88)   1896 5F          		          LD      E,A	;
 89)   1897 CD 90 1A    		          CALL    ESCTEST	;
 92)   189A 7B          		          LD A,E	;
 93)   189B FE 20       		          CP 32	;
 94)   189D 38 0D       		          JR C,CTRCODE	;
 95)   189F FE 7F       		          CP 127   ;BACKSPACE 	;BACKSPACE
 96)   18A1 C2 25 1A    		          JP NZ,PRINTIT	;
 97)   18A4 3E 08       		          LD A,8            ;DO A BACKSPACE	;DO A BACKSPACE
 98)   18A6 CD 0D 10    		          CALL LCD_PRINTCHAR	;
 99)   18A9 C3 28 1A    		          JP OSWREXIT	;
100)   18AC FE 04       		CTRCODE:  CP 4 ;WRITE TEXT AT TEXT POS	;WRITE TEXT AT TEXT POS
101)   18AE 20 06       		          JR NZ,CC1	;
102)   18B0 32 16 83    		          LD (VDUMODE),A           	;
103)   18B3 C3 28 1A    		          JP OSWREXIT	;
104)   18B6 FE 05       		CC1:      CP 5 ;WRITE TEXT AT GRAPH POS    	;WRITE TEXT AT GRAPH POS
105)   18B8 20 06       		          JR NZ,CC2	;
106)   18BA 32 16 83    		          LD (VDUMODE),A	;
107)   18BD C3 28 1A    		          JP OSWREXIT	;
108)   18C0 FE 06       		CC2:      CP 6 ;ENABLE OUTPUT TO SCREEN	;ENABLE OUTPUT TO SCREEN
109)   18C2 20 03       		          JR NZ,CC3	;
110)   18C4 C3 28 1A    		          JP OSWREXIT	;
111)   18C7 FE 07       		CC3:      CP 7 ;BEEP	;BEEP
112)   18C9 20 03       		          JR NZ,CC4	;
113)   18CB C3 28 1A    		          JP OSWREXIT	;
114)   18CE FE 08       		CC4:      CP 8 ;MOVE TEXT CURSOR BACK A CHAR	;MOVE TEXT CURSOR BACK A CHAR
115)   18D0 20 03       		          JR NZ,CC5	;
116)   18D2 C3 25 1A    		          JP PRINTIT	;
123)   18D5 FE 09       		CC5:      CP 9 ;MOVE TEXT CURSOR FORWARD A CHAR	;MOVE TEXT CURSOR FORWARD A CHAR
124)   18D7 20 0F       		          JR NZ,CC6	;
125)   18D9 3A 0D 83    		          LD A,(CURSORX)	;
126)   18DC 3C          		          INC A	;
127)   18DD FE 50       		          CP 80	;
128)   18DF D2 28 1A    		          JP NC,OSWREXIT	;
129)   18E2 32 0D 83    		          LD (CURSORX),A         	;
130)   18E5 C3 28 1A    		          JP OSWREXIT   	;
131)   18E8 FE 0A       		CC6:      CP 10 ;MOVE TEXT DOWN LF	;MOVE TEXT DOWN LF
132)   18EA CA 25 1A    		          JP Z,PRINTIT	;
133)   18ED FE 0B       		CC7:      CP 11 ;MOVE TEXT UP	;MOVE TEXT UP
134)   18EF 20 0F       		          JR NZ,CC8	;
135)   18F1 3A 0E 83    		          LD A,(CURSORY)	;
136)   18F4 3D          		          DEC A	;
137)   18F5 FE FF       		          CP 0XFF	;
138)   18F7 CA 28 1A    		          JP Z,OSWREXIT	;
139)   18FA 32 0E 83    		          LD (CURSORY),A           	;
140)   18FD C3 28 1A    		          JP OSWREXIT   	;
141)   1900 FE 0C       		CC8:      CP 12 ; CLS	; CLS
142)   1902 20 06       		          JR NZ,CC9	;
143)   1904 CD D2 11    		          CALL LCD_CLRSCR	;
144)   1907 C3 28 1A    		          JP OSWREXIT   	;
145)   190A FE 0D       		CC9:      CP 13 ;GOTO START OF LINE CR	;GOTO START OF LINE CR
146)   190C CA 25 1A    		          JP Z,PRINTIT	;
147)   190F FE 0E       		CC10:     CP 14 ;ENABLE THE AUTOPAGING MODE	;ENABLE THE AUTOPAGING MODE
148)   1911 20 03       		          JR NZ,CC11	;
149)   1913 C3 28 1A    		          JP OSWREXIT   	;
150)   1916 FE 0F       		CC11:     CP 15 ;DISABLE THE AUTOPAGING MODE	;DISABLE THE AUTOPAGING MODE
151)   1918 20 03       		          JR NZ,CC12	;
152)   191A C3 28 1A    		          JP OSWREXIT   	;
153)   191D FE 10       		CC12:     CP 16 ;CLG	;CLG
154)   191F 20 06       		          JR NZ,CC13	;
155)   1921 CD 10 1C    		          CALL MYOS_CLG       	;
156)   1924 C3 28 1A    		          JP OSWREXIT   	;
157)   1927 FE 11       		CC13:     CP 17 ; SAME AS COLOUR	; SAME AS COLOUR
158)   1929 20 09       		          JR NZ,CC14	;
160)   192B FD 23       		          INC IY ;SKIP ','	;SKIP ','
161)   192D CD 94 5E    		          CALL    EXPRI	;
162)   1930 D9          		          EXX ;l has the param  color	;l has the param  color
163)   1931 C3 28 1A    		          JP OSWREXIT   	;
164)   1934 FE 12       		CC14:     CP 18 ;SAME AS GCOL	;SAME AS GCOL
165)   1936 20 0F       		          JR NZ,CC15	;
166)   1938 FD 23       		          INC IY ;SKIP ','	;SKIP ','
167)   193A CD 94 5E    		          CALL    EXPRI	;
168)   193D D9          		          EXX ;l has the param  mode	;l has the param  mode
169)   193E FD 23       		          INC IY ;SKIP ','	;SKIP ','
170)   1940 CD 94 5E    		          CALL    EXPRI	;
171)   1943 D9          		          EXX ;l has the param  color                                        	;l has the param  color
173)   1944 C3 28 1A    		          JP OSWREXIT   	;
174)   1947 FE 13       		CC15:     CP 19 ;SELECT A COLOR PALLETTE???	;SELECT A COLOR PALLETTE???
175)   1949 20 0F       		          JR NZ,CC16	;
177)   194B 06 05       		          LD B,5	;
178)   194D C5          		CC15AGN:  PUSH BC	;
179)   194E FD 23       		          INC IY ;SKIP ','	;SKIP ','
180)   1950 CD 94 5E    		          CALL    EXPRI	;
181)   1953 D9          		          EXX ;l has the param	;l has the param
182)   1954 C1          		          POP BC	;
183)   1955 10 F6       		          DJNZ CC15AGN           	;
184)   1957 C3 28 1A    		          JP OSWREXIT   	;
185)   195A FE 14       		CC16:     CP 20 ;RESTORE THE DEFAULT LOGICAL COLORS	;RESTORE THE DEFAULT LOGICAL COLORS
186)   195C 20 03       		          JR NZ,CC17           	;
188)   195E C3 28 1A    		          JP OSWREXIT   	;
189)   1961 FE 15       		CC17:     CP 21 ;NO OUTPUT TO SCREEN	;NO OUTPUT TO SCREEN
190)   1963 20 03       		          JR NZ,CC18	;
192)   1965 C3 28 1A    		          JP OSWREXIT   	;
193)   1968 FE 16       		CC18:     CP 22 ;LIKE MODE	;LIKE MODE
194)   196A 20 09       		          JR NZ,CC19	;
195)   196C FD 23       		          INC IY ;SKIP ','	;SKIP ','
196)   196E CD 94 5E    		          CALL    EXPRI	;
197)   1971 D9          		          EXX ;l has the param           	;l has the param
198)   1972 C3 28 1A    		          JP OSWREXIT   	;
199)   1975 FE 17       		CC19:     CP 23 ;Program characters and control the cursor.???	;Program characters and control the cursor.???
200)   1977 20 27       		          JR NZ,CC20	;
201)   1979 06 09       		          LD B,9   ;9 PARAMS CHAR_NO +8 ROWS OF A CHAR	;9 PARAMS CHAR_NO +8 ROWS OF A CHAR
202)   197B FD 7E 00    		          LD A,(IY)	;
203)   197E FD 23       		          INC IY ;SKIP ',' OR ';'	;SKIP ',' OR ';'
204)   1980 FE 3B       		          CP ';'	;
205)   1982 20 01       		          JR NZ,CC19AGN	;
206)   1984 05          		          DEC B ; IF ; THE DELIMETER THEN 2 BYTES AT START   	; IF ; THE DELIMETER THEN 2 BYTES AT START
207)   1985 C5          		CC19AGN:  PUSH BC	;
208)   1986 CD 94 5E    		          CALL    EXPRI	;
209)   1989 D9          		          EXX ;l has the param           	;l has the param
210)   198A FD 7E 00    		     LD A,(IY)	;
211)   198D FE 2C       		     CP ','	;
212)   198F 28 07       		     JR Z,CC19NXT0              	;
213)   1991 FE 3B       		          CP ';'           	;
214)   1993 20 05       		          JR NZ,CC19NXT	;
215)   1995 C1          		          POP BC	;
216)   1996 05          		          DEC B	;
217)   1997 C5          		          PUSH BC	;
218)   1998 FD 23       		CC19NXT0: INC IY ;SKIP ','           	;SKIP ','
219)   199A C1          		CC19NXT:  POP BC	;
220)   199B 10 E8       		          DJNZ CC19AGN                     	;
221)   199D C3 28 1A    		          JP OSWREXIT   	;
222)   19A0 FE 18       		CC20:     CP 24 ;Define a graphics window	;Define a graphics window
223)   19A2 20 11       		          JR NZ,CC21	;
224)   19A4 FD 23       		          INC IY ;SKIP ','	;SKIP ','
225)   19A6 06 04       		          LD B,4   ;4 PARAMS TWO CORNERS OF A RECT	;4 PARAMS TWO CORNERS OF A RECT
226)   19A8 C5          		CC20AGN:  PUSH BC           	;
227)   19A9 CD 94 5E    		          CALL    EXPRI	;
228)   19AC D9          		          EXX ;HL has the param	;HL has the param
229)   19AD FD 23       		          INC IY ;SKIP ';'	;SKIP ';'
230)   19AF C1          		          POP BC	;
231)   19B0 10 F6       		          DJNZ CC20AGN                                	;
232)   19B2 C3 28 1A    		          JP OSWREXIT   	;
233)   19B5 FE 19       		CC21:     CP 25 ;Identical to PLOT.	;Identical to PLOT.
234)   19B7 20 17       		          JR NZ,CC22	;
235)   19B9 FD 23       		          INC IY ;SKIP ','	;SKIP ','
236)   19BB CD 94 5E    		          CALL    EXPRI	;
237)   19BE D9          		          EXX ;L has the param PLOTMODE	;L has the param PLOTMODE
238)   19BF FD 23       		          INC IY ;SKIP ','	;SKIP ','
239)   19C1 CD 94 5E    		          CALL    EXPRI	;
240)   19C4 D9          		          EXX ;HL has the param X	;HL has the param X
241)   19C5 FD 23       		          INC IY ;SKIP ';'	;SKIP ';'
242)   19C7 CD 94 5E    		          CALL    EXPRI	;
243)   19CA D9          		          EXX ;HL has the param Y	;HL has the param Y
244)   19CB FD 23       		          INC IY ;SKIP ';'	;SKIP ';'
247)   19CD C3 28 1A    		          JP OSWREXIT   	;
248)   19D0 FE 1A       		CC22:     CP 26 ;Restore the default text and graphics windows.	;Restore the default text and graphics windows.
249)   19D2 20 02       		          JR NZ,CC23	;
250)   19D4 18 52       		          JR OSWREXIT   	;
251)   19D6 FE 1B       		CC23:     CP 27 ;Send the next character to the screen.	;Send the next character to the screen.
252)   19D8 20 07       		          JR NZ,CC24	;
253)   19DA CD 94 5E    		          CALL    EXPRI	;
254)   19DD D9          		          EXX ;	;
255)   19DE 7D          		          LD A,L	;
256)   19DF 18 44       		          JR PRINTIT           	;
257)   19E1 FE 1C       		CC24:     CP 28 ;Define a text window.	;Define a text window.
258)   19E3 20 0E       		          JR NZ,CC25	;
259)   19E5 06 04       		          LD B,4   ;4 PARAMS UPPERLEFT AND LOWERRIGHT	;4 PARAMS UPPERLEFT AND LOWERRIGHT
260)   19E7 C5          		CC24AGN:  PUSH BC	;
261)   19E8 FD 23       		     INC IY ;SKIP ','	;SKIP ','
262)   19EA CD 94 5E    		          CALL    EXPRI	;
263)   19ED D9          		          EXX ;l has the param	;l has the param
264)   19EE C1          		          POP BC           	;
265)   19EF 10 F6       		          DJNZ CC24AGN                                	;
266)   19F1 18 35       		          JR OSWREXIT   	;
267)   19F3 FE 1D       		CC25:     CP 29 ;Set the graphics origin.	;Set the graphics origin.
268)   19F5 20 10       		          JR NZ,CC26	;
269)   19F7 FD 23       		          INC IY ;SKIP ','	;SKIP ','
270)   19F9 CD 94 5E    		          CALL    EXPRI	;
271)   19FC D9          		          EXX ;HL has the param X	;HL has the param X
272)   19FD FD 23       		          INC IY ;SKIP ';'	;SKIP ';'
273)   19FF CD 94 5E    		          CALL    EXPRI	;
274)   1A02 D9          		          EXX ;HL has the param Y	;HL has the param Y
275)   1A03 FD 23       		          INC IY ;SKIP ';'	;SKIP ';'
277)   1A05 18 21       		          JR OSWREXIT   	;
278)   1A07 FE 1E       		CC26:     CP 30 ;Home the text cursor to the top left of the screen.	;Home the text cursor to the top left of the screen.
279)   1A09 20 08       		          JR NZ,CC27	;
280)   1A0B 21 00 00    		          LD HL,0	;
281)   1A0E 22 0D 83    		          LD (CURSORX),HL	;
282)   1A11 18 15       		          JR OSWREXIT   	;
283)   1A13 FE 1F       		CC27:     CP 31 ;Move the text cursor - identical to TAB(x,y).	;Move the text cursor - identical to TAB(x,y).
284)   1A15 20 11       		          JR NZ,OSWREXIT   	;
285)   1A17 FD 23       		          INC IY ;SKIP ','	;SKIP ','
286)   1A19 CD 94 5E    		          CALL    EXPRI	;
287)   1A1C D9          		          EXX ;l has the param X	;l has the param X
288)   1A1D FD 23       		          INC IY ;SKIP ','	;SKIP ','
289)   1A1F CD 94 5E    		          CALL    EXPRI	;
290)   1A22 D9          		          EXX ;l has the param Y	;l has the param Y
292)   1A23 18 03       		          JR OSWREXIT   	;
295)   1A25 CD 2E 1A    		PRINTIT:  CALL    EDPUT	;
296)   1A28 DD E1       		OSWREXIT: POP     IX	;
297)   1A2A E1          		          POP     HL	;
298)   1A2B D1          		          POP     DE	;
299)   1A2C F1          		          POP     AF	;
300)   1A2D C9          		          RET	;
305)   1A2E 3A 00 83    		EDPUT: LD      A,(FLAGS)	;
306)   1A31 CB 5F       		       BIT     3,A	;
307)   1A33 28 10       		       JR      Z,WRCH	;
308)   1A35 7B          		       LD      A,E	;
309)   1A36 FE 20       		       CP      ' '	;
310)   1A38 D8          		       RET     C	;
311)   1A39 2A 12 83    		       LD      HL,(EDPTR)	;
312)   1A3C 73          		       LD      (HL),E	;
313)   1A3D 2C          		       INC     L	;
314)   1A3E C8          		       RET     Z	;
315)   1A3F 22 12 83    		       LD      (EDPTR),HL	;
316)   1A42 C9          		       RET           	;
319)   1A43 1E 3E       		          LD E,'>'        	;
320)   1A45 7B          		WRCH:     LD A,E	;
322)   1A46 F5          		          PUSH AF	;
323)   1A47 C5          		          PUSH BC	;
324)   1A48 D5          		          PUSH DE	;
325)   1A49 E5          		     PUSH HL	;
326)   1A4A DD E5       		     PUSH IX	;
327)   1A4C FD E5       		     PUSH IY	;
329)   1A4E F5          		          PUSH AF	;
330)   1A4F C5          		          PUSH BC	;
331)   1A50 D5          		          PUSH DE	;
332)   1A51 E5          		     PUSH HL	;
333)   1A52 CD 8B 11    		     CALL LCD_RMVCURS	;
334)   1A55 E1          		          POP HL	;
335)   1A56 D1          		          POP DE	;
336)   1A57 C1          		          POP BC	;
337)   1A58 F1          		          POP AF	;
338)   1A59 CD 0D 10    		          CALL LCD_PRINTCHAR	;
339)   1A5C CD 90 11    		          CALL LCD_PRNCURS	;
341)   1A5F FD E1       		          POP IY	;
342)   1A61 DD E1       		          POP IX	;
343)   1A63 E1          		          POP HL	;
344)   1A64 D1          		          POP DE	;
345)   1A65 C1          		          POP BC	;
346)   1A66 F1          		          POP AF	;
347)   1A67 C9          		       RET 	;
349)   1A68 3A 00 83    		TOGGLE: LD     A,(FLAGS)	;
350)   1A6B EE 04       		       XOR     00000100B	;
351)   1A6D 32 00 83    		       LD      (FLAGS),A	;
352)   1A70 C9          		       RET	;
361)   1A71 E5          		@MYOS_OSKEY: PUSH   HL	;
362)   1A72 21 15 83    		           LD      HL,INKEY	;
363)   1A75 7E          		           LD      A,(HL)	;
364)   1A76 36 00       		           LD      (HL),0	;
365)   1A78 E1          		           POP     HL	;
366)   1A79 B7          		           OR      A	;
367)   1A7A 37          		           SCF	;
368)   1A7B C0          		           RET     NZ  	;
370)   1A7C CD 6D 1C    		           CALL    GETKEYNW	;
372)   1A7F D0          		           RET     NC	;
373)   1A80 FE 1B       		           CP      ESC	;
374)   1A82 37          		           SCF	;
375)   1A83 C0          		           RET     NZ                        	;
376)   1A84 E5          		ESCSET:  PUSH    HL	;
377)   1A85 21 00 83    		         LD      HL,FLAGS	;
378)   1A88 CB 76       		         BIT     6,(HL)          ; ESC DISABLED?	; ESC DISABLED?
379)   1A8A 20 02       		         JR      NZ,ESCDIS	;
380)   1A8C CB FE       		         SET     7,(HL)          ; SET ESCAPE FLAG	; SET ESCAPE FLAG
381)   1A8E E1          		ESCDIS:  POP     HL	;
382)   1A8F C9          		         RET 	;
383)   1A90 CD 26 06    		ESCTEST: CALL RS_RXNW	;
384)   1A93 B7          		        OR A	;
385)   1A94 C8          		        RET Z	;
386)   1A95 FE 1B       		        CP 0x1B   ; ESC 	; ESC
387)   1A97 28 EB       		        JR Z,ESCSET	;
388)   1A99 32 15 83    		        LD (INKEY),A	;
389)   1A9C C9          		         RET	;
391)   1A9D CD 90 1A    		@MYOS_TRAP:  CALL ESCTEST	;
392)   1AA0 3A 00 83    		@MYOS_LTRAP: LD A,(FLAGS)	;
393)   1AA3 B7          		            OR A	;
394)   1AA4 F0          		             RET P	;
395)   1AA5 21 00 83    		ABORT:        LD HL,FLAGS 	;
396)   1AA8 CB BE       		            RES 7,(HL)	;
397)   1AAA C3 C2 4D    		            JP ESCAPE          	;
406)   1AAD F3          		           DI	;
407)   1AAE 21 F6 82    		           LD HL,RANDOM    ; SET RANDOM SEED TO NON 0	; SET RANDOM SEED TO NON 0
408)   1AB1 3E 06       		           LD A,0x06	;
409)   1AB3 77          		           LD (HL),A	;
410)   1AB4 3E BB       		           LD A,0xBB	;
411)   1AB6 77          		           LD (HL),A	;
412)   1AB7 21 00 00    		           LD HL,0	;
413)   1ABA 22 0D 83    		           LD (CURSORX),HL  ; CURSOR X 7 Y ZEROED            	; CURSOR X 7 Y ZEROED
414)   1ABD 11 FF FF    		           LD DE,COL_WHITE   ; SET FCOLOR AND BCOLOR DEFAULT VALUES	; SET FCOLOR AND BCOLOR DEFAULT VALUES
415)   1AC0 21 01 83    		           LD HL,FCOLOR	;
416)   1AC3 73          		           LD (HL),E	;
417)   1AC4 23          		           INC HL	;
418)   1AC5 72          		           LD (HL),D	;
419)   1AC6 23          		           INC HL	;
420)   1AC7 11 00 00    		           LD DE,COL_BLACK	;
421)   1ACA 73          		           LD (HL),E	;
422)   1ACB 23          		           INC HL	;
423)   1ACC 72          		           LD (HL),D     	;
424)   1ACD 01 04 00    		           LD BC,4     ; COPY SAME COLORS TO GRAPHICS	; COPY SAME COLORS TO GRAPHICS
425)   1AD0 11 05 83    		           LD DE,FGRCOL	;
426)   1AD3 21 01 83    		           LD HL,FCOLOR	;
427)   1AD6 ED B0       		           LDIR                                          	;
428)   1AD8 11 17 83    		           LD DE,FCOLPAL	;
429)   1ADB CD E6 1A    		           CALL COPYPAL	;
430)   1ADE 11 37 83    		           LD DE,BCOLPAL            	;
431)   1AE1 CD E6 1A    		           CALL COPYPAL	;
432)   1AE4 18 16       		           JR OSFINSH;	;
433)   1AE6 21 58 1B    		COPYPAL:   LD HL,COL_PALET   	;
434)   1AE9 01 20 00    		           LD BC,16*2         ;SHOULD ADD 8 MORE COLORS 	;SHOULD ADD 8 MORE COLORS
435)   1AEC ED B0       		           LDIR	;
436)   1AEE AF          		           XOR A	;
437)   1AEF 32 0F 83    		           LD (SCRLN),A	;
438)   1AF2 21 00 00    		           LD HL,0	;
439)   1AF5 22 A7 83    		           LD (TIMECTR),HL	;
440)   1AF8 22 A9 83    		           LD (TIMECTR+2),HL            	;
441)   1AFB C9          		           RET	;
443)   1AFC CD D2 11    		OSFINSH:   CALL LCD_CLRSCR	;
444)   1AFF CD 2B 4C    		           CALL    TELL	;
445)   1B02 43 44 65 73 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B06 70 20 4D 6F 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B0A 64 75 6C 61 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B0E 72 20 5A 38 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B12 30 20 43 6F 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B16 6D 70 75 74 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B1A 65 72 20 32 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B1E 30 32 30 2D 		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
445)   1B22 32 31       		     DEFM "CDesp Modular Z80 Computer 2020-21"	;
446)   1B24 0A 0D       		     DEFB 0AH,0DH	;
447)   1B26 41 54 4C 41 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B2A 53 20 4F 70 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B2E 65 72 61 74 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B32 69 6E 67 20 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B36 53 79 73 74 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B3A 65 6D 20 56 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B3E 65 72 73 69 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B42 6F 6E 20 32 		     DEFM "ATLAS Operating System Version 2.04"      	;
447)   1B46 2E 30 34    		     DEFM "ATLAS Operating System Version 2.04"      	;
448)   1B49 0A 0D 0A 0D 		     DEFB 0AH,0DH,0AH,0DH      	;
449)   1B4D 00          		     DEFB 00H	;
450)   1B4E AF          		           XOR A	;
451)   1B4F 11 FF FF    		          LD DE,0xFFFF  ;DE = HIMEM	;DE = HIMEM
452)   1B52 5F          		          LD E,A              ;PAGE BOUNDARY	;PAGE BOUNDARY
453)   1B53 21 B9 83    		          LD HL,@USER      	;
454)   1B56 FB          		          EI     	;
455)   1B57 C9          		          RET 	;
456)   1B58 00 00       		COL_PALET: DW COL_BLACK	;
457)   1B5A 00 F8       		           DW COL_RED	;
458)   1B5C C0 07       		           DW COL_GREEN	;
459)   1B5E C0 FF       		           DW COL_YELLOW	;
460)   1B60 3F 00       		           DW COL_BLUE	;
461)   1B62 3F F8       		           DW COL_MAGENTA	;
462)   1B64 FF 07       		           DW COL_CYAN	;
463)   1B66 FF FF       		           DW COL_WHITE            	;
464)   1B68 00 00       		          DW COL_BLACK ;TODO PICK 8 MORE COLORS	;TODO PICK 8 MORE COLORS
465)   1B6A 00 F8       		           DW COL_RED	;
466)   1B6C C0 07       		           DW COL_GREEN	;
467)   1B6E C0 FF       		           DW COL_YELLOW	;
468)   1B70 3F 00       		           DW COL_BLUE	;
469)   1B72 3F F8       		           DW COL_MAGENTA	;
470)   1B74 FF 07       		           DW COL_CYAN	;
471)   1B76 FF FF       		           DW COL_WHITE            	;
477)   1B78 CD D2 1B    		     CALL    SKIPSP	;
478)   1B7B FE 0D       		  CP      CR	;
479)   1B7D C8          		  RET     Z	;
480)   1B7E FE 7C       		  CP      '|'	;
481)   1B80 C8          		  RET     Z	;
482)   1B81 FE 2E       		  CP      '.'	;
483)   1B83 CA FF 1B    		  JP      Z,DOT           ;*.	;*.
484)   1B86 EB          		  EX      DE,HL	;
485)   1B87 21 E1 1B    		  LD      HL,COMDS	;
486)   1B8A 1A          		OSCLI0:  LD      A,(DE)	;
487)   1B8B CD D9 1B    		  CALL    UPPRC	;
488)   1B8E BE          		  CP      (HL)	;
489)   1B8F 28 0B       		  JR      Z,OSCLI2	;
490)   1B91 38 2E       		  JR      C,HUH	;
491)   1B93 CB 7E       		OSCLI1:  BIT     7,(HL)	;
492)   1B95 23          		  INC     HL	;
493)   1B96 28 FB       		  JR      Z,OSCLI1	;
494)   1B98 23          		  INC     HL	;
495)   1B99 23          		  INC     HL	;
496)   1B9A 18 EE       		  JR      OSCLI0	;
498)   1B9C D5          		OSCLI2:  PUSH    DE	;
499)   1B9D 13          		OSCLI3:  INC     DE	;
500)   1B9E 23          		  INC     HL	;
501)   1B9F 1A          		  LD      A,(DE)	;
502)   1BA0 CD D9 1B    		  CALL    UPPRC	;
503)   1BA3 FE 2E       		  CP      '.'             ;ABBREVIATED?	;ABBREVIATED?
504)   1BA5 28 0A       		  JR      Z,OSCLI4	;
505)   1BA7 AE          		  XOR     (HL)	;
506)   1BA8 28 F3       		  JR      Z,OSCLI3	;
507)   1BAA FE 80       		  CP      80H	;
508)   1BAC 28 03       		  JR      Z,OSCLI4	;
509)   1BAE D1          		  POP     DE	;
510)   1BAF 18 E2       		  JR      OSCLI1	;
512)   1BB1 F1          		OSCLI4:  POP     AF	;
513)   1BB2 13          		         INC     DE	;
514)   1BB3 CB 7E       		OSCLI5:  BIT     7,(HL)	;
515)   1BB5 23          		  INC     HL	;
516)   1BB6 28 FB       		  JR      Z,OSCLI5	;
517)   1BB8 7E          		  LD      A,(HL)	;
518)   1BB9 23          		  INC     HL	;
519)   1BBA 66          		  LD      H,(HL)	;
520)   1BBB 6F          		  LD      L,A	;
521)   1BBC E5          		  PUSH    HL	;
522)   1BBD EB          		  EX      DE,HL	;
523)   1BBE C3 D2 1B    		  JP      SKIPSP	;
525)   1BC1 3E FE       		HUH:     LD      A,254	;
526)   1BC3 CD F0 46    		         CALL    EXTERR	;
527)   1BC6 42 61 64 20 		         DEFM    'Bad command'	;
527)   1BCA 63 6F 6D 6D 		         DEFM    'Bad command'	;
527)   1BCE 61 6E 64    		         DEFM    'Bad command'	;
528)   1BD1 00          		         DEFB    0   	;
530)   1BD2 7E          		SKIPSP:  LD      A,(HL)	;
531)   1BD3 FE 20       		         CP      ' '	;
532)   1BD5 C0          		         RET     NZ	;
533)   1BD6 23          		         INC     HL	;
534)   1BD7 18 F9       		         JR      SKIPSP 	;
536)   1BD9 E6 7F       		UPPRC:   AND     7FH	;
537)   1BDB FE 60       		  CP      '`'	;
538)   1BDD D8          		  RET     C	;
539)   1BDE E6 5F       		  AND     5FH             ;CONVERT TO UPPER CASE	;CONVERT TO UPPER CASE
540)   1BE0 C9          		  RET     	;
544)   1BE1 42 59       		COMDS:DEFM   'BY'	;
545)   1BE3 C5          		  DEFB    'E'+80H	;
546)   1BE4 00 1C       		  DEFW    BYE	;
547)   1BE6 43          		     DEFM    'C'	;
548)   1BE7 C4          		  DEFB    'D'+80H	;
549)   1BE8 04 1C       		  DEFW    NIMP   	;
550)   1BEA 44 49       		     DEFM    'DI'	;
551)   1BEC D2          		  DEFB    'R'+80H	;
552)   1BED 04 1C       		  DEFW    NIMP   	;
553)   1BEF 46          		     DEFM    'F'	;
554)   1BF0 D8          		  DEFB    'X'+80H	;
555)   1BF1 03 1C       		  DEFW    FX   	;
556)   1BF3 50 57       		     DEFM    'PW'	;
557)   1BF5 C4          		  DEFB    'D'+80H	;
558)   1BF6 04 1C       		  DEFW    NIMP   	;
559)   1BF8 54 59 50    		     DEFM    'TYP'	;
560)   1BFB C5          		  DEFB    'E'+80H	;
561)   1BFC 04 1C       		  DEFW    NIMP      	;
563)   1BFE FF          		  DEFB 0FFH	;
566)   1BFF C9          		DOT:  RET	;
571)   1C00 C3 00 00    		BYE:  JP 0	;
574)   1C03 C9          		FX: RET  	;
577)   1C04 C9          		NIMP: RET  ;NOT IMPLEMENTED YET	;NOT IMPLEMENTED YET
591)   1C05 3E 01       		@MYOS_GETEXT: LD A,1	;
592)   1C07 C9          		             RET 	;
594)   1C08 C9          		@MYOS_RESET: RET	;
596)   1C09 CD 94 5E    		@MYOS_MODE:CALL EXPRI   ;GET PARAM	;GET PARAM
597)   1C0C D9          		          EXX           ;HL HAS THE PARAM      	;HL HAS THE PARAM
598)   1C0D C3 E8 4C    		          JP XEQ	;
600)   1C10 CD 5D 16    		@MYOS_CLG: CALL GRPH_SAVECOLORS	;
601)   1C13 CD D2 11    		          CALL LCD_CLRSCR	;
602)   1C16 CD 74 16    		          CALL GRPH_RESTORECOLORS	;
603)   1C19 C3 E8 4C    		          JP XEQ           ;RETURN TO BASIC    	;RETURN TO BASIC
606)   1C1C DD E5       		@MYOS_GCOL:  PUSH IX	;
607)   1C1E 3E 01       		             LD A,1	;
608)   1C20 CD 62 14    		             CALL BAS_COLOUR     	;
609)   1C23 DD E1       		             POP IX	;
610)   1C25 C3 E8 4C    		             JP XEQ           ;RETURN TO BASIC    	;RETURN TO BASIC
612)   1C28 DD E5       		@MYOS_COLOUR: PUSH IX	;
613)   1C2A AF          		             XOR A   	;
614)   1C2B CD 62 14    		             CALL BAS_COLOUR     	;
615)   1C2E DD E1       		             POP IX	;
616)   1C30 C3 E8 4C    		             JP XEQ           ;RETURN TO BASIC              	;RETURN TO BASIC
618)   1C33 DD E5       		@MYOS_DRAW: PUSH IX 	;
619)   1C35 CD 3B 15    		           CALL BAS_DRAW	;
620)   1C38 DD E1       		           POP IX	;
621)   1C3A C3 E8 4C    		           JP XEQ           ;RETURN TO BASIC    	;RETURN TO BASIC
623)   1C3D DD E5       		@MYOS_MOVE:PUSH IX	;
624)   1C3F CD 64 15    		          CALL BAS_MOVE	;
625)   1C42 DD E1       		          POP IX	;
626)   1C44 C3 E8 4C    		          JP XEQ           ;RETURN TO BASIC    	;RETURN TO BASIC
628)   1C47 DD E5       		@MYOS_PLOT:PUSH IX	;
629)   1C49 CD D4 15    		          CALL BAS_PLOT	;
630)   1C4C DD E1       		          POP IX	;
631)   1C4E C3 E8 4C    		          JP XEQ           ;RETURN TO BASIC    	;RETURN TO BASIC
633)   1C51 DD E5       		@MYOS_POINT:PUSH IX	;
634)   1C53 CD 70 15    		          CALL BAS_POINT ;RETURNS A VALUE TO BASIC	;RETURNS A VALUE TO BASIC
635)   1C56 DD E1       		          POP IX	;
636)   1C58 C9          		          RET	;
646)   1C59 CD F7 14    		@MYOS_PUTIMS:CALL GETBASICPARAMS;            	;
647)   1C5C C3 E8 4C    		            JP XEQ	;
649)   1C5F CD F0 46    		  CALL    EXTERR	;
650)   1C62 53 6F 72 72 		  DEFM    'Sorry'	;
650)   1C66 79          		  DEFM    'Sorry'	;
651)   1C67 00          		  DEFB    0            	;
658)   1C68 CD 1D 03    		GETKEY:   CALL GET_CHAR	;
659)   1C6B 37          		           SCF	;
660)   1C6C C9          		        RET       	;
665)   1C6D CD 79 1C    		GETKEYNW: CALL CHKCURS	;
666)   1C70 CD FA 02    		           CALL GET_CHARNW	;
667)   1C73 3F          		           CCF	;
668)   1C74 FE 00       		           CP 0	;
669)   1C76 C8          		           RET Z	;
670)   1C77 37          		           SCF	;
671)   1C78 C9          		        RET       	;
673)   1C79 F5          		@CHKCURS:   PUSH AF	;
674)   1C7A 3A A7 83    		           LD A,(TIMECTR)	;
675)   1C7D CB 67       		           BIT 4,A	;
676)   1C7F 28 11       		           JR Z,CCSHOW      ;IF SET SHOW       	;IF SET SHOW
677)   1C81 3A 11 83    		CCHIDE:    LD A,(CURSSTAT)	;
678)   1C84 CB 4F       		           BIT 1,A	;
679)   1C86 20 19       		           JR NZ,CCEX      ;IF NOT SET ALREADY HIDDEN	;IF NOT SET ALREADY HIDDEN
680)   1C88 CB CF       		           SET 1,A	;
681)   1C8A 32 11 83    		           LD (CURSSTAT),A	;
682)   1C8D CD 8B 11    		           CALL LCD_RMVCURS	;
683)   1C90 18 0F       		           JR CCEX                                               	;
684)   1C92 3A 11 83    		CCSHOW:    LD A,(CURSSTAT)	;
685)   1C95 CB 4F       		           BIT 1,A	;
686)   1C97 28 08       		           JR Z,CCEX      ;IF SET ALREADY VISIBLE	;IF SET ALREADY VISIBLE
687)   1C99 CB 8F       		           RES 1,A	;
688)   1C9B 32 11 83    		           LD (CURSSTAT),A	;
689)   1C9E CD 90 11    		           CALL LCD_PRNCURS	;
691)   1CA1 F1          		CCEX:      POP AF	;
692)   1CA2 C9          		     RET          	;
703)   1CA3 3A 00 83    		       LD      A,(FLAGS)	;
704)   1CA6 CB 5F       		       BIT     3,A             ;EDIT MODE?	;EDIT MODE?
705)   1CA8 28 09       		       JR      Z,OSLIN1	;
706)   1CAA CB 9F       		       RES     3,A	;
707)   1CAC 32 00 83    		       LD      (FLAGS),A	;
708)   1CAF 2A 12 83    		       LD      HL,(EDPTR)	;
709)   1CB2 BD          		       CP      L	;
710)   1CB3 3E 0D       		OSLIN1: LD     A,CR	;
711)   1CB5 77          		       LD      (HL),A	;
712)   1CB6 C4 91 18    		       CALL    NZ,MYOS_OSWRCH	;
713)   1CB9 2E 00       		       LD      L,0	;
714)   1CBB 4D          		       LD      C,L             ;REPEAT FLAG	;REPEAT FLAG
715)   1CBC 28 20       		       JR      Z,OSWAIT        ;SUPPRESS UNWANTED SPACE	;SUPPRESS UNWANTED SPACE
716)   1CBE 06 00       		UPDATE: LD     B,0	;
717)   1CC0 7E          		UPD1:  LD      A,(HL)	;
718)   1CC1 04          		       INC     B	;
719)   1CC2 23          		       INC     HL	;
720)   1CC3 FE 0D       		       CP      CR	;
721)   1CC5 F5          		       PUSH    AF	;
722)   1CC6 E5          		       PUSH    HL	;
723)   1CC7 5F          		       LD      E,A	;
724)   1CC8 C4 45 1A    		       CALL    NZ,WRCH         ;FAST WRCH	;FAST WRCH
725)   1CCB E1          		       POP     HL	;
726)   1CCC F1          		       POP     AF	;
727)   1CCD 20 F1       		       JR      NZ,UPD1	;
728)   1CCF 3E 20       		       LD      A,' '	;
729)   1CD1 CD 91 18    		       CALL    MYOS_OSWRCH	;
730)   1CD4 1E 08       		       LD      E,BS	;
731)   1CD6 E5          		UPD2:  PUSH    HL	;
732)   1CD7 CD 45 1A    		       CALL    WRCH            ;FAST WRCH	;FAST WRCH
733)   1CDA E1          		       POP     HL	;
734)   1CDB 2B          		       DEC     HL	;
735)   1CDC 10 F8       		       DJNZ    UPD2	;
736)   1CDE 79          		OSWAIT: LD     A,C	;
737)   1CDF 05          		       DEC     B	;
738)   1CE0 28 01       		       JR      Z,LIMIT	;
739)   1CE2 B7          		       OR      A               ;REPEAT COMMAND?	;REPEAT COMMAND?
740)   1CE3 CC 84 18    		LIMIT: CALL    Z,KEYGET        ;READ KEYBOARD	;READ KEYBOARD
741)   1CE6 4F          		       LD      C,A             ;SAVE FOR REPEAT	;SAVE FOR REPEAT
742)   1CE7 11 DE 1C    		       LD      DE,OSWAIT       ;RETURN ADDRESS	;RETURN ADDRESS
743)   1CEA D5          		       PUSH    DE	;
744)   1CEB 3A 00 83    		       LD      A,(FLAGS)	;
745)   1CEE B7          		       OR      A               ;TEST FOR ESCAPE	;TEST FOR ESCAPE
746)   1CEF 79          		       LD      A,C	;
747)   1CF0 FA 32 1D    		       JP      M,OSEXIT	;
748)   1CF3 FE 0B       		       CP      11         ;CURSOR UP     (IX-11)	;CURSOR UP     (IX-11)
749)   1CF5 CA 76 1D    		       JP      Z,LEFT	;
750)   1CF8 FE 0A       		       CP      10         ;CURSOR DOWN   (IX-10)	;CURSOR DOWN   (IX-10)
751)   1CFA CA A9 1D    		       JP      Z,RIGHT	;
752)   1CFD 06 00       		       LD      B,0	;
753)   1CFF FE 05       		       CP      5          ;CLEAR LEFT    (IX-5)	;CLEAR LEFT    (IX-5)
754)   1D01 28 72       		       JR      Z,BACK	;
755)   1D03 FE 09       		       CP      9          ;START OF LINE (IX-9)	;START OF LINE (IX-9)
756)   1D05 28 6F       		       JR      Z,LEFT	;
757)   1D07 FE 07       		       CP      7          ;CLEAR RIGHT   (IX-7)	;CLEAR RIGHT   (IX-7)
758)   1D09 28 76       		       JR      Z,DELETE	;
759)   1D0B FE 08       		       CP      8          ;END OF LINE   (IX-8)	;END OF LINE   (IX-8)
760)   1D0D CA A9 1D    		       JP      Z,RIGHT	;
761)   1D10 0E 00       		       LD      C,0             ;INHIBIT REPEAT	;INHIBIT REPEAT
762)   1D12 FE 10       		       CP      'P' AND 1FH	;
763)   1D14 CA 68 1A    		       JP      Z,TOGGLE	;
764)   1D17 FE 06       		       CP      6          ;DELETE LEFT   (IX-6)	;DELETE LEFT   (IX-6)
765)   1D19 28 5A       		       JR      Z,BACK	;
766)   1D1B FE 04       		       CP      4          ;CURSOR LEFT   (IX-4)	;CURSOR LEFT   (IX-4)
767)   1D1D 28 57       		       JR      Z,LEFT	;
768)   1D1F FE 02       		       CP      2          ;DELETE RIGHT  (IX-2)	;DELETE RIGHT  (IX-2)
769)   1D21 28 5E       		       JR      Z,DELETE	;
770)   1D23 FE 01       		       CP      1          ;INSERT SPACE  (IX-1)	;INSERT SPACE  (IX-1)
771)   1D25 28 6E       		       JR      Z,INSERT	;
772)   1D27 FE 03       		       CP      3          ;CURSOR RIGHT  (IX-3)	;CURSOR RIGHT  (IX-3)
773)   1D29 28 7E       		       JR      Z,RIGHT	;
774)   1D2B FE 20       		       CP      ' '             ;PRINTING CHARACTER	;PRINTING CHARACTER
775)   1D2D 30 7F       		       JR      NC,SAVECH	;
776)   1D2F FE 0D       		       CP      CR              ;ENTER LINE	;ENTER LINE
777)   1D31 C0          		       RET     NZ	;
778)   1D32 7E          		OSEXIT: LD     A,(HL)	;
779)   1D33 CD 91 18    		       CALL    MYOS_OSWRCH          ;WRITE REST OF LINE	;WRITE REST OF LINE
780)   1D36 23          		       INC     HL	;
781)   1D37 D6 0D       		       SUB     CR	;
782)   1D39 20 F7       		       JR      NZ,OSEXIT	;
783)   1D3B D1          		       POP     DE              ;DITCH RETURN ADDRESS	;DITCH RETURN ADDRESS
784)   1D3C B9          		       CP      C	;
785)   1D3D C2 A5 1A    		       JP      NZ,ABORT        ;ESCAPE	;ESCAPE
786)   1D40 3E 0A       		       LD      A,LF	;
787)   1D42 CD 91 18    		       CALL    MYOS_OSWRCH	;
788)   1D45 ED 5B F4 82 		       LD      DE,(ERRLIN)	;
789)   1D49 AF          		       XOR     A	;
790)   1D4A 6F          		       LD      L,A	;
791)   1D4B 22 12 83    		       LD      (EDPTR),HL	;
792)   1D4E BA          		       CP      D	;
793)   1D4F C0          		       RET     NZ	;
794)   1D50 BB          		       CP      E	;
795)   1D51 C0          		       RET     NZ	;
796)   1D52 11 C2 1D    		       LD      DE,EDITST	;
797)   1D55 06 04       		       LD      B,4	;
798)   1D57 1A          		CMPARE: LD     A,(DE)	;
799)   1D58 BE          		       CP      (HL)	;
800)   1D59 3E 00       		       LD      A,0	;
801)   1D5B C0          		       RET     NZ	;
802)   1D5C 23          		       INC     HL	;
803)   1D5D 13          		       INC     DE	;
804)   1D5E 7E          		       LD      A,(HL)	;
805)   1D5F FE 2E       		       CP      '.'	;
806)   1D61 28 02       		       JR      Z,ABBR	;
807)   1D63 10 F2       		       DJNZ    CMPARE	;
808)   1D65 AF          		ABBR:  XOR     A	;
809)   1D66 47          		       LD      B,A	;
810)   1D67 4D          		       LD      C,L	;
811)   1D68 6F          		       LD      L,A	;
812)   1D69 11 C6 1D    		       LD      DE,LISTST	;
813)   1D6C EB          		       EX      DE,HL	;
814)   1D6D ED B0       		       LDIR	;
815)   1D6F 21 00 83    		       LD      HL,FLAGS	;
816)   1D72 CB DE       		       SET     3,(HL)	;
817)   1D74 C9          		       RET	;
819)   1D75 37          		BACK:  SCF                     ;DELETE LEFT	;DELETE LEFT
820)   1D76 2C          		LEFT:  INC     L               ;CURSOR LEFT	;CURSOR LEFT
821)   1D77 2D          		       DEC     L	;
822)   1D78 28 45       		       JR      Z,STOP	;
823)   1D7A 3E 08       		       LD      A,BS	;
824)   1D7C CD 91 18    		       CALL    MYOS_OSWRCH	;
825)   1D7F 2D          		       DEC     L	;
826)   1D80 D0          		       RET     NC	;
827)   1D81 7E          		DELETE: LD     A,(HL)          ;DELETE RIGHT	;DELETE RIGHT
828)   1D82 FE 0D       		       CP      CR	;
829)   1D84 28 39       		       JR      Z,STOP	;
830)   1D86 54          		       LD      D,H	;
831)   1D87 5D          		       LD      E,L	;
832)   1D88 13          		DEL1:  INC     DE	;
833)   1D89 1A          		       LD      A,(DE)	;
834)   1D8A 1B          		       DEC     DE	;
835)   1D8B 12          		       LD      (DE),A	;
836)   1D8C 13          		       INC     DE	;
837)   1D8D FE 0D       		       CP      CR	;
838)   1D8F 20 F7       		       JR      NZ,DEL1	;
839)   1D91 D1          		DEL2:  POP     DE              ;DITCH	;DITCH
840)   1D92 C3 BE 1C    		       JP      UPDATE	;
842)   1D95 3E 0D       		INSERT: LD     A,CR            ;INSERT SPACE	;INSERT SPACE
843)   1D97 BE          		       CP      (HL)	;
844)   1D98 C8          		       RET     Z	;
845)   1D99 54          		       LD      D,H	;
846)   1D9A 1E FE       		       LD      E,254	;
847)   1D9C 13          		INS1:  INC     DE	;
848)   1D9D 12          		       LD      (DE),A	;
849)   1D9E 1B          		       DEC     DE	;
850)   1D9F 7B          		       LD      A,E	;
851)   1DA0 BD          		       CP      L	;
852)   1DA1 1B          		       DEC     DE	;
853)   1DA2 1A          		       LD      A,(DE)	;
854)   1DA3 20 F7       		       JR      NZ,INS1	;
855)   1DA5 36 20       		       LD      (HL),' '	;
856)   1DA7 18 E8       		       JR      DEL2	;
858)   1DA9 7E          		RIGHT: LD      A,(HL)          ;CURSOR RIGHT	;CURSOR RIGHT
859)   1DAA FE 0D       		       CP      CR	;
860)   1DAC 28 11       		       JR      Z,STOP	;
861)   1DAE 56          		SAVECH: LD     D,(HL)          ;PRINTING CHARACTER	;PRINTING CHARACTER
862)   1DAF 77          		       LD      (HL),A	;
863)   1DB0 2C          		       INC     L	;
864)   1DB1 28 09       		       JR      Z,WONTGO        ;LINE TOO LONG	;LINE TOO LONG
865)   1DB3 CD 91 18    		       CALL    MYOS_OSWRCH	;
866)   1DB6 3E 0D       		       LD      A,CR	;
867)   1DB8 BA          		       CP      D	;
868)   1DB9 C0          		       RET     NZ	;
869)   1DBA 77          		       LD      (HL),A	;
870)   1DBB C9          		       RET	;
872)   1DBC 2D          		WONTGO: DEC    L	;
873)   1DBD 36 0D       		       LD      (HL),CR	;
876)   1DBF 0E 00       		STOP:  LD      C,0             ;STOP REPEAT	;STOP REPEAT
877)   1DC1 C9          		       RET	;
880)   1DC2 45 44 49 54 		EDITST: DEFM   'EDIT'	;
881)   1DC6 4C 49 53 54 		LISTST: DEFM   'LIST'	;
  4)   1DCA 	            		PORT_TAPE      EQU DEVTAP      ; SAVE/LOAD PORT 1 BYTE=0xDD 2ND BYTE=COMMAND 	; SAVE/LOAD PORT 1 BYTE=0xDD 2ND BYTE=COMMAND
 17)   1DCA 3E DD       		           LD A,0xDD	;
 18)   1DCC CD FE 05    		           CALL RS_TX	;
 19)   1DCF 3E 0A       		           LD A,COMMD_SAVE	;
 20)   1DD1 CD FE 05    		           CALL RS_TX	;
 22)   1DD4 7E          		OSSV_NXT:  LD A,(HL)	;
 23)   1DD5 CD FE 05    		           CALL RS_TX	;
 24)   1DD8 23          		           INC HL	;
 25)   1DD9 FE 0D       		           CP 0x0D	;
 26)   1DDB 20 F7       		           JR NZ,OSSV_NXT	;
 28)   1DDD 79          		           LD A,C	;
 29)   1DDE CD FE 05    		           CALL RS_TX	;
 30)   1DE1 78          		           LD A,B	;
 31)   1DE2 CD FE 05    		           CALL RS_TX	;
 33)   1DE5 2A DC 82    		           LD HL,(PAGE)	;
 34)   1DE8 7E          		OSSV_NXT2: LD A,(HL)	;
 35)   1DE9 CD FE 05    		           CALL RS_TX	;
 36)   1DEC 23          		           INC HL	;
 37)   1DED 0B          		           DEC BC	;
 38)   1DEE 78          		           LD A,B	;
 39)   1DEF B1          		           OR C	;
 40)   1DF0 20 F6       		           JR NZ,OSSV_NXT2                        	;
 41)   1DF2 C9          		           RET              	;
 47)   1DF3 3E DD       		           LD A,0xDD	;
 48)   1DF5 CD FE 05    		           CALL RS_TX	;
 49)   1DF8 3E 14       		           LD A,COMMD_LOAD	;
 50)   1DFA CD FE 05    		           CALL RS_TX	;
 52)   1DFD 7E          		OSLD_NXT:  LD A,(HL)	;
 53)   1DFE CD FE 05    		           CALL RS_TX	;
 54)   1E01 23          		           INC HL	;
 55)   1E02 FE 0D       		           CP 0x0D	;
 56)   1E04 20 F7       		           JR NZ,OSLD_NXT	;
 58)   1E06 CD 17 06    		           CALL RS_RX	;
 59)   1E09 4F          		           LD C,A	;
 60)   1E0A CD 17 06    		           CALL RS_RX	;
 61)   1E0D 47          		           LD B,A	;
 62)   1E0E B7          		           OR A	;
 63)   1E0F 20 0A       		           JR NZ,OK1	;
 64)   1E11 79          		           LD A,C	;
 65)   1E12 B7          		           OR A	;
 66)   1E13 20 06       		           JR NZ,OK1	;
 68)   1E15 CD 17 06    		           CALL RS_RX ;GET THE ERRORCODE            	;GET THE ERRORCODE
 69)   1E18 C3 32 1E    		           JP LDERR	;
 72)   1E1B 2A DC 82    		           LD HL,(PAGE)                        	;
 73)   1E1E CD 17 06    		OSLD_NXT2: CALL RS_RX	;
 74)   1E21 77          		           LD (HL),A	;
 75)   1E22 23          		           INC HL	;
 76)   1E23 0B          		           DEC BC	;
 77)   1E24 78          		           LD A,B	;
 78)   1E25 B1          		           OR C	;
 79)   1E26 20 F6       		           JR NZ,OSLD_NXT2                        	;
 80)   1E28 44          		           LD B,H	;
 81)   1E29 4D          		           LD C,L	;
 82)   1E2A 21 DE 82    		           LD HL,TOP ;SAVE TOP OF BASIC 	;SAVE TOP OF BASIC
 83)   1E2D 71          		           LD (HL),C	;
 84)   1E2E 23          		           INC HL	;
 85)   1E2F 70          		           LD (HL),B            	;
 86)   1E30 37          		           SCF       ;SET C = NO ERROR            	;SET C = NO ERROR
 87)   1E31 C9          		           RET   	;
 89)   1E32 FE 04       		LDERR:    CP 4	;
 90)   1E34 28 11       		           JR Z,FLNOTF	;
 91)   1E36 CD F0 46    		           CALL    EXTERR	;
 92)   1E39 45 72 72 6F 		         DEFM    'Error Loading'	;
 92)   1E3D 72 20 4C 6F 		         DEFM    'Error Loading'	;
 92)   1E41 61 64 69 6E 		         DEFM    'Error Loading'	;
 92)   1E45 67          		         DEFM    'Error Loading'	;
 93)   1E46 00          		         DEFB    0   	;
 94)   1E47 CD F0 46    		FLNOTF:    CALL    EXTERR	;
 95)   1E4A 57 72 6F 6E 		         DEFM    'Wrong Filename'	;
 95)   1E4E 67 20 46 69 		         DEFM    'Wrong Filename'	;
 95)   1E52 6C 65 6E 61 		         DEFM    'Wrong Filename'	;
 95)   1E56 6D 65       		         DEFM    'Wrong Filename'	;
 96)   1E58 00          		         DEFB    0   	;
  8)   1E59 	            		DI2C_STA  EQU DEVI2C+0 ;00 A0=LOW A1=LOW READONLY  DEF $F8	;00 A0=LOW A1=LOW READONLY  DEF $F8
  9)   1E59 	            		DI2C_INDPTR EQU DEVI2C+0 ;00 A0=LOW A1=LOW WRITEONLY DEF $00	;00 A0=LOW A1=LOW WRITEONLY DEF $00
 10)   1E59 	            		DI2C_DAT EQU DEVI2C+1 ;01 A0=HIGH A1=LOW R/W  DEF $00	;01 A0=HIGH A1=LOW R/W  DEF $00
 11)   1E59 	            		DI2C_CON EQU DEVI2C+3 ;11 A0=HIGH A1=HIGH R/W DEF $00	;11 A0=HIGH A1=HIGH R/W DEF $00
 12)   1E59 	            		DI2C_INDIR EQU DEVI2C+2 ;10 A0=LOW A1=HIGH R/W DEF $00	;10 A0=LOW A1=HIGH R/W DEF $00
 57)   1E59 C5          		I2C_RDSTAT_WT: PUSH BC	;
 58)   1E5A 01 00 20    		 LD BC,$2000	;
 59)   1E5D DB 4B       		I2CRWT_AGN: IN A,(DI2C_CON) ;READ CONTROL REGISTER BIT 3 IS SI	;READ CONTROL REGISTER BIT 3 IS SI
 60)   1E5F CB 5F       		 BIT 3,A   ;CHECK BIT 3 SI	;CHECK BIT 3 SI
 61)   1E61 20 05       		 JR NZ,I2CRWT_OK  ;BIT 3 SHOULD BE SET IF VALID STATUS	;BIT 3 SHOULD BE SET IF VALID STATUS
 62)   1E63 0B          		 DEC BC	;
 63)   1E64 78          		 LD A,B	;
 64)   1E65 B1          		 OR C	;
 65)   1E66 20 F5       		 JR NZ,I2CRWT_AGN	;
 66)   1E68 C1          		I2CRWT_OK: POP BC	;
 67)   1E69 DB 48       		 IN A,(DI2C_STA)  ;VALID HERE	;VALID HERE
 68)   1E6B C9          		 RET	;
 70)   1E6C DB 4B       		I2C_RDSTAT_NW: IN A,(DI2C_CON) ;READ CONTROL REGISTER BIT 3 IS SI	;READ CONTROL REGISTER BIT 3 IS SI
 71)   1E6E CB 5F       		 BIT 3,A   ;CHECK BIT 3 SI	;CHECK BIT 3 SI
 72)   1E70 3E FF       		 LD A,$FF  ;$FF=INVALID STATUS	;$FF=INVALID STATUS
 73)   1E72 C8          		 RET Z   ;BIT 3 SHOULD BE SET IF VALID STATUS	;BIT 3 SHOULD BE SET IF VALID STATUS
 74)   1E73 DB 48       		 IN A,(DI2C_STA)  ;VALID HERE	;VALID HERE
 75)   1E75 C9          		 RET	;
 78)   1E76 3E 01       		I2C_INIT: LD A,I2CADR	;
 79)   1E78 D3 48       		 OUT (DI2C_INDPTR),A	;
 80)   1E7A 3E E0       		 LD A,$E0	;
 81)   1E7C D3 4A       		 OUT (DI2C_INDIR),A  ;SET MY SLAVE ADDR	;SET MY SLAVE ADDR
 83)   1E7E 3E 40       		 LD A,$40  ;INIT	;INIT
 84)   1E80 D3 4B       		 OUT (DI2C_CON),A ;	;
 85)   1E82 06 FA       		 LD B,250	;
 86)   1E84 CD D9 21    		 CALL DELAYMICRO	;
 87)   1E87 06 FA       		 LD B,250	;
 88)   1E89 CD D9 21    		 CALL DELAYMICRO  ;DELAY 500 MICROSECS	;DELAY 500 MICROSECS
 93)   1E8C 3E 06       		 LD A,I2CMODE	;
 94)   1E8E D3 48       		 OUT (DI2C_INDPTR),A ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
 95)   1E90 3E 00       		 LD A,0   ;SELECT MODE 0	;SELECT MODE 0
 96)   1E92 D3 4A       		 OUT (DI2C_INDIR),A	;
 97)   1E94 3E 02       		 LD A,I2CSCLL	;
 98)   1E96 D3 48       		 OUT (DI2C_INDPTR),A ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
 99)   1E98 3E 9D       		 LD A,$9D  ;SELECT CLK L	;SELECT CLK L
100)   1E9A D3 4A       		 OUT (DI2C_INDIR),A	;
101)   1E9C 3E 03       		 LD A,I2CSCLH	;
102)   1E9E D3 48       		 OUT (DI2C_INDPTR),A ;SELECT I2CMODE REGISTER	;SELECT I2CMODE REGISTER
103)   1EA0 3E 86       		 LD A,$86  ;SELECT CLK H	;SELECT CLK H
104)   1EA2 D3 4A       		 OUT (DI2C_INDIR),A	;
106)   1EA4 C9          		 RET	;
113)   1EA5 3E 60       		I2C_WR_BYTE: LD A,$60  ;START	;START
114)   1EA7 D3 4B       		   OUT (DI2C_CON),A	;
115)   1EA9 CD 59 1E    		WRB_LP1: CALL I2C_RDSTAT_WT ;WAIT FOR INTERRUPT SI=1	;WAIT FOR INTERRUPT SI=1
116)   1EAC 5F          		 LD E,A   ;SAVE STATUS	;SAVE STATUS
117)   1EAD FE 08       		 CP MASTER_START_TXed ;A HAS THE STATUS	;A HAS THE STATUS
118)   1EAF 28 21       		 JR Z,WRB_S1	;
119)   1EB1 FE 10       		 CP MASTER_RESTART_TXed	;
120)   1EB3 28 1D       		 JR Z,WRB_S1	;
121)   1EB5 FE 28       		 CP MASTER_DATA_W_ACK	;
122)   1EB7 28 26       		 JR Z,WRB_S2	;
123)   1EB9 FE 18       		 CP MASTER_SLA_W_ACK	;
124)   1EBB 28 23       		 JR Z,WRB_S3	;
125)   1EBD FE 20       		 CP MASTER_SLA_W_NAK	;
126)   1EBF 28 2D       		 JR Z,WRB_EXIT	;
127)   1EC1 FE 30       		 CP MASTER_DATA_W_NAK	;
128)   1EC3 28 29       		 JR Z,WRB_EXIT	;
129)   1EC5 FE 38       		 CP MASTER_ARB_LOST	;
130)   1EC7 C8          		 RET Z	;
131)   1EC8 FE B0       		 CP SLAVE_AL_ADDRESSED_R	;
132)   1ECA C8          		 RET Z	;
133)   1ECB FE 68       		 CP SLAVE_AL_ADDRESSED_W	;
134)   1ECD C8          		 RET Z	;
135)   1ECE FE D8       		 CP SLAVE_GENERALCALL_AL 	;
136)   1ED0 C8          		 RET Z	;
137)   1ED1 C9          		 RET	;
139)   1ED2 7A          		WRB_S1: LD A,D    ;DEVICE ADDR	;DEVICE ADDR
140)   1ED3 CB 27       		 SLA A	;
141)   1ED5 E6 FE       		 AND $FE   ;ADDR+WRITE ON D0=0	;ADDR+WRITE ON D0=0
142)   1ED7 D3 49       		 OUT (DI2C_DAT),A  	;
143)   1ED9 3E 40       		 LD A,$40	;
144)   1EDB D3 4B       		   OUT (DI2C_CON),A  	;
145)   1EDD 18 CA       		 JR WRB_LP1	;
146)   1EDF 0B          		WRB_S2: DEC BC	;
147)   1EE0 78          		WRB_S3: LD A,B	;
148)   1EE1 B1          		 OR C	;
149)   1EE2 28 0A       		 JR Z,WRB_EXIT	;
150)   1EE4 7E          		 LD A,(HL)	;
151)   1EE5 23          		 INC HL	;
152)   1EE6 D3 49       		 OUT (DI2C_DAT),A	;
153)   1EE8 3E 40       		 LD A,$40	;
154)   1EEA D3 4B       		   OUT (DI2C_CON),A	;
155)   1EEC 18 BB       		 JR WRB_LP1 	;
157)   1EEE 3E 50       		WRB_EXIT: LD A,$50 ;STOP	;STOP
158)   1EF0 D3 4B       		   OUT (DI2C_CON),A	;
159)   1EF2 78          		 LD A,B	;
160)   1EF3 B1          		 OR C	;
161)   1EF4 C9          		 RET  ;IF A NOT ZERO THEN ERROR  	;IF A NOT ZERO THEN ERROR
167)   1EF5 78          		I2C_RD_BYTE: LD A,B	;
168)   1EF6 B1          		 OR C	;
169)   1EF7 C8          		 RET Z ;RETURN IF ZERO BYTE COUNT	;RETURN IF ZERO BYTE COUNT
170)   1EF8 3E 60       		 LD A,$60	;
171)   1EFA D3 4B       		   OUT (DI2C_CON),A	;
172)   1EFC CD 59 1E    		RDB_LP1: CALL I2C_RDSTAT_WT ;WAIT FOR INTERRUPT SI=1	;WAIT FOR INTERRUPT SI=1
173)   1EFF 1E 00       		 LD E,0	;
174)   1F01 FE 08       		 CP MASTER_START_TXed	;
175)   1F03 28 1F       		 JR Z,RDB_S1	;
177)   1F05 28 1D       		 JR Z,RDB_S1	;
178)   1F07 FE 58       		 CP MASTER_DATA_R_NAK	;
179)   1F09 28 26       		 JR Z,RDB_S2	;
180)   1F0B FE 50       		 CP MASTER_DATA_R_ACK	;
181)   1F0D 28 24       		 JR Z,RDB_S3	;
182)   1F0F FE 40       		 CP MASTER_SLA_R_ACK	;
183)   1F11 28 25       		 JR Z,RDB_S4	;
184)   1F13 FE 48       		 CP MASTER_SLA_R_NAK	;
185)   1F15 28 38       		 JR Z,RDB_EXIT	;
186)   1F17 FE 38       		 CP MASTER_ARB_LOST	;
187)   1F19 C8          		 RET Z	;
188)   1F1A FE B0       		 CP SLAVE_AL_ADDRESSED_R	;
189)   1F1C C8          		 RET Z	;
190)   1F1D FE 68       		 CP SLAVE_AL_ADDRESSED_W	;
191)   1F1F C8          		 RET Z	;
192)   1F20 FE D8       		 CP SLAVE_GENERALCALL_AL 	;
193)   1F22 C8          		 RET Z	;
194)   1F23 C9          		 RET  	;
197)   1F24 7A          		RDB_S1: LD A,D    ;DEVICE ADDR	;DEVICE ADDR
198)   1F25 CB 27       		 SLA A	;
199)   1F27 F6 01       		 OR $01   ;ADDR + READ COMMAND	;ADDR + READ COMMAND
200)   1F29 D3 49       		 OUT (DI2C_DAT),A	;
201)   1F2B 3E 40       		 LD A,$40	;
202)   1F2D D3 4B       		   OUT (DI2C_CON),A	;
203)   1F2F 18 CB       		 JR RDB_LP1	;
204)   1F31 1E 01       		RDB_S2: LD E,1   ;MEANS WE EXIT	;MEANS WE EXIT
205)   1F33 DB 49       		RDB_S3: IN A,(DI2C_DAT)  ;READ DATA	;READ DATA
206)   1F35 77          		 LD (HL),A	;
207)   1F36 23          		 INC HL	;
208)   1F37 0B          		 DEC BC   	;
209)   1F38 78          		RDB_S4: LD A,B   ; IS LENGTH 0	; IS LENGTH 0
210)   1F39 B1          		 OR C	;
211)   1F3A 28 13       		 JR Z,RDB_EXIT 	;
212)   1F3C 7B          		 LD A,E	;
213)   1F3D FE 01       		 CP 1	;
214)   1F3F 28 0E       		 JR Z,RDB_EXIT 	;
215)   1F41 78          		 LD A,B	;
216)   1F42 81          		 ADD C	;
217)   1F43 FE 01       		 CP 1	;
218)   1F45 3E 40       		 LD A,$40 	;
219)   1F47 28 02       		 JR Z,RDB_NXT1	;
220)   1F49 3E C0       		 LD A,$C0	;
221)   1F4B D3 4B       		RDB_NXT1: OUT (DI2C_CON),A  ;WRITE $40 IF BYTE COUNT BC=1 ELSE WRITE $C0 	;WRITE $40 IF BYTE COUNT BC=1 ELSE WRITE $C0
222)   1F4D 18 AD       		 JR RDB_LP1	;
224)   1F4F 3E 50       		RDB_EXIT: LD A,$50	;
225)   1F51 D3 4B       		   OUT (DI2C_CON),A	;
226)   1F53 78          		 LD A,B	;
227)   1F54 B1          		 OR C	;
228)   1F55 C9          		 RET  ;IF A NOT ZERO THEN ERROR 	;IF A NOT ZERO THEN ERROR
 26)   1F56 53 75 6E 64 		SUN DEFM  "Sunday"	;
 26)   1F5A 61 79       		SUN DEFM  "Sunday"	;
 27)   1F5C 00          		 DB 0	;
 28)   1F5D 4D 6F 6E 64 		MON    DEFM  "Monday"	;
 28)   1F61 61 79       		MON    DEFM  "Monday"	;
 29)   1F63 00          		 DB 0	;
 30)   1F64 54 75 65 73 		TUE    DEFM  "Tuesday"	;
 30)   1F68 64 61 79    		TUE    DEFM  "Tuesday"	;
 31)   1F6B 00          		 DB 0	;
 32)   1F6C 57 65 64 6E 		WED DEFM  "Wednesday"	;
 32)   1F70 65 73 64 61 		WED DEFM  "Wednesday"	;
 32)   1F74 79          		WED DEFM  "Wednesday"	;
 33)   1F75 00          		 DB 0	;
 34)   1F76 54 68 75 72 		THU DEFM "Thursday"	;
 34)   1F7A 73 64 61 79 		THU DEFM "Thursday"	;
 35)   1F7E 00          		 DB 0	;
 36)   1F7F 46 72 69 64 		FRI DEFM "Friday"	;
 36)   1F83 61 79       		FRI DEFM "Friday"	;
 37)   1F85 00          		 DB 0	;
 38)   1F86 53 61 74 75 		SAT DEFM "Saturday"	;
 38)   1F8A 72 64 61 79 		SAT DEFM "Saturday"	;
 39)   1F8E 00          		 DB 0	;
 41)   1F8F 56 1F       		DAYS DEFW SUN	;
 42)   1F91 5D 1F       		 DEFW MON	;
 43)   1F93 64 1F       		 DEFW TUE	;
 44)   1F95 6C 1F       		 DEFW WED	;
 45)   1F97 76 1F       		 DEFW THU	;
 46)   1F99 7F 1F       		 DEFW FRI	;
 47)   1F9B 86 1F       		 DEFW SAT	;
 49)   1F9D 45 52 52 4F 		MESERR DEFM "ERROR ON RECEIVING"	;
 49)   1FA1 52 20 4F 4E 		MESERR DEFM "ERROR ON RECEIVING"	;
 49)   1FA5 20 52 45 43 		MESERR DEFM "ERROR ON RECEIVING"	;
 49)   1FA9 45 49 56 49 		MESERR DEFM "ERROR ON RECEIVING"	;
 49)   1FAD 4E 47       		MESERR DEFM "ERROR ON RECEIVING"	;
 50)   1FAF 0A 0D 00    		    DEFB 10,13,0	;
 52)   1FB2 45 52 52 4F 		MESERR0 DEFM "ERROR ON SENDING"	;
 52)   1FB6 52 20 4F 4E 		MESERR0 DEFM "ERROR ON SENDING"	;
 52)   1FBA 20 53 45 4E 		MESERR0 DEFM "ERROR ON SENDING"	;
 52)   1FBE 44 49 4E 47 		MESERR0 DEFM "ERROR ON SENDING"	;
 53)   1FC2 0A 0D 00    		    DEFB 10,13,0	;
 55)   1FC5 7B          		SHERR0: LD A,E	;
 56)   1FC6 C5          		 PUSH BC	;
 57)   1FC7 CD 2B 04    		 CALL SOUTAS	;
 58)   1FCA C1          		 POP BC	;
 59)   1FCB 79          		 LD A,C	;
 60)   1FCC CD 2B 04    		 CALL SOUTAS	;
 62)   1FCF 21 B2 1F    		 LD HL,MESERR0	;
 63)   1FD2 CD 0D 06    		 CALL RS_TXT	;
 64)   1FD5 C9          		 RET	;
 67)   1FD6 79          		SHERR: LD A,C	;
 68)   1FD7 CD 2B 04    		 CALL SOUTAS	;
 69)   1FDA 21 9D 1F    		 LD HL,MESERR	;
 70)   1FDD CD 0D 06    		 CALL RS_TXT	;
 71)   1FE0 37          		 SCF	;
 72)   1FE1 C9          		 RET	;
 75)   1FE2 21 89 83    		@DS1307_GETNOW: LD HL,BUFFER	;
 76)   1FE5 AF          		 XOR A   ;SEND COMMAND 0	;SEND COMMAND 0
 77)   1FE6 77          		 LD (HL),A	;
 78)   1FE7 16 68       		 LD D,DS1307_ADDRESS	;
 79)   1FE9 01 01 00    		 LD BC,1	;
 80)   1FEC CD A5 1E    		 CALL I2C_WRITE	;
 81)   1FEF C2 C5 1F    		 JP NZ,SHERR0	;
 83)   1FF2 21 89 83    		 LD HL,BUFFER	;
 84)   1FF5 16 68       		 LD D,DS1307_ADDRESS	;
 85)   1FF7 01 07 00    		 LD BC,7	;
 86)   1FFA CD F5 1E    		 CALL I2C_READ	;
 87)   1FFD C2 D6 1F    		 JP NZ,SHERR	;
 88)   2000 AF          		 XOR A	;
 89)   2001 C9          		 RET	;
 95)   2002 11 89 83    		 LD DE,BUFFER	;
 96)   2005 AF          		 XOR A	;
 97)   2006 12          		 LD (DE),A	;
 98)   2007 13          		 INC DE	;
 99)   2008 3E 0A       		 LD A,10 ; 10 SECS	; 10 SECS
100)   200A CD 20 22    		 CALL BN2BCD	;
101)   200D 7D          		 LD A,L	;
102)   200E 12          		 LD (DE),A	;
103)   200F 13          		 INC DE	;
104)   2010 3E 22       		 LD A,34 ; 28 MINS	; 28 MINS
105)   2012 CD 20 22    		 CALL BN2BCD	;
106)   2015 7D          		 LD A,L	;
107)   2016 12          		 LD (DE),A	;
108)   2017 13          		 INC DE	;
109)   2018 3E 12       		 LD A,18 ; 19 HOURS	; 19 HOURS
110)   201A CD 20 22    		 CALL BN2BCD	;
111)   201D 7D          		 LD A,L	;
112)   201E 12          		 LD (DE),A	;
113)   201F 13          		 INC DE	;
114)   2020 3E 05       		 LD A,5 ; DAY OF WEEK 	; DAY OF WEEK
115)   2022 12          		 LD (DE),A	;
116)   2023 13          		 INC DE	;
117)   2024 3E 12       		 LD A,18 ; 8 DAY	; 8 DAY
118)   2026 CD 20 22    		 CALL BN2BCD	;
119)   2029 7D          		 LD A,L	;
120)   202A 12          		 LD (DE),A	;
121)   202B 13          		 INC DE	;
122)   202C 3E 02       		 LD A,02 ; 10 MONTH	; 10 MONTH
123)   202E CD 20 22    		 CALL BN2BCD	;
124)   2031 7D          		 LD A,L	;
125)   2032 12          		 LD (DE),A	;
126)   2033 13          		 INC DE	;
127)   2034 3E 15       		 LD A,21 ; 21 YEAR (2020)	; 21 YEAR (2020)
128)   2036 CD 20 22    		 CALL BN2BCD	;
129)   2039 7D          		 LD A,L	;
130)   203A 12          		 LD (DE),A	;
131)   203B 13          		 INC DE	;
132)   203C AF          		 XOR A	;
133)   203D 12          		 LD (DE),A	;
146)   203E 21 89 83    		@DS1307_ADJUST: LD HL,BUFFER	;
147)   2041 16 68       		 LD D,DS1307_ADDRESS	;
148)   2043 01 09 00    		 LD BC,9	;
149)   2046 CD A5 1E    		 CALL I2C_WRITE	;
150)   2049 C2 C5 1F    		 JP NZ,SHERR0	;
151)   204C 01 FF FF    		 LD BC,FFFFh ;8000H FOR 4MHZ	;8000H FOR 4MHZ
152)   204F CD 9D 22    		 CALL PAUSE_LOOP ; 0.5 second delay 	; 0.5 second delay
153)   2052 01 FF FF    		 LD BC,FFFFh ;8000H FOR 4MHZ	;8000H FOR 4MHZ
154)   2055 CD 9D 22    		 CALL PAUSE_LOOP ; 0.5 second delay 	; 0.5 second delay
155)   2058 C9          		 RET	;
159)   2059 21 89 83    		@DS1307_SETSQ: LD HL,BUFFER	;
160)   205C E5          		 PUSH HL	;
161)   205D 3E 07       		 LD A,DS1307_CONTROL_REGISTER	;
162)   205F 77          		 LD (HL),A	;
163)   2060 23          		 INC HL	;
164)   2061 7A          		 LD A,D	;
165)   2062 77          		 LD (HL),A	;
166)   2063 E1          		 POP HL	;
167)   2064 16 68       		 LD D,DS1307_ADDRESS	;
168)   2066 01 02 00    		 LD BC,2	;
169)   2069 CD A5 1E    		 CALL I2C_WRITE	;
170)   206C C2 C5 1F    		 JP NZ,SHERR0 	;
171)   206F C9          		 RET	;
105)   2070 00          		LCD_DSPMODE DB 0	;
106)   2071 00          		LCD_DSPCTRL DB 0	;
111)   2072 16 00       		LCD16_WR4BITS: LD D,0 ;PIN MAP VALUES FRO 8574 BIT 0-7	;PIN MAP VALUES FRO 8574 BIT 0-7
113)   2074 0F          		 RRCA   ;D4 = D0,D5=D1,D6=D2,D7=D3	;D4 = D0,D5=D1,D6=D2,D7=D3
114)   2075 30 02       		 JR NC,LWNXT1   ;BIT 0 NOT SET JR	;BIT 0 NOT SET JR
115)   2077 CB E2       		 SET D4,D	;
116)   2079 0F          		LWNXT1: RRCA	;
117)   207A 30 02       		 JR NC,LWNXT2   ;BIT 1 NOT SET JR	;BIT 1 NOT SET JR
118)   207C CB EA       		 SET D5,D	;
119)   207E 0F          		LWNXT2: RRCA	;
120)   207F 30 02       		 JR NC,LWNXT3   ;BIT 2 NOT SET JR	;BIT 2 NOT SET JR
121)   2081 CB F2       		 SET D6,D	;
122)   2083 0F          		LWNXT3: RRCA	;
123)   2084 30 02       		 JR NC,LWNXT4   ;BIT 3 NOT SET JR	;BIT 3 NOT SET JR
124)   2086 CB FA       		 SET D7,D	;
125)   2088 7B          		LWNXT4: LD A,E	;
126)   2089 0F          		 RRCA	;
127)   208A 30 02       		 JR NC,LWNXT5	;
128)   208C CB C2       		 SET RS,D	;
131)   208E CB D2       		 SET EN,D  ;EN=HIGH	;EN=HIGH
132)   2090 7A          		 LD A,D	;
133)   2091 CD 9B 20    		 CALL LCD16_I2CSEND	;
134)   2094 CB 92       		 RES EN,D  ;EN=LOW	;EN=LOW
135)   2096 7A          		 LD A,D	;
136)   2097 CD 9B 20    		 CALL LCD16_I2CSEND	;
137)   209A C9          		 RET	;
141)   209B D5          		LCD16_I2CSEND: PUSH DE	;
142)   209C E5          		 PUSH HL	;
143)   209D 21 89 83    		 LD HL,BUFFER	;
144)   20A0 77          		 LD (HL),A	;
145)   20A1 16 27       		 LD D,LCDADDR	;
146)   20A3 01 01 00    		 LD BC,1	;
147)   20A6 CD A5 1E    		 CALL I2C_WRITE	;
148)   20A9 E1          		 POP HL	;
149)   20AA D1          		 POP DE	;
150)   20AB C9          		 RET	;
154)   20AC 57          		LCD16_SEND: LD D,A ;SAVE A FOR LATER USE	;SAVE A FOR LATER USE
155)   20AD 7B          		 LD A,E	;
156)   20AE 0F          		 RRCA	;
157)   20AF 38 07       		 JR C,ISCMDDATA	;
158)   20B1 0F          		 RRCA	;
159)   20B2 30 04       		 JR NC,ISCMDDATA	;
161)   20B4 1E 00       		 LD E,COMMAND   ;SEND 4 BITS AS COMMAND E=0	;SEND 4 BITS AS COMMAND E=0
162)   20B6 18 0E       		 JR LCSD_4BIT  	;
163)   20B8 7A          		ISCMDDATA: LD A,D	;
164)   20B9 CB 3F       		 SRL A	;
165)   20BB CB 3F       		 SRL A	;
166)   20BD CB 3F       		 SRL A	;
167)   20BF CB 3F       		 SRL A	;
168)   20C1 D5          		 PUSH DE	;
169)   20C2 CD 72 20    		 CALL LCD16_WR4BITS ;HIGH 4 BITS FIRST	;HIGH 4 BITS FIRST
170)   20C5 D1          		 POP DE	;
171)   20C6 7A          		LCSD_4BIT: LD A,D	;
172)   20C7 E6 0F       		 AND $0F	;
173)   20C9 CD 72 20    		 CALL LCD16_WR4BITS ;LOW 4 BITS NEXT	;LOW 4 BITS NEXT
174)   20CC C9          		 RET	;
179)   20CD 1E 00       		LCD16_COMMD:   LD E,COMMAND	;
180)   20CF C3 AC 20    		 JP LCD16_SEND	;
183)   20D2 1E 01       		LCD16_DATA: LD E,LCD_DATA	;
184)   20D4 C3 AC 20    		 JP LCD16_SEND	;
188)   20D7 3E 03       		@LCD16_INIT: LD A,3     ;SET LCD TO 4BIT MODE	;SET LCD TO 4BIT MODE
189)   20D9 1E 02       		 LD E,FOUR_BITS	;
190)   20DB CD AC 20    		 CALL LCD16_SEND	;
191)   20DE 01 00 30    		 LD BC,$3000	;
192)   20E1 CD 9D 22    		 CALL PAUSE_LOOP  ;DELAY 4,5ms	;DELAY 4,5ms
193)   20E4 3E 03       		 LD A,3	;
194)   20E6 1E 02       		 LD E,FOUR_BITS	;
195)   20E8 CD AC 20    		 CALL LCD16_SEND	;
196)   20EB 01 00 30    		 LD BC,$3000	;
197)   20EE CD 9D 22    		 CALL PAUSE_LOOP  ;DELAY 4,5ms  	;DELAY 4,5ms
198)   20F1 3E 03       		 LD A,3	;
199)   20F3 1E 02       		 LD E,FOUR_BITS	;
200)   20F5 CD AC 20    		 CALL LCD16_SEND	;
201)   20F8 01 00 30    		 LD BC,$3000	;
202)   20FB CD 9D 22    		 CALL PAUSE_LOOP  ;DELAY 4,5ms	;DELAY 4,5ms
203)   20FE 3E 02       		 LD A,2   ;PUT 4 BIT MODE	;PUT 4 BIT MODE
204)   2100 1E 02       		 LD E,FOUR_BITS	;
205)   2102 CD AC 20    		 CALL LCD16_SEND	;
206)   2105 01 00 30    		 LD BC,$3000	;
207)   2108 CD 9D 22    		 CALL PAUSE_LOOP  ;DELAY 4,5ms	;DELAY 4,5ms
209)   210B 3E 28       		    LD A,LCD_FUNCTIONSET OR LCD_2LINE	;
210)   210D CD CD 20    		 CALL LCD16_COMMD	;
211)   2110 3E 04       		 LD A,LCD_DISPLAYON OR LCD_CURSOROFF OR LCD_BLINKOFF  	;
212)   2112 32 71 20    		 LD (LCD_DSPCTRL),A   	;
213)   2115 CD 34 21    		 CALL LCD16_DISP	;
214)   2118 CD 4F 21    		    CALL LCD16_CLR	;
215)   211B 3E 02       		    LD A,LCD_ENTRYLEFT OR LCD_ENTRYSHIFTDECREMENT	;
216)   211D 32 70 20    		    LD (LCD_DSPMODE),A	;
217)   2120 F6 04       		    OR LCD_ENTRYMODESET	;
218)   2122 CD CD 20    		    CALL LCD16_COMMD	;
219)   2125 C9          		 RET	;
221)   2126 3A 71 20    		@LCD16_NODISP: LD A,(LCD_DSPCTRL)	;
222)   2129 CB A7       		    RES LCD_DISPLAYON,A	;
223)   212B 32 71 20    		    LD (LCD_DSPCTRL),A	;
224)   212E F6 08       		    OR LCD_DISPLAYCONTROL	;
225)   2130 CD CD 20    		    CALL LCD16_COMMD	;
226)   2133 C9          		 RET	;
227)   2134 3A 71 20    		@LCD16_DISP: LD A,(LCD_DSPCTRL)	;
228)   2137 F6 04       		    OR LCD_DISPLAYON	;
229)   2139 32 71 20    		    LD (LCD_DSPCTRL),A	;
230)   213C F6 08       		    OR LCD_DISPLAYCONTROL	;
231)   213E CD CD 20    		    CALL LCD16_COMMD	;
232)   2141 C9          		 RET	;
234)   2142 01 D0 07    		LCDDELAY: LD BC,HOME_CLEAR_EXEC	;
235)   2145 C5          		LCLR_AGN1: PUSH BC 	;
236)   2146 CD D9 21    		 CALL DELAYMICRO	;
237)   2149 C1          		 POP BC	;
238)   214A 0D          		 DEC C  	;
239)   214B E2 45 21    		 JP PO,LCLR_AGN1	;
240)   214E C9          		 RET	;
242)   214F 3E 01       		@LCD16_CLR: LD A,LCD_CLEARDISPLAY ;clear display, set cursor position to zero	;clear display, set cursor position to zero
243)   2151 CD CD 20    		 CALL LCD16_COMMD	;
244)   2154 CD 42 21    		 CALL LCDDELAY	;
245)   2157 C9          		 RET 	;
248)   2158 7E          		@LCD16_PRINT: LD A,(HL)	;
249)   2159 FE 00       		 CP 0	;
250)   215B C8          		 RET Z	;
251)   215C CD D2 20    		 CALL LCD16_DATA	;
252)   215F 23          		 INC HL	;
253)   2160 18 F6       		 JR LCD16_PRINT	;
256)   2162 CD D2 20    		@LCD16_PRCHR: CALL LCD16_DATA	;
257)   2165 C9          		 RET	;
259)   2166 3E 02       		@LCD16_HOME: LD A,LCD_RETURNHOME	;
260)   2168 CD CD 20    		 CALL LCD16_COMMD 	;
261)   216B CD 42 21    		 CALL LCDDELAY     	;
262)   216E C9          		 RET	;
265)   216F 00 40 14 54 		ROWOFFSET: DB $00,$40,$14,$54 	;
266)   2173 06 00       		@LCD16_SETCURS: LD B,0	;
267)   2175 4B          		 LD C,E	;
268)   2176 21 6F 21    		 LD HL,ROWOFFSET	;
269)   2179 09          		 ADD HL,BC	;
270)   217A 7E          		 LD A,(HL)	;
271)   217B 82          		 ADD D	;
272)   217C F6 80       		 OR LCD_SETDDRAMADDR	;
273)   217E CD CD 20    		 CALL LCD16_COMMD	;
274)   2181 C9          		 RET	;
276)   2182 3A 71 20    		@LCD16_CURSOFF: LD A,(LCD_DSPCTRL)	;
277)   2185 CB 97       		    RES LCD_CURSORON,A	;
278)   2187 32 71 20    		    LD (LCD_DSPCTRL),A	;
279)   218A F6 08       		    OR LCD_DISPLAYCONTROL	;
280)   218C CD CD 20    		    CALL LCD16_COMMD	;
281)   218F C9          		 RET	;
284)   2190 3A 71 20    		@LCD16_CURSON: LD A,(LCD_DSPCTRL)	;
285)   2193 F6 02       		    OR LCD_CURSORON	;
286)   2195 32 71 20    		    LD (LCD_DSPCTRL),A	;
287)   2198 F6 08       		    OR LCD_DISPLAYCONTROL	;
288)   219A CD CD 20    		    CALL LCD16_COMMD	;
289)   219D C9          		    RET  	;
291)   219E 3A 71 20    		@LCD16_BLINKOFF: LD A,(LCD_DSPCTRL)	;
292)   21A1 CB 8F       		    RES LCD_BLINKON,A	;
293)   21A3 32 71 20    		    LD (LCD_DSPCTRL),A	;
294)   21A6 F6 08       		    OR LCD_DISPLAYCONTROL	;
295)   21A8 CD CD 20    		    CALL LCD16_COMMD	;
296)   21AB C9          		 RET	;
299)   21AC 3A 71 20    		@LCD16_BLINKON: LD A,(LCD_DSPCTRL)	;
300)   21AF F6 01       		    OR LCD_BLINKON	;
301)   21B1 32 71 20    		    LD (LCD_DSPCTRL),A	;
302)   21B4 F6 08       		    OR LCD_DISPLAYCONTROL	;
303)   21B6 CD CD 20    		    CALL LCD16_COMMD	;
304)   21B9 C9          		    RET  	;
306)   21BA 3E 18       		@LCD16_SCRLEFT: LD A,LCD_CURSORSHIFT OR LCD_DISPLAYMOVE OR LCD_MOVELEFT	;
307)   21BC CD CD 20    		 CALL LCD16_COMMD	;
308)   21BF C9          		 RET	;
310)   21C0 3E 1C       		@LCD16_SCRRIGHT: LD A,LCD_CURSORSHIFT OR LCD_DISPLAYMOVE OR LCD_MOVERIGHT	;
311)   21C2 CD CD 20    		 CALL LCD16_COMMD	;
312)   21C5 C9          		 RET	;
314)   21C6 3E 10       		@LCD16_MOVLEFT: LD A,LCD_CURSORSHIFT OR LCD_CURSORMOVE OR LCD_MOVELEFT	;
315)   21C8 CD CD 20    		 CALL LCD16_COMMD	;
316)   21CB C9          		 RET	;
318)   21CC 3E 14       		@LCD16_MOVRIGHT: LD A,LCD_CURSORSHIFT OR LCD_CURSORMOVE OR LCD_MOVERIGHT	;
319)   21CE CD CD 20    		 CALL LCD16_COMMD	;
320)   21D1 C9          		 RET	;
 18)   21D2 C9          		     RET 	;
 21)   21D3 F5          		DELAYMICROSEC: PUSH AF	;
 22)   21D4 D5          		 PUSH DE	;
 23)   21D5 1B          		 DEC DE	;
 24)   21D6 D1          		 POP DE	;
 25)   21D7 F1          		 POP AF	;
 26)   21D8 C9          		 RET	;
 29)   21D9 CD D3 21    		S21: CALL DELAYMICROSEC	;
 30)   21DC 10 FB       		 DJNZ S21 	;
 31)   21DE C9          		 RET	;
 35)   21DF F5          		DELAYMILISEC: PUSH AF	;
 36)   21E0 D5          		 PUSH DE	;
 37)   21E1 11 2C 01    		 LD DE,300 ;2000 1 MILISEC =300 ON 8MHZ SO 30= 0.1 MILISECS = 100 MICROSECS	;2000 1 MILISEC =300 ON 8MHZ SO 30= 0.1 MILISECS = 100 MICROSECS
 38)   21E4 1B          		DEL1: DEC DE	;
 39)   21E5 7A          		 LD A,D           ;TEST FOR DE=00	;TEST FOR DE=00
 40)   21E6 B3          		 OR E	;
 41)   21E7 20 FB       		 JR NZ,DEL1 	;
 42)   21E9 D1          		 POP DE	;
 43)   21EA F1          		 POP AF	;
 44)   21EB C9          		 RET	;
 46)   21EC 06 50       		DEL2:LD B,80	;
 48)   21EE CD DF 21    		S1: CALL DELAYMILISEC	;
 49)   21F1 10 FB       		 DJNZ S1 	;
 50)   21F3 C9          		 RET	;
 55)   21F4 C5          		@DELAYSEC:PUSH BC 	;
 56)   21F5 01 E8 03    		        LD BC,1000 	;
 57)   21F8 C5          		MYDLAGN: PUSH BC	;
 58)   21F9 CD DF 21    		        CALL DELAY  ;1MS ON 8 MHZ	;1MS ON 8 MHZ
 59)   21FC C1          		       POP BC	;
 60)   21FD 0B          		       DEC BC	;
 61)   21FE 78          		        LD A,B	;
 62)   21FF B1          		        OR C	;
 63)   2200 20 F6       		        JR NZ,MYDLAGN	;
 64)   2202 C1          		        POP BC	;
 65)   2203 10 EF       		        DJNZ DELAYSEC	;
 66)   2205 C9          		        RET	;
 71)   2206 F5          		OUTASC PUSH AF	;
 72)   2207 D5          		 PUSH DE	;
 73)   2208 CD 3B 22    		 CALL B2Bcd	;
 74)   220B D1          		 POP DE	;
 75)   220C CD 61 22    		 CALL BCD2HA	;
 76)   220F F1          		 POP AF	;
 77)   2210 C9          		 RET	;
 91)   2211 B7          		BCD2BN: OR A	;
 92)   2212 47          		       LD B,A	;
 93)   2213 E6 F0       		 AND $F0	;
 94)   2215 0F          		 RRCA	;
 95)   2216 4F          		 LD C,A	;
 96)   2217 0F          		 RRCA	;
 97)   2218 0F          		 RRCA	;
 98)   2219 81          		 ADD A,C	;
 99)   221A 4F          		 LD C,A	;
100)   221B 78          		 LD A,B	;
101)   221C E6 0F       		 AND $0F	;
102)   221E 81          		 ADD A,C	;
103)   221F C9          		 RET 	;
118)   2220 26 FF       		BN2BCD: LD H,$FF	;
119)   2222 24          		D100LP: INC H	;
120)   2223 D6 64       		 SUB 100	;
121)   2225 30 FB       		 JR NC,D100LP	;
122)   2227 C6 64       		 ADD A,100	;
123)   2229 2E FF       		 LD L,$FF	;
124)   222B 2C          		D10LP: INC L	;
125)   222C D6 0A       		       SUB 10	;
126)   222E 30 FB       		       JR NC, D10LP	;
127)   2230 C6 0A       		       ADD A,10	;
128)   2232 4F          		       LD C,A	;
129)   2233 7D          		       LD A,L	;
130)   2234 07          		       RLCA	;
131)   2235 07          		       RLCA        	;
132)   2236 07          		 RLCA	;
133)   2237 07          		       RLCA	;
134)   2238 B1          		 OR C	;
135)   2239 6F          		 LD L,A	;
136)   223A C9          		 RET	;
150)   223B 01 00 10    		LD BC, 16*256+0 ; handle 16 bits, one bit per iteration	; handle 16 bits, one bit per iteration
151)   223E 11 00 00    		LD DE, 0	;
153)   2241 29          		ADD HL, HL	;
154)   2242 7B          		LD A, E	;
155)   2243 8F          		ADC A, A	;
156)   2244 27          		DAA	;
157)   2245 5F          		LD E, A	;
158)   2246 7A          		LD A, D	;
159)   2247 8F          		ADC A, A	;
160)   2248 27          		DAA	;
161)   2249 57          		LD D, A	;
162)   224A 79          		LD A, C	;
163)   224B 8F          		ADC A, A	;
164)   224C 27          		DAA	;
165)   224D 4F          		LD C, A	;
166)   224E 10 F1       		DJNZ cvtLp	;
167)   2250 EB          		EX DE,HL	;
168)   2251 C9          		RET	;
182)   2252 B7          		BCD2BN: OR A	;
183)   2253 47          		       LD B,A	;
184)   2254 E6 F0       		 AND $F0	;
185)   2256 0F          		 RRCA	;
186)   2257 4F          		 LD C,A	;
187)   2258 0F          		 RRCA	;
188)   2259 0F          		 RRCA	;
189)   225A 81          		 ADD A,C	;
190)   225B 4F          		 LD C,A	;
191)   225C 78          		 LD A,B	;
192)   225D E6 0F       		 AND $0F	;
193)   225F 81          		 ADD A,C	;
194)   2260 C9          		 RET	;
206)   2261 79          		LD A, C	;
207)   2262 CD 8E 22    		CALL cvtUN	;
208)   2265 79          		LD A, C	;
209)   2266 CD 92 22    		CALL cvtLN	;
210)   2269 7C          		LD A, H	;
211)   226A CD 8E 22    		CALL cvtUN	;
212)   226D 7C          		LD A, H	;
213)   226E CD 92 22    		CALL cvtLN	;
214)   2271 7D          		LD A, L	;
215)   2272 CD 8E 22    		CALL cvtUN	;
216)   2275 7D          		LD A, L	;
217)   2276 18 1A       		JR cvtLN	;
219)   2278 1F          		RRA ; move upper nibble into lower nibble	; move upper nibble into lower nibble
220)   2279 1F          		RRA	;
221)   227A 1F          		RRA	;
222)   227B 1F          		RRA	;
224)   227C E6 0F       		AND 0Fh ; isolate lower nibble	; isolate lower nibble
225)   227E C6 90       		ADD A, 90h ; old trick	; old trick
226)   2280 27          		DAA ; for converting	; for converting
227)   2281 CE 40       		ADC A, 40h ; one nibble	; one nibble
228)   2283 27          		DAA ; to hex ASCII	; to hex ASCII
229)   2284 12          		LD (DE), A	;
230)   2285 13          		INC DE	;
231)   2286 C9          		RET	;
243)   2287 7D          		LD A, L	;
244)   2288 CD 78 22    		CALL cvtUN	;
245)   228B 7D          		LD A, L	;
246)   228C 18 EE       		JR cvtLN	;
248)   228E 1F          		RRA ; move upper nibble into lower nibble	; move upper nibble into lower nibble
249)   228F 1F          		RRA	;
250)   2290 1F          		RRA	;
251)   2291 1F          		RRA	;
253)   2292 E6 0F       		AND 0Fh ; isolate lower nibble	; isolate lower nibble
254)   2294 C6 90       		ADD A, 90h ; old trick	; old trick
255)   2296 27          		DAA ; for converting	; for converting
256)   2297 CE 40       		ADC A, 40h ; one nibble	; one nibble
257)   2299 27          		DAA ; to hex ASCII	; to hex ASCII
258)   229A 12          		LD (DE), A	;
259)   229B 13          		INC DE	;
260)   229C C9          		RET	;
277)   229D F5          		 PUSH AF      ; 11 T-states	; 11 T-states
279)   229E ED 44       		 NEG        ; 8 T-states	; 8 T-states
280)   22A0 ED 44       		 NEG        ; 8 T-states	; 8 T-states
281)   22A2 ED 44       		 NEG        ; 8 T-states	; 8 T-states
282)   22A4 ED 44       		 NEG        ; 8 T-states	; 8 T-states
283)   22A6 0B          		 DEC BC       ; 6 T-states	; 6 T-states
284)   22A7 79          		 LD A,C       ; 9 T-states	; 9 T-states
285)   22A8 B0          		 OR B       ; 4 T-states	; 4 T-states
286)   22A9 C2 9E 22    		 JP NZ,pau_lp     ; 10 T-states	; 10 T-states
287)   22AC F1          		 POP AF       ; 10 T-states	; 10 T-states
288)   22AD C9          		 RET        ; Pause complete, RETurn	; Pause complete, RETurn
  8)   22AE 21 00 00    		@Mult16:ld hl,0	;
  9)   22B1 78          		   ld a,b	;
 10)   22B2 06 10       		   ld b,16	;
 12)   22B4 29          		   add hl,hl	;
 13)   22B5 CB 21       		   sla c	;
 14)   22B7 17          		   rla	;
 15)   22B8 30 01       		   jr nc,Mult16_NoAdd	;
 16)   22BA 19          		   add hl,de	;
 18)   22BB 10 F7       		   djnz Mult16_Loop	;
 19)   22BD C9          		   ret	;
 25)   22BE D5          		@Mult32:PUSH DE	;
 26)   22BF 79          		   ld a,c	;
 27)   22C0 48          		   ld c,b	;
 28)   22C1 21 00 00    		   ld hl,0	;
 29)   22C4 06 10       		   ld b,16	;
 31)   22C6 29          		   add hl,hl	;
 32)   22C7 17          		   rla	;
 33)   22C8 CB 11       		   rl c	;
 34)   22CA 30 07       		   jr nc,Mult32_NoAdd	;
 35)   22CC 19          		   add hl,de	;
 36)   22CD CE 00       		   adc a,0	;
 37)   22CF D2 D3 22    		   jp nc,Mult32_NoAdd	;
 38)   22D2 0C          		   inc c	;
 40)   22D3 10 F1       		   djnz Mult32_Loop	;
 41)   22D5 41          		   ld b,c	;
 42)   22D6 4F          		   ld c,a	;
 43)   22D7 D1          		   POP DE	;
 44)   22D8 C9          		   ret	;
 52)   22D9 19          		       ADD     HL,DE   ; 16-BIT ADD OF HL AND DE	; 16-BIT ADD OF HL AND DE
 53)   22DA D9          		       EXX	;
 54)   22DB ED 5A       		       ADC     HL,DE   ; 16-BIT ADD OF HL AND DE WITH CARRY	; 16-BIT ADD OF HL AND DE WITH CARRY
 55)   22DD D9          		       EXX	;
 58)   22DE C9          		       RET	;
 68)   22DF 11 40 00    		   ld de,$0040	;
 69)   22E2 7D          		   ld a,l	;
 70)   22E3 6C          		   ld l,h	;
 71)   22E4 62          		   ld h,d	;
 72)   22E5 B7          		   or a	;
 73)   22E6 06 08       		   ld b,8	;
 75)   22E8 ED 52       		   sbc hl,de	;
 76)   22EA 30 01       		   jr nc,Sqr16_Skip	;
 77)   22EC 19          		   add hl,de	;
 79)   22ED 3F          		   ccf	;
 80)   22EE CB 12       		   rl d	;
 81)   22F0 87          		   add a,a	;
 82)   22F1 ED 6A       		   adc hl,hl	;
 83)   22F3 87          		   add a,a	;
 84)   22F4 ED 6A       		   adc hl,hl	;
 85)   22F6 10 F0       		   djnz Sqr16_Loop	;
 86)   22F8 C9          		   ret        	;
  9)   8300 00          		   @FLAGS   DEFS 1  ; Flags: B7=ESC PRESSED, B6=ESC DISABLED	; Flags: B7=ESC PRESSED, B6=ESC DISABLED
 10)   8301 00 00       		   @FCOLOR   DEFS 2 ;FOREGROUND COLOR FOR TEXT	;FOREGROUND COLOR FOR TEXT
 11)   8303 00 00       		   @BCOLOR   DEFS 2 ;BACKGROUND COLOR FOR TEXT	;BACKGROUND COLOR FOR TEXT
 12)   8305 00 00       		   @FGRCOL   DEFS 2 ;FOREGROUND COLOR FOR GRAPHICS	;FOREGROUND COLOR FOR GRAPHICS
 13)   8307 00 00       		   @BGRCOL   DEFS 2 ;BACKGROUND COLOR FOR GRAPHICS 	;BACKGROUND COLOR FOR GRAPHICS
 14)   8309 00 00       		   @FCOLTM   DEFS 2 ;TEMP FOREGROUND COLOR 	;TEMP FOREGROUND COLOR
 15)   830B 00 00       		   @BCOLTM   DEFS 2 ;TEMP BACKGROUND COLOR 	;TEMP BACKGROUND COLOR
 16)   830D 00          		   @CURSORX  DEFS 1    ;0-79	;0-79
 17)   830E 00          		   @CURSORY  DEFS 1    ;0-47	;0-47
 18)   830F 00          		   @SCRLN    DEFS 1    ;0-47 SCROLL LINES	;0-47 SCROLL LINES
 19)   8310 00          		   @LASTCHAR DEFS 1; 	;
 20)   8311 00          		   @CURSSTAT DEFS 1;  ;IF BIT 0 SET THEN SHOW ELSE HIDE, IF BIT 1 SET THEN VISIBLE ELSE HIDDEN	;  ;IF BIT 0 SET THEN SHOW ELSE HIDE, IF BIT 1 SET THEN VISIBLE ELSE HIDDEN
 21)   8312 00 00       		   @EDPTR    DEFS 2	;
 22)   8314 00          		   @OPTVAL   DEFS 1	;
 23)   8315 00          		   @INKEY    DEFS 1	;
 24)   8316 00          		   @VDUMODE  DEFS 1    ;VDU 4 TEXT PRINT 5 GRAPH PRINT	;VDU 4 TEXT PRINT 5 GRAPH PRINT
 25)   8317 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   831B 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   831F 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   8323 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   8327 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   832B 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   832F 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 25)   8333 00 00 00 00 		   @FCOLPAL DEFS 16*2    ; FORECOLOR PALETTE	; FORECOLOR PALETTE
 26)   8337 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   833B 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   833F 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   8343 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   8347 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   834B 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   834F 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 26)   8353 00 00 00 00 		   @BCOLPAL DEFS 16*2    ; BACKCOLOR PALETTE	; BACKCOLOR PALETTE
 27)   8357 00 00       		   @GR_LASTX3 DEFS 2	;
 28)   8359 00 00       		   @GR_LASTY3 DEFS 2	;
 29)   835B 00 00       		   @GR_LASTX2 DEFS 2	;
 30)   835D 00 00       		   @GR_LASTY2 DEFS 2    	;
 31)   835F 00 00       		   @GR_LASTX DEFS 2	;
 32)   8361 00 00       		   @GR_LASTY DEFS 2	;
 33)   8363 00 00       		   @GR_PARAM1 DEFS 2	;
 34)   8365 00 00       		   @GR_PARAM2 DEFS 2	;
 35)   8367 00 00       		   @GR_PARAM3 DEFS 2	;
 36)   8369 00 00       		   @GR_PARAM4 DEFS 2	;
 38)   836B 00 00       		   @FILL_X   DEFS 2	;
 39)   836D 00 00       		   @FILL_Y   DEFS 2 	;
 40)   836F 00 00       		   @FILL_L   DEFS 2	;
 41)   8371 00 00       		   @FILL_X1  DEFS 2	;
 42)   8373 00 00       		   @FILL_X2  DEFS 2	;
 43)   8375 00 00       		   @FILL_DY  DEFS 2	;
 44)   8377 00 00       		   @FILL_Q   DEFS 2  ;START OF QUEUE	;START OF QUEUE
 45)   8379 00 00       		   @FILL_IDX DEFS 2  ;INDEX OF QUEUE	;INDEX OF QUEUE
 46)   837B 00 00       		   @FILL_PY  DEFS 2  ;FOR PUSH/POP	;FOR PUSH/POP
 47)   837D 00 00       		   @FILL_PXL DEFS 2	;
 48)   837F 00 00       		   @FILL_PXR DEFS 2	;
 49)   8381 00 00       		   @FILL_PDY DEFS 2    	;
 50)   8383 00 00       		   @FILL_OV  DEFS 2  ;OLD COLOR	;OLD COLOR
 51)   8385 00 00       		   @FILL_OLDSP DEFS 2; OLD SP	; OLD SP
 52)   8387 00          		   @LCD_DSPCTRL DEFS 1	;
 53)   8388 00          		   @LCD_DSPMODE DEFS 1	;
 54)   8389 00 00 00 00 		   @BUFFER   DEFS 20; 20 BYTE BUFFER FOR I2C USAGE	; 20 BYTE BUFFER FOR I2C USAGE
 54)   838D 00 00 00 00 		   @BUFFER   DEFS 20; 20 BYTE BUFFER FOR I2C USAGE	; 20 BYTE BUFFER FOR I2C USAGE
 54)   8391 00 00 00 00 		   @BUFFER   DEFS 20; 20 BYTE BUFFER FOR I2C USAGE	; 20 BYTE BUFFER FOR I2C USAGE
 54)   8395 00 00 00 00 		   @BUFFER   DEFS 20; 20 BYTE BUFFER FOR I2C USAGE	; 20 BYTE BUFFER FOR I2C USAGE
 54)   8399 00 00 00 00 		   @BUFFER   DEFS 20; 20 BYTE BUFFER FOR I2C USAGE	; 20 BYTE BUFFER FOR I2C USAGE
 57)   839D 00          		   @FFSTAT   DEFS 1  ;FOR OUTPUT FLIP FLOPS DEVEPR, DEVKBD	;FOR OUTPUT FLIP FLOPS DEVEPR, DEVKBD
 58)   839E 00          		  @KEYCTR   DEFS 1  ;FOR USB KEYBOARD 	;FOR USB KEYBOARD
 59)   839F 00          		  @SERERR  DEFS 1;	;
 60)   83A0 00          		  @SERER2  DEFS 1  ;AT RAM ADDRESS	;AT RAM ADDRESS
 61)   83A1 00          		  @DISPCT   DEFS 1  ;	;
 62)   83A2 00          		  @LCDCX    DEFS 1  ;DB 0  ;DISPLAY X POS (0..F  FOR 1..16)	;DB 0  ;DISPLAY X POS (0..F  FOR 1..16)
 63)   83A3 00          		  @LCDCY    DEFS 1  ;DB 0  ;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)	;DB 0  ;DISPLAY Y POS (0 OR 1 FOR LINE 1 AND 2)
 64)   83A4 00 00       		  @PRGEX   DEFS 2  ;2 BYTES	;2 BYTES
 65)   83A6 00          		  @TVSTAT   DEFS 1  ;1 BYTE	;1 BYTE
 66)   83A7 00 00 00 00 		  @TIMECTR  DEFS 4	;
 67)   83AB 00          		  @INT2TE DEFB 0	;
 68)   83AC 00 00 00 00 		   @MYNUM   DEFS 13 ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED    	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 68)   83B0 00 00 00 00 		   @MYNUM   DEFS 13 ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED    	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 68)   83B4 00 00 00 00 		   @MYNUM   DEFS 13 ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED    	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
 68)   83B8 00          		   @MYNUM   DEFS 13 ;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED    	;10CHARS MESSAGE FOR NUMBER AND 3 TERMINATED
