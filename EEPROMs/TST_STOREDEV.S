ORG $8000
	
DEVSTOR EQU $30



INCLUDE MYOS_2_0000.SYM




     	LD A,3 ;12  ;9600BPS FOR ARDUINO INTERFACE
     	CALL STOR_INI

LP1:    LD HL,MSG1
	CALL RS_TXT
	CALL GET_CHAR 
        CP 'M'
	JP Z,MENU
	CP 'A'
	CALL Z,APRESS
	CP 'O'
	CALL Z,STRG_OPENCRD
	CP 'D'
	CALL Z,STRG_DIRLIST
	CP 'C'
	CALL Z,STRG_DIRCHG
	CP 'F'
	CALL Z,STRG_OPNFILE
	CP '1'
	CALL Z,CTSLOW
	CP '2'
	CALL Z,CTSHI
	CP '0'
	CALL Z,TESTSEND
	CP '9'
	CALL Z,TESTRECV
	CP '8'
	CALL Z,TESTCTS	
        JR LP1

MSG1	DEFM "O:OPENCARD D:DIRLIST | M:MENU"
	DB 10,13,0

TYPEFILE:	


DIRCRY	DEFM "Test"
	DB 0
FILNAM	DEFM "TEST.TXT"
	DB 0,0,0



CTSLOW: LD A,2 ;BIT 1					;ready to receive SIGNAL RTS 1 MEANS ARDUINO CTS=0
       	OUT (MCR),A
	RET	

CTSHI:  XOR A
	OUT (MCR),A
	RET	

;'0'
TESTSEND: 	LD B,10
		LD HL,MES1
TSAGN:		LD A,(HL)
		CALL STOR_TX
		PUSH HL
		PUSH BC
		CALL LCD_PRINTCHAR
		POP BC
		POP HL
		INC HL
		DJNZ TSAGN
		RET
		

;'9'
TESTRECV:	LD A,13
		CALL LCD_PRINTCHAR
		LD A,'['
		CALL LCD_PRINTCHAR
		LD B,10
TRAGN:		CALL STOR_RX
		PUSH BC
		CALL LCD_PRINTCHAR
		POP BC
		DJNZ TRAGN
		LD A,']'
		CALL LCD_PRINTCHAR
		LD A,13
		CALL LCD_PRINTCHAR
		RET

TESTCTS:	IN A,(MSR)
		BIT 4,A		;COMPLEMENT OF CTS SO IF CTS=0 THIS IS 1
		JR NZ,TESTCTS
		RET


APRESS: CALL DEL2
	LD HL,MES1
	CALL STOR_TXT
	LD HL,MES2
	CALL STOR_TXT
	RET

MES1    DEFM "1234567890"
	DB 10,13,0

MES2    DEFM "ABCDEFGHIJKLMNOPQRSTUVWXYZ "
	DB 10,13,0


;THIS DELAYS 1MILISECOND ON 8MHZ CPU
DELAY:
DELAYMILISEC:	PUSH AF
	PUSH DE
	LD DE,300	;2000 1 MILISEC =300 ON 8MHZ SO 30= 0.1 MILISECS = 100 MICROSECS
DEL1:	DEC DE
	LD A,D            ;TEST FOR DE=00
	OR E
	JR NZ,DEL1 	
	POP DE
	POP AF
	RET

DEL2:LD B,80
DELAYMILI:	
S1:	CALL DELAYMILISEC
	DJNZ S1	
	RET

  @STRGBUFF  	    DEFS 40		;USED FOR DIRECTORY AND FILENAME
  @STRGCMD     	DEFS 4
  @FID		        DEFS 1


INCLUDE ATL_STORAGE.Z80